<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>why&#8217;s (poignant) guide to ruby :: 5. Them What Make the Rules and Them What Live the Dream</title>
    <link rel="stylesheet" type="text/css" href="../guide.css" />
</head>
<body class="chapter">

<div id="banner">
   <div class="pager">
   <a class="pagebar" href="chapter-4.html">previous</a> | <a class="pagebar" href="chapter-6.html">next</a>
   </div>
   <div class="title">
   <img src="../images/2006.chaptertitle.png" alt="why's (poignant) guide to ruby" />
   </div>
</div>
<div id="container">
<div class="page">
    <div class="pageLinks">
        <a class="pagebar" href="./">Contents</a>
    </div>
    <div class="pageTitle">
        
            <h3>5.</h3>
            <h1>Them What Make the Rules and Them What Live the Dream</h1>
            <p><img src="../images/chapter.poignant.guide-5.jpg" alt="[o]" /></p>
        
    </div>
    <div class="content">

    

        <p><img src="../images/dr.cham-1.gif" title="Through space and time... in his bell jar... on a mission to find himself..." alt="Through space and time... in his bell jar... on a mission to find himself..." /></p>


	<p>Frankly, I&#8217;m sick and tired of hearing that Dr. Cham was a madman.  Yes, he tried to bury himself alive.  Yes, he electrocuted his niece.  Yes, in fact, he did dynamite a retirement home.  But this was all with good cause and, in each case, I believe he took the correct course of action.</p>


	<p>I&#8217;m sure you&#8217;d like to side with popular opinion, but you&#8217;re bound to feel some small trickle of admiration for him once he&#8217;s taken time to teach you all  about Ruby&#8217;s class definitions. And moreso when you learn about mixins.  And perhaps, by the end of the chapter, we can all start to look beyond the Doctor&#8217;s grievous past and stop calling him a madman.</p>


	<p>So if you need to call him a madman, I&#8217;d start heading down to the train tracks to smash up some long flourescent light bulbs.  Get it out of your system right now,  before we dig in.</p>

    
    
        
        <a name="section1" />
        <h2>1. This One's For the Disenfranchised</h2>

        <p><img src="../images/elderly-1.gif" title="Some people still can't get past what he did." alt="Some people still can't get past what he did." /></p>


	<p>If you give me a number, which is any year from Dr. Cham&#8217;s life, I&#8217;ll give you a synopsis of that time period.  And I&#8217;ll do it as a Ruby method, so it&#8217;s an independent piece, an isolated chunk of code which can be hooked up to the voice of a robotic volcano, when such a thing becomes the apex of authoritative voice talents.</p>


	<p>Okay, so I need you to notice <code><span class="keyword">def</span></code> and <code><span class="keyword">case</span></code> and <code><span class="keyword">when</span></code>.  You&#8217;ve seen the Ranges, the closed accordions of <code><span class="number">1895</span><span class="punct">..</span><span class="number">1913</span></code>, back in chapter 3.  They contain both ends and in between.  And the backslashes at the end of each line simply ignore the <em>Enter</em> key at the end of each line, assuring Ruby that there is <em>more of this line to come</em>.</p>


	<p>So, please: <code><span class="keyword">def</span></code> and <code><span class="keyword">case</span></code> and <code><span class="keyword">when</span></code>.</p>


<div class='example'><pre><code> <span class="keyword">def </span><span class="method">dr_chams_timeline</span><span class="punct">(</span> <span class="ident">year</span> <span class="punct">)</span>
   <span class="keyword">case</span> <span class="ident">year</span>
   <span class="keyword">when</span> <span class="number">1894</span>
     <span class="punct">&quot;</span><span class="string">Born.</span><span class="punct">&quot;</span> 
   <span class="keyword">when</span> <span class="number">1895</span><span class="punct">..</span><span class="number">1913</span>
     <span class="punct">&quot;</span><span class="string">Childhood in Lousville, Winston Co., Mississippi.</span><span class="punct">&quot;</span> 
   <span class="keyword">when</span> <span class="number">1914</span><span class="punct">..</span><span class="number">1919</span>
     <span class="punct">&quot;</span><span class="string">Worked at a pecan nursery; punched a Quaker.</span><span class="punct">&quot;</span> 
   <span class="keyword">when</span> <span class="number">1920</span><span class="punct">..</span><span class="number">1928</span>
     <span class="punct">&quot;</span><span class="string">Sailed in the Brotherhood of River Wisdomming, which journeyed <span class="escape">\
</span>      the Mississippi River and engaged in thoughtful self-improvement, <span class="escape">\
</span>      where he finished 140 credit hours from their Oarniversity.</span><span class="punct">&quot;</span> 
   <span class="keyword">when</span> <span class="number">1929</span>
     <span class="punct">&quot;</span><span class="string">Returned to Louisville to pen a novel about time-travelling pheasant hunters.</span><span class="punct">&quot;</span> 
   <span class="keyword">when</span> <span class="number">1930</span><span class="punct">..</span><span class="number">1933</span>
     <span class="punct">&quot;</span><span class="string">Took up a respectable career insuring pecan nurseries.  Financially stable, he <span class="escape">\
</span>      spent time in Brazil and New Mexico, buying up rare paper-shell pecan trees.  Just <span class="escape">\
</span>      as his notariety came to a crescendo: gosh, he tried to buried himself alive.</span><span class="punct">&quot;</span> 
   <span class="keyword">when</span> <span class="number">1934</span>
     <span class="punct">&quot;</span><span class="string">Went back to writing his novel.  Changed the hunters to insurance tycoons and the <span class="escape">\
</span>      pheasants to Quakers.</span><span class="punct">&quot;</span> 
   <span class="keyword">when</span> <span class="number">1935</span><span class="punct">..</span><span class="number">1940</span>
     <span class="punct">&quot;</span><span class="string">Took Arthur Cone, the Headmaster of the Brotherhood of River Wisdomming, as a <span class="escape">\
</span>      houseguest.  Together for five years, engineering and inventing.</span><span class="punct">&quot;</span> 
   <span class="keyword">when</span> <span class="number">1941</span>
     <span class="punct">&quot;</span><span class="string">And this is where things got interesting.</span><span class="punct">&quot;</span> 
   <span class="keyword">end</span>
 <span class="keyword">end</span></code></pre></div>

	<p>The <code><span class="keyword">def</span></code> keyword.  Here is our first <strong>method definition</strong>.  A plain kernel method, which can be used anywhere in Ruby.  And how do we run it?</p>


<div class='example'><pre><code> <span class="ident">puts</span> <span class="ident">dr_chams_timeline</span><span class="punct">(</span> <span class="number">1941</span> <span class="punct">)</span></code></pre></div>

	<p>Which answers with &#8220;And this is where things got interesting.&#8221;  It&#8217;s the same story again and again: <em>use your answers.</em>  I&#8217;ve set things up above so that the <code><span class="keyword">case</span></code> statement always answers with a string. And since the case statement is the final (and only) statement in the method, then the method answers with that string.  Trickling water spilling down from ledge to ledge.</p>


	<p>Let me be clear about the <code><span class="keyword">case</span></code> statement.  Actually, I should call it a <code><span class="keyword">case</span><span class="punct">..</span><span class="keyword">when</span></code> statement, since they cannot be used separately.  The <code><span class="keyword">case</span></code> keyword is followed by a value, which is compared against each of the values which follow <code><span class="keyword">when</span></code> keywords.  The first value to qualify as a match is the one the case uses and the rest are ignored.  You can do the same thing with a bunch of <code><span class="keyword">if</span><span class="punct">..</span><span class="keyword">elsif</span></code> statements, but it&#8217;s wordier.</p>


<div class='example'><pre><code> <span class="keyword">case</span> <span class="ident">year</span>
 <span class="keyword">when</span> <span class="number">1894</span>
   <span class="punct">&quot;</span><span class="string">Born.</span><span class="punct">&quot;</span> 
 <span class="keyword">when</span> <span class="number">1895</span><span class="punct">..</span><span class="number">1913</span>
   <span class="punct">&quot;</span><span class="string">Childhood in Lousville, Winston Co., Mississippi.</span><span class="punct">&quot;</span> 
 <span class="keyword">else</span>
   <span class="punct">&quot;</span><span class="string">No information about this year.</span><span class="punct">&quot;</span> 
 <span class="keyword">end</span></code></pre></div>

	<p>Is identical to:</p>


<div class='example'><pre><code> <span class="keyword">if</span> <span class="number">1894</span> <span class="punct">===</span> <span class="ident">year</span>
   <span class="punct">&quot;</span><span class="string">Born.</span><span class="punct">&quot;</span> 
 <span class="keyword">elsif</span> <span class="number">1895</span><span class="punct">..</span><span class="number">1913</span> <span class="punct">===</span> <span class="ident">year</span>
   <span class="punct">&quot;</span><span class="string">Childhood in Lousville, Winston Co., Mississippi.</span><span class="punct">&quot;</span> 
 <span class="keyword">else</span>
   <span class="punct">&quot;</span><span class="string">No information about this year.</span><span class="punct">&quot;</span> 
 <span class="keyword">end</span></code></pre></div>

	<p>The <strong>triple equals</strong> is a length of velvet rope, checking values much like the double equals.  It&#8217;s just: the triple equals is a longer rope and it sags a bit in the middle.  It&#8217;s not as strict, it&#8217;s a bit more flexible.</p>


	<p>Take the Ranges above.  <code><span class="punct">(</span><span class="number">1895</span><span class="punct">..</span><span class="number">1913</span><span class="punct">)</span></code> isn&#8217;t at all <strong>equal</strong> to <code><span class="number">1905</span></code>.  No, the Range <code><span class="punct">(</span><span class="number">1895</span><span class="punct">..</span><span class="number">1913</span><span class="punct">)</span></code> is only truly <strong>equal</strong> to any other Range <code><span class="punct">(</span><span class="number">1895</span><span class="punct">..</span><span class="number">1913</span><span class="punct">)</span></code>.  In the case of a Range, the triple equals cuts you a break and lets the Integer <code><span class="number">1905</span></code> in, because even though it&#8217;s not <strong>equal</strong> to the Range, it&#8217;s <strong>included</strong> in the set of Integers represented by the Range.  Which is good enough in some cases, such as the timeline I put together earlier.</p>


	<p>Which actually looked like a timeline, didn&#8217;t it?  I mean, sure, <code><span class="ident">dr_chams_timeline</span></code> method is code, but it does read like a timeline, clean and lovely.</p>


	<p><img src="../images/elderly-2.gif" title="What research revealed." alt="What research revealed." /></p>

    
    
        
        <div class="sidebar">
        <h1>sidebar!</h1>
        
        <h2>Caring For You.  And Your Wellness.</h2>
        

        <p>I need you to be in a good mental state for the latter half of this book. Now is the time to begin conditioning you.</p>


	<p>Let&#8217;s start with some deep breathing.  Give me a good deep breath and count to four with me.</p>


	<p>Here we go.  1.  2.  3.  4.   Now exhale.  You can feel your eyes.  Good, that&#8217;s exactly it.</p>


	<p>Now let&#8217;s take a deep breath and, in your mind, draw a hippopotamus as fast as you can.  Quick quick.  His legs, his folds, his marshmallow teeth.  Okay, done.  Now exhale.</p>


	<p>Take another deep breath and hold it tight.  As you hold it tightly in your chest, imagine the tightness is shrinking you down into a bug. You&#8217;ve held your breath so hard that you&#8217;re an insect.  And all the other bugs saw you shrink and they loved the stunt.  They&#8217;re clapping and rubbing their feelers together madly.   But you had an apple in your hand when you were big and it just caught up with you, crushed the whole crowd.  You&#8217;re dead, too.  Now exhale.</p>


	<p>Give me a solid deep breath and imagine you live in a town where everything is made of telephone cords.  The houses are all telephone cords, the shingles, the rafters.  The doorways are a thick mass of telephone cords which you simply thrust yourself through.  When you go to bed, the bedspread is telephone cords.  And the mattress and box springs are telephone cords, too.  Like I said, everything is made out of telephone cords.  The telephone itself is made of telephone cords.  But the telephone cord going to the telephone is made out of bread and a couple sticks.  Now exhale.</p>


	<p>Breathe in.  1.  2.  3.  4.  Breathe out.</p>


	<p>Breath in.  1.  2.  Another short breath in.  3.  4.  Imagine both of your hands snapping off at the wrists and flying into your computer screen and programming it from the inside.  Exhale.</p>


	<p>Big, big deep breath.  Deep down inside you there is a submarine. It has a tongue.  Exhale.</p>


	<p>Breathe through your nostrils.  Deep breath.  Filter the air through your nostrils.  Breathing through the nostrils gives you quality air. Your nostrils flare, you are taking breaths of nature&#8217;s air, the way God intended.  Imagine a floppy disk drive clogged up with orphans. And while it chokes on orphans, you have good, wholesome God&#8217;s  breath in your lungs.  But that pleasurable, life-giving air will become a powerful toxin if held too long.  <em>Hurry, exhale God and nature&#8217;s air!</em></p>


	<p>Now, you will wake up, smoothing out the creases of this page in your web browser.  You will have full recollection of your whole life and not forgetting any one of the many  adventures you have had in your life.  You will feel rich and renewed and expert.  You will have no remembrance of this short exercise, you will instead remember teaching a rabbit to use scissors from a great distance.</p>


	<p>And as you will wake up with your eyes directed to the top of this exercise, you will begin again.  But this time, try to imagine that even <em>your shadow</em> is a telephone cord.</p>
        <h1>sidebar!</h1>
        </div>

    
    

        <h3>But Was He Sick??</h3>


	<p>You know, he had such bad timing.  He was scattered as a novelist, but his ventures into alchemy were very promising.  He had an elixir of goat&#8217;s milk and sea salt that got rid of leg aches. One guy even grew an inch on a thumb he&#8217;d lost.  He had an organic health smoke that smelled like foot but gave you night vision.  He was working on something called Liquid Ladder, but I&#8217;ve never seen or read anything else about it.  It can&#8217;t have been for climbing.  Who knows.</p>


	<p>One local newspaper actually visited Dr. Cham.  Their book reviewer gave him four stars. Really.  She did an article on him.  Gave him a rating.</p>


	<p>Just know that Dr. N. Harold Cham felt terrible about his niece.  He felt the shock treatment would work.  The polio probably would have killed her anyway, but he took the chance.</p>


	<p>On Sept. 9, 1941, after sedating her with a dose of phenacetin in his private operating room, he attached the conducting clips to Hannah&#8217;s nose, tongue, toes, and elbows.  Assisted by his apprentice, a bespeckled undergraduate named Marvin Holyoake, they sprinkled the girl with the flakes of a substance the doctor called <em>opus magnum</em>.  A white powder gold which would carry the current and blatantly energize the girl, forcing her blood to bloom and fight and vanquish.</p>


	<p>But how it failed, oh, and how, when the lever was tossed, she arched and kicked <del>- and  <strong><span class="caps">KABLAM</span>!</strong> -</del> and <strong><span class="caps">BLOY</span>-OY-OY-KKPOY!</strong>  Ringlets of hair and a wall of light, and the  bell of death rang.  The experiment collapsed in a dire plume of smoke and her innocence (<em>for weeks, everyone started out with, &#8220;And she will never have the chance&#8230;&#8221;</em>) was a great pit in the floor and in their lungs.</p>


	<p>To Hannah, I code.</p>


<div class='example'><pre><code> <span class="ident">opus_magnum</span> <span class="punct">=</span> <span class="constant">true</span>
 <span class="keyword">def </span><span class="method">save_hannah</span>
   <span class="ident">success</span> <span class="punct">=</span> <span class="ident">opus_magnum</span>
 <span class="keyword">end</span></code></pre></div>

	<p>A method is its own island.  And what goes on inside is unaffected by the simple variables around it. Dr. Cham couldn&#8217;t breach the illness of his niece, no more than an <code><span class="ident">opus_magnum</span></code> variable can penetrate the steely exterior of a method.</p>


	<p>Should we run the <code><span class="ident">save_hannah</span></code> method, Ruby will squawk at us, claiming it sees no <code><span class="ident">opus_magnum</span></code>.</p>


	<p>I&#8217;m talking about <strong>scope</strong>.  Microscopes narrow and magnify your vision.  Telescopes extend the range of your vision.  In Ruby, <strong>scope</strong> refers to a field of vision inside methods and blocks.</p>


	<p>A method&#8217;s <code><span class="keyword">def</span></code> statement opens its vision.  Variable names introduced there will be seen by the method and kept meaningful until its <code><span class="keyword">end</span></code> closes its eyes.  You can pass data into a method by using arguments and data can be returned from the method, but the names used inside the method are only good for its scope.</p>


	<p>Some variables have wider scope.  Global variables like <code><span class="global">$LOAD_PATH</span></code>, which start with a <strong>cash</strong> symbol, are available in any scope.  Instance variables like <code><span class="attribute">@names</span></code>, which start with an <strong>at</strong> are available anywhere inside a class scope.  Same goes for class variables like <code><span class="attribute">@@tickets</span></code>. Class and instance variables will be explored in a moment.</p>


	<p>Blocks have scope, but it&#8217;s a bit fuzzier.  More flexible.</p>


<div class='example'><pre><code> <span class="ident">verb</span> <span class="punct">=</span> <span class="punct">'</span><span class="string">rescued</span><span class="punct">'</span>
 <span class="punct">['</span><span class="string">sedated</span><span class="punct">',</span> <span class="punct">'</span><span class="string">sprinkled</span><span class="punct">',</span> <span class="punct">'</span><span class="string">electrocuted</span><span class="punct">'].</span>
 <span class="ident">each</span> <span class="keyword">do</span> <span class="punct">|</span><span class="ident">verb</span><span class="punct">|</span>
   <span class="ident">puts</span> <span class="punct">&quot;</span><span class="string">Dr. Cham </span><span class="punct">&quot;</span> <span class="punct">+</span> <span class="ident">verb</span> <span class="punct">+</span> <span class="punct">&quot;</span><span class="string"> his niece Hannah.</span><span class="punct">&quot;</span> 
 <span class="keyword">end</span>
 <span class="ident">puts</span> <span class="punct">&quot;</span><span class="string">Finally, Dr. Cham </span><span class="punct">&quot;</span> <span class="punct">+</span> <span class="ident">verb</span> <span class="punct">+</span> <span class="punct">&quot;</span><span class="string"> his niece Hannah.</span><span class="punct">&quot;</span></code></pre></div>

	<p>The block <em>iterates</em> (spins, cycles) through each of the Doctor&#8217;s actions.  The <code><span class="ident">verb</span></code> variable changes with each pass.  In one pass, he&#8217;s sedating.  In the next, he&#8217;s powdering.  Then, he&#8217;s electrocuting.</p>


	<p>So, the question is: after the block&#8217;s over, will he have rescued Hannah?</p>


<div class='example'><pre class="result"> Dr. Cham sedated his niece Hannah.
 Dr. Cham sprinkled his niece Hannah.
 Dr. Cham electrocuted his niece Hannah.
 Finally, Dr. Cham rescued his niece Hannah.
</pre></div>

	<p>Blocks are allowed to see variables in the vicinity.  But this block has its own <code><span class="ident">verb</span></code> variable which is updated each cycle.  When the block completed and its tiny life  ended, the outer <code><span class="ident">verb</span></code> stayed the same as it were before.</p>

	<p>This is the nature of local variables.  When its <strong>scope</strong> closes, the variable goes away with it.  Say that <code><span class="ident">verb</span></code> wasn&#8217;t used before the block.</p>


<div class='example'><pre><code> <span class="punct">['</span><span class="string">sedated</span><span class="punct">',</span> <span class="punct">'</span><span class="string">powdered</span><span class="punct">',</span> <span class="punct">'</span><span class="string">electrocuted</span><span class="punct">'].</span>
 <span class="ident">each</span> <span class="keyword">do</span> <span class="punct">|</span><span class="ident">verb</span><span class="punct">|</span>
   <span class="ident">puts</span> <span class="punct">&quot;</span><span class="string">Dr. Cham </span><span class="punct">&quot;</span> <span class="punct">+</span> <span class="ident">verb</span> <span class="punct">+</span> <span class="punct">&quot;</span><span class="string"> his niece Hannah.</span><span class="punct">&quot;</span> 
 <span class="keyword">end</span>
 <span class="ident">puts</span> <span class="punct">&quot;</span><span class="string">Yes, Dr. Cham </span><span class="punct">&quot;</span> <span class="punct">+</span> <span class="ident">verb</span> <span class="punct">+</span> <span class="punct">&quot;</span><span class="string"> his niece Hannah.</span><span class="punct">&quot;</span></code></pre></div>

	<p>Pulls an error: <code><span class="ident">undefined</span> <span class="ident">local</span> <span class="ident">variable</span> <span class="keyword">or</span> <span class="ident">method</span> `<span class="ident">verb</span><span class="punct">'</span><span class="string"></span></code>.  Poof.  The inner variable won't leak outside its scope.</p>


	<p>It must be something difficult, even for a great scientist, to carry away the corpse of a young girl whose dress is still starched and embroidered, but whose mouth is darkly clotted purple at the corners.   In Dr. Cham&#8217;s journal, he writes that he was tormented by her ghost, which glistened gold and scorched lace.  His delusions grew and he ran from hellhounds and massive vengeful, angelic hands.</p>


	<p>Only weeks later, he was gone, propelled from these regrets, vanishing in the explosion  that lifted him from the planet.</p>


	<p>And even as you are reading this now, sometime in these moments, the bell jar craft of our lone Dr. Cham touched down upon a distant planet after a sixty year burn.   As the new world came into view, as the curvature of the planet widened,  as the bell jar whisked through the upset heavens, tearing through sheets of aurora and solar wind, Dr. Cham&#8217;s eyes were shaken open.</p>


	<p><img src="../images/dr.cham-2.gif" title="Safe landing.  Amazement." alt="Safe landing.  Amazement." /></p>


	<p>What you are witnessing is the landing of Dr. Cham on the planet Endertromb.  From what I can gather, he landed during the cusp of the Desolate Season, a time when there really isn&#8217;t much happening on the planet.  Most of the inhabitants find their minds locked into a listless hum which causes them to disintegrate into just vapid ghosts of one-part-wisdom and three-parts-steam for a time.</p>


	<p>My modest grasp of the history and climate of Endertromb has been assembled from hanging around my daughter&#8217;s organ instructor, who grew up on the planet.</p>


	<p><img src="../images/elderly-3.gif" title="Dead husbands could destroy the Doctor." alt="Dead husbands could destroy the Doctor." /></p>


	<p>I frequently drill my daughter&#8217;s organ instructor in order to ensure that he can keep appointments adequately.  That he can take house calls at odd hours and promptly answer emergency calls. When he finally revealed to me that he was an alien whose waking day consisted of five-hundred and forty waking hours, I was incredibly elated and opened a contractual relationship with him which will last into 2060.</p>


	<p>For three days (by his pocket watch&#8217;s account), Dr. Cham travelled the dark shafts of air, sucking the dusty wind of the barren planet. But on the third day, he found the Desolate Season ending and he awoke to a brilliant vista,  decorated with spontaneous apple blossoms and dewy castle tiers.</p>

    
    
        
        <a name="section2" />
        <h2>2. A Castle Has Its Computers</h2>

        <p><img src="../images/dr.cham-3.jpg" title="The panoramic vales of Sedna on Endertromb." alt="The panoramic vales of Sedna on Endertromb." /></p>


	<p>Our intrepid Doctor set off for the alien castle, dashing through the flowers.  The ground belted past his heels.  The castle inched up the horizon.  He desired a stallion, but no stallion appeared.  And that&#8217;s how he discovered that the planet wouldn&#8217;t read his mind and answer his wishes.</p>


	<p>As my daughter&#8217;s organ instructor explained it, however, the planet <strong>could read minds</strong> and it <strong>could grant wishes</strong>.  Just not both at the same time.</p>


	<p>One day as I quizzed the organ maestro, he sketched out the following Ruby code on a pad of cheese-colored paper.  (And queer cheese smells were coming from somewhere, I can&#8217;t say where.)</p>


<div class='example'><pre><code> <span class="ident">require</span> <span class="punct">'</span><span class="string">endertromb</span><span class="punct">'</span>
 <span class="keyword">class </span><span class="class">WishMaker</span>
   <span class="keyword">def </span><span class="method">initialize</span>
     <span class="attribute">@energy</span> <span class="punct">=</span> <span class="ident">rand</span><span class="punct">(</span> <span class="number">6</span> <span class="punct">)</span>
   <span class="keyword">end</span>
   <span class="keyword">def </span><span class="method">grant</span><span class="punct">(</span> <span class="ident">wish</span> <span class="punct">)</span>
     <span class="keyword">if</span> <span class="ident">wish</span><span class="punct">.</span><span class="ident">length</span> <span class="punct">&gt;</span> <span class="number">10</span> <span class="keyword">or</span> <span class="ident">wish</span><span class="punct">.</span><span class="ident">include?</span> <span class="punct">'</span><span class="string"> </span><span class="punct">'</span>
       <span class="keyword">raise</span> <span class="constant">ArgumentError</span><span class="punct">,</span> <span class="punct">&quot;</span><span class="string">Bad wish.</span><span class="punct">&quot;</span> 
     <span class="keyword">end</span>
     <span class="keyword">if</span> <span class="attribute">@energy</span><span class="punct">.</span><span class="ident">zero?</span>
       <span class="keyword">raise</span> <span class="constant">Exception</span><span class="punct">,</span> <span class="punct">&quot;</span><span class="string">No energy left.</span><span class="punct">&quot;</span> 
     <span class="keyword">end</span>
     <span class="attribute">@energy</span> <span class="punct">-=</span> <span class="number">1</span>
     <span class="constant">Endertromb</span><span class="punct">::</span><span class="ident">make</span><span class="punct">(</span> <span class="ident">wish</span> <span class="punct">)</span>
   <span class="keyword">end</span>
 <span class="keyword">end</span></code></pre></div>

	<p>This is the wish maker.</p>


	<p>Actually, no, this is a <strong>definition for a wish maker.</strong>  To Ruby, it&#8217;s a <strong>class definition</strong>. The code describes how a certain <strong>object</strong> will work.</p>


	<p>Each morning, the wish maker starts out with up to five wishes available for granting. A new <code><span class="constant">WishMaker</span></code> is created at sun up.</p>


<div class='example'><pre><code> <span class="ident">todays_wishes</span> <span class="punct">=</span> <span class="constant">WishMaker</span><span class="punct">.</span><span class="ident">new</span></code></pre></div>

	<p>The <code><span class="ident">new</span></code> method is a class method which creates a new, blank object.  It also calls the object&#8217;s <code><span class="ident">initialize</span></code> method automatically.  In the <code><span class="constant">WishMaker</span></code> definition, you&#8217;ll see the <code><span class="ident">initalize</span></code> method, which contains a single line of code: <code><span class="attribute">@energy</span> <span class="punct">=</span> <span class="ident">rand</span><span class="punct">(</span> <span class="number">6</span> <span class="punct">)</span></code>.</p>


	<p>The <code><span class="ident">rand</span><span class="punct">(</span> <span class="number">6</span> <span class="punct">)</span></code> picks a number between 0 and 5.  This number will represent the number of wishes left in the day.  So, occassionally there are no wishes available from the wish maker.</p>


	<p>The random number is assigned to an <strong>instance variable</strong> which is named <code><span class="attribute">@energy</span></code>. This instance variable will be available any time throughout the class.  The variable can&#8217;t be used outside the <strong>scope</strong> of the class.</p>


	<p>In chapter three, we briefly looked at instance variables and decided to respect them as <strong>attributes</strong>.  (The <strong>at symbol</strong> could mean <strong>attribute</strong>.)  Instance variables can be used to store any kind of information, but they&#8217;re most often used to store bits of information about the object represented by the class.</p>


	<p>In the above case, each wish maker for the day has its own energy level.  If the wish maker were a machine, you might see a gauge on it that points to the energy left inside. The <code><span class="attribute">@energy</span></code> instance variable is going to act as that gauge.</p>


<div class='example'><pre><code> <span class="ident">todays_wishes</span> <span class="punct">=</span> <span class="constant">WishMaker</span><span class="punct">.</span><span class="ident">new</span>
 <span class="ident">todays_wishes</span><span class="punct">.</span><span class="ident">grant</span><span class="punct">(</span> <span class="punct">&quot;</span><span class="string">antlers</span><span class="punct">&quot;</span> <span class="punct">)</span></code></pre></div>

	<p>Okay, step back and ensure you understand the example here.  The <code><span class="constant">WishMaker</span></code> class is an outline we&#8217;ve laid out for how the whole magic wish program works.  It&#8217;s not the <em>actual</em> genie in the bottle, it&#8217;s the paperwork behind the scenes.  It&#8217;s the rules and obligations the genie has to live by.</p>


	<p>It&#8217;s <code><span class="ident">todays_wishes</span></code> that&#8217;s the genie in the bottle.  And here we&#8217;re giving it a wish to grant. Give us antlers, genie.  (If you really get antlers from this example, I don&#8217;t want to hear about it.  Go leap in meadows with your own kind now.)</p>


	<p>In the last chapter, the drill was: Ruby has two halves.</p>


	<ol>
	<li>Defining things.</li>
		<li>Putting those things into action.</li>
	</ol>


	<p>What are the actions in Ruby?  Methods.  And now, you&#8217;re having a lick of the definition language built-in to Ruby.  Method definitions using <code><span class="keyword">def</span></code>.  Class definitions using <code><span class="keyword">class</span></code>.</p>


	<p>At this point in your instruction, it&#8217;s easier to understand that <strong>everything in Ruby is an object.</strong></p>


<div class='example'><pre><code> <span class="ident">number</span> <span class="punct">=</span> <span class="number">5</span>
 <span class="ident">print</span> <span class="ident">number</span><span class="punct">.</span><span class="ident">next</span>                  <span class="comment"># prints '6'</span>

 <span class="ident">phrase</span> <span class="punct">=</span> <span class="punct">'</span><span class="string">wishing for antlers</span><span class="punct">'</span>
 <span class="ident">print</span> <span class="ident">phrase</span><span class="punct">.</span><span class="ident">length</span>                <span class="comment"># prints '19'</span>

 <span class="ident">todays_wishes</span> <span class="punct">=</span> <span class="constant">WishMaker</span><span class="punct">.</span><span class="ident">new</span>
 <span class="ident">todays_wishes</span><span class="punct">.</span><span class="ident">grant</span><span class="punct">(</span> <span class="punct">&quot;</span><span class="string">antlers</span><span class="punct">&quot;</span> <span class="punct">)</span></code></pre></div>

	<p>And, consequently, each object has a class behind the scenes.</p>


<div class='example'><pre><code> <span class="ident">print</span> <span class="number">5</span><span class="punct">.</span><span class="keyword">class                       </span><span class="class">#</span> <span class="ident">prints</span> <span class="punct">'</span><span class="string">Integer</span><span class="punct">'</span>
 <span class="ident">print</span> <span class="punct">'</span><span class="string">wishing for antlers</span><span class="punct">'.</span><span class="keyword">class   </span><span class="class">#</span> <span class="ident">prints</span> <span class="punct">'</span><span class="string">String</span><span class="punct">'</span>
 <span class="ident">print</span> <span class="constant">WishMaker</span><span class="punct">.</span><span class="ident">new</span><span class="punct">.</span><span class="keyword">class           </span><span class="class">#</span> <span class="ident">prints</span> <span class="punct">'</span><span class="string">WishMaker</span><span class="punct">'</span></code></pre></div>

	<p>Dr. Cham never saw the wish maker as he hustled across the landspace. It lay far beyond his landing in the valley of Sedna.  Down sheer cliffs stuffed with layers of thicket, where you might toss your wish (written on a small 1&#8221; x 6&#8221; slip), down into the gaping void.  Hopefully it will land on a lizard&#8217;s back, sticking to its spindly little horn.</p>


	<p>And let&#8217;s say your wish makes it that far.  Well, then, <em>down the twisted wood</em> goes the skinny salamander, scurrying through the decaying churches which had been <strong>pushed</strong> over that steep canyon ledge once and for all.  And the expired priest inside, <em>who weathered the fall</em> as well, will kill the little amphibian <del>- strangle it to death with a blessed gold chain -</del> and save it for the annual <em>Getting To Know You</em> breakfast.  He&#8217;ll step on your precious little wish and, when the <strong>thieves come</strong>, that slip will still be there, stuck on his sole.  Of course, the thieves&#8217; <strong>preferred method of torture</strong> is to cut a priest in thin deli-shaved slices <em>from top to bottom</em>.  Who can cull evidence from that?  And when they chop that last thin slice of shoe sole, they&#8217;ll have that <strong>rubber scalp</strong> in hand for <em>good luck</em> and <em>good times</em>. But they <strong>canoe</strong> much too hard, these thieves.  They slap their paddles swiftly in the current to get that great <em>outboard motor mist</em> going.  But the shoe sole is <em>on a weak chain</em>, tied to one man&#8217;s belt.  And a <strong>hairy old carp</strong> <em>leaps, latches</em> on to that minute fraction of footwear.  And the thieves <em>can try</em>, but they don&#8217;t see <em>underwater</em>.  If they could, they&#8217;d see that <strong>mighty cable</strong>, packed with millions of <em>needly</em> fiber optics.  Indeed, <strong>that fish is a peripheral plugged</strong> right into the <em>core workings</em> of the planet Endertromb.  <strong>All it takes is one swallow</strong> from that fish <strong>and your wish is home free!</strong></p>


	<p>And that&#8217;s how wishes come true for children in this place.</p>


	<p>Once my daughter&#8217;s organ instructor had drawn up the class for the wish maker, he then followed with a class for the planet&#8217;s mind reader.</p>


<div class='example'><pre><code> <span class="ident">require</span> <span class="punct">'</span><span class="string">endertromb</span><span class="punct">'</span>
 <span class="keyword">class </span><span class="class">MindReader</span>
   <span class="keyword">def </span><span class="method">initialize</span>
     <span class="attribute">@minds</span> <span class="punct">=</span> <span class="constant">Endertromb</span><span class="punct">::</span><span class="ident">scan_for_sentience</span>
   <span class="keyword">end</span>
   <span class="keyword">def </span><span class="method">read</span>
     <span class="attribute">@minds</span><span class="punct">.</span><span class="ident">collect</span> <span class="keyword">do</span> <span class="punct">|</span><span class="ident">mind</span><span class="punct">|</span>
        <span class="ident">mind</span><span class="punct">.</span><span class="ident">read</span>
     <span class="keyword">end</span>
   <span class="keyword">end</span>
 <span class="keyword">end</span></code></pre></div>

	<p>Much as you&#8217;ve seen before, the <code><span class="ident">initalize</span></code> happens when a new <code><span class="constant">MindReader</span></code> object is created. This <code><span class="ident">initialize</span></code> gathers scans the planet for mindshare.  It looks like these minds are stored in an array, since they are later iterated over using the <code><span class="ident">collect</span></code> method.</p>


	<p>Both the wish maker and the mind reader refer to a class named <code><span class="constant">Endertromb</span></code>.  This class is stored in a file <code><span class="ident">endertromb</span><span class="punct">.</span><span class="ident">rb</span></code>, which is loaded with the code: <code><span class="ident">require</span> <span class="punct">'</span><span class="string">endertromb</span><span class="punct">'</span></code>. Often you&#8217;ll use other classes to accomplish part of your task.  Most of the latter half of this book will explore the wide variety of helpful classes that can be loaded in Ruby.</p>


	<h3>Dr. Cham Ventures Inside</h3>


	<p>But as Dr. Cham neared the castle, although the planet was aware of his thoughts, sensing his wonderment and anticipation, all Dr. Cham felt was deadness.  He tromped up the steps of its open gate and through the entrance of the most beautiful architecture and was almost certain it was deserted.</p>


	<p>For a while he knocked.  Which paid off.</p>


	<p><img src="../images/castle-1.jpg" title="Blocky whale greeting." alt="Blocky whale greeting." /></p>


	<p>He watched the baby whale rise like a determined balloon.  He marvelled at his first alien introduction and felt some concern that it had passed so quickly.  Well, he would wait inside.</p>


	<p>As he stepped through the castle door, he felt fortunate that the door hadn&#8217;t been answered by  a huge eagle with greedy talons, eager to play.  Or a giant mouse head.  Or even a man-sized hurricane.   Just a tubby little choo-choo whale.</p>


	<p>&#8220;Not a place to sit down in this castle,&#8221; he said.</p>


	<p>At first, he had thought he had just entered a very dim hallway, but as his eyes adjusted, he saw the entrance extended into a tunnel.  The castle door had opened right into a passage made of  long, flat slabs of rock.  Some parts were congruous and resembled a corridor.  Other parts  narrowed, and even tilted, then finally tipped away out of view.</p>


	<p>The passage was lit by small doorless refrigerators, big enough to hold an armful of cabbage,  down by his feet.  He peered inside one, which was hollow, illuminated along all sides, and turning out ice shards methodically.</p>


	<p>He pawed the ice chips, which clung dryly to his fingertips, and he scrubbed his hands in the ice.  Which left some muddy streaks on his hands, but satisfied a small part of his longing to bathe. How long had it been?  Ten years?  Thirty?</p>


	<p>Along the passage, long tubes of cloth cluttered some sections.  Later, bright pixel matter in porcelain scoops and buckets.</p>


	<p>He happened upon a room which had been burrowed out of the tunnel which had a few empty turtle shells on the ground and a large illuminated wall.  He stared into the room, bewildered.  What could this be?  In one state of mind, he thought of having a seat on a shell.  This could be the entrace at last, some kind of receiving room.  On the other hand, spiders could pour out of the shell&#8217;s hollow when he sat.  He moved on.</p>


	<h3>Meal in a Castle&#8217;s Pocket</h3>


	<p>As he journeyed along the passageways (for the central tunnel forked and joined larger, vacuous caverns), he picked up themes in some locations.  Groups of rooms infested with pumping machinery.  Cloth and vats of glue dominated another area.  He followed voices down a plush, pillowed cavity, which led him to a dead end: a curved wall with a small room carved at eye-level.</p>


	<p>He approached the wall and, right in the cubby hole, were two aardvarks eating at a table.</p>


	<p>They gazed at him serenely, both munching on some excavated beetle twice their size, cracked  open and frozen on its back on the table.</p>


	<p>&#8220;Hello, little puppets,&#8221; he said, and they finished their bites and kept looking with their forks held aloof.</p>


	<p>&#8220;I wish my niece Hannah were here to meet you,&#8221; he told the attentive miniature aardvarks.  &#8220;She&#8217;d think you were an intricate puppet show.&#8221;  He peered in at the dining area, shelves with sets of plates, hand towels.  Half of a tiny rabbit was jutting out from the top a machine, creamy red noodles were spilling out underneath it.  A door at the back of the room hung ajar.  Dr. Cham could see a flickering room with chairs and whirring motors through the door.</p>


	<p>&#8220;Any child would want this dollhouse,&#8221; he said.  &#8220;Hannah, my niece, as I mentioned, she has a wind-up doll that sits at a spindle and spins yarn.  It&#8217;s an illusion, of course.   The doll produces no yarn at all.&#8221;</p>


	<p>One of the aardvarks opened a trapdoor in the floor and pressed a button down inside, which lit. Then, a small film projector slowly came up on a rod.  The other aardvark sat and watched Dr. Cham.</p>


	<p>&#8220;But Hannah still reaches down into the dollhouse and collects all the imaginary yarn into a bundle.  Which she takes to her mother, my sister, who is very good at humoring Hannah. She sews a dress to the doll&#8217;s dimensions, which Hannah takes back to the doll.</p>


	<p>&#8220;And she tells the doll, &#8216;Here, look, your hard work and perserverance has resulted in this beautiful dress. You can now accept the Chief of Police&#8217;s invitation to join him tonight at the Governor&#8217;s Mansion.&#8217;  And she has a doll in a policeman&#8217;s uniform who plays the part of the Chief.  He&#8217;s too scrawny to be an actual Chief, that would require quite a bit of plastic.&#8221;</p>


	<p>The aardvark responsible for the film projector loaded a reel and aimed the projector at the back wall.  The film spun to life and the aardvark took a seat.  A green square appeared on the wall.  The attentive aardvark stared at Dr. Cham still.</p>


	<p>&#8220;Your films are coloured,&#8221; said Dr. Cham.  &#8220;What a lovely, little life.&#8221;</p>


	<p>The film played on: a blue square.  Then, a red circle.  Then, an orange square.  The attentive aardvark turned away, watched the screen change to a pink triangle, and both aardvarks resumed eating.</p>


	<p>A purple star.  A red square.  With quietness settling, Dr. Cham could hear notes droning from the projector.  Like a slow, plodding music box trying to roll its gears along the train tracks.</p>


	<p>&#8220;Yes, enjoy your supper,&#8221; said Dr. Cham and he politely tipped his head away, marching back up the path he&#8217;d taken.</p>


	<h3>Another Dead End Where Things Began</h3>


	<p>He found himself lost in the castle&#8217;s tunnels.  Nothing looked familiar.  He wasn&#8217;t worried much, though.  He was on another planet.  He would be lost regardless.</p>


	<p>He wound through the tunnels, attempting to recall his paths, but far too interested in exploring to keep track of his steps.  He followed a single tunnel deep, down, down, which slanted so steeply that he had to leap across ledges and carefully watch his footholds. The gravity here seemed no different than Earth.  His legs were pulled into slides just as easily.</p>


	<p>Although he had no absolute way of knowing where he was, he felt certain that he had left the castle&#8217;s boundaries.  This deep, this long of a walk.  It had been an hour since he&#8217;d entered through the door.  And, as the tunnel wound back up, he was sure that he would emerge into a new dwelling, perhaps even a manhole which he could peek out from and see the castle.  Perhaps he shouldn&#8217;t have come so far down this route.  He hoped nothing was hibernating down here.</p>


	<p>The tunnel came to a stop.   A dark, dead end.</p>


	<p><img src="../images/dr.cham-4.gif" title="At the end of the tunnels: a computer and a book." alt="At the end of the tunnels: a computer and a book." /></p>


	<p>He had time.  So he read the book.  He read of the foxes and their pursuit of the porcupine who stole their pickup truck.  He read of the elf and the ham.  He saw the pictographs of himself and found he could really relate to his own struggles.  He even learned Ruby.  He saw how it all ended.</p>


	<p>Were I him, I couldn&#8217;t have stomached it.  But he did.  And he pledged in his bosom to see things out just as they happened.</p>


	<p>On the computer monitor, Dr. Cham saw the flashing <code><span class="ident">irb</span></code> prompt.  Like Dr. Cham, you might recognize the <code><span class="ident">irb</span></code> prompt from <a href="expansion-pak-1.html">The Tiger&#8217;s Vest</a> (the first expansion pak to this book, which includes a basic introduction to Interactive Ruby.)</p>


	<p>Whereas he had just been exploring tunnels by foot, he now explored the machine&#8217;s setup with the prompt.  He set the book back where he had found it.  He didn&#8217;t need it anymore.  This was all going to happen whether he used it or not.</p>


	<p>He started with:</p>


<div class='example'><pre><code> <span class="ident">irb</span><span class="punct">&gt;</span> <span class="constant">Object</span><span class="punct">::</span><span class="ident">constants</span>
   <span class="punct">=&gt;</span> <span class="punct">[&quot;</span><span class="string">Marshal</span><span class="punct">&quot;,</span> <span class="punct">&quot;</span><span class="string">String</span><span class="punct">&quot;,</span> <span class="punct">&quot;</span><span class="string">Dir</span><span class="punct">&quot;,</span> <span class="punct">&quot;</span><span class="string">LoadError</span><span class="punct">&quot;,</span> <span class="punct">&quot;</span><span class="string">Float</span><span class="punct">&quot;,</span> <span class="punct">...</span> <span class="keyword">and</span> <span class="ident">so</span> <span class="ident">on</span> <span class="punct">]</span></code></pre></div>

	<p>This command lists all the top-level constants.  Classes are also listed as constants, so this list can be great to see what&#8217;s loaded into Ruby at any time.</p>


	<p>He scanned the list for anything unfamiliar.  Any classes which didn&#8217;t come with Ruby. <code><span class="constant">Marshal</span></code>, <code><span class="constant">String</span></code>, <code><span class="constant">Dir</span></code>, <code><span class="constant">LoadError</span></code>, <code><span class="constant">Float</span></code>.  Each of those came with Ruby.</p>


	<p>But further down the list:</p>


<div class='example'><pre><code> <span class="punct">...</span> <span class="punct">&quot;</span><span class="string">Struct</span><span class="punct">&quot;,</span> <span class="punct">&quot;</span><span class="string">Values</span><span class="punct">&quot;,</span> <span class="punct">&quot;</span><span class="string">Time</span><span class="punct">&quot;,</span> <span class="punct">&quot;</span><span class="string">Elevator</span><span class="punct">&quot;,</span> <span class="punct">&quot;</span><span class="string">Range</span><span class="punct">&quot;</span> <span class="punct">...</span></code></pre></div>

	<p><em>Elevator?</em>  Exactly the kind of class to poke around with.  He had a go.</p>


<div class='example'><pre><code> <span class="ident">irb</span><span class="punct">&gt;</span> <span class="constant">Elevator</span><span class="punct">::</span><span class="ident">methods</span>
   <span class="punct">=&gt;</span> <span class="punct">[&quot;</span><span class="string">method</span><span class="punct">&quot;,</span> <span class="punct">&quot;</span><span class="string">freeze</span><span class="punct">&quot;,</span> <span class="punct">&quot;</span><span class="string">allocate</span><span class="punct">&quot;,</span> <span class="punct">...</span> <span class="ident">another</span> <span class="ident">long</span> <span class="ident">list</span> <span class="punct">...</span> <span class="punct">]</span>
 <span class="ident">irb</span><span class="punct">&gt;</span> <span class="constant">Elevator</span><span class="punct">::</span><span class="ident">class_variables</span>
   <span class="punct">=&gt;</span> <span class="punct">['</span><span class="string">@@diagnostic_report</span><span class="punct">',</span> <span class="punct">'</span><span class="string">@@power_circuit_active</span><span class="punct">',</span> <span class="punct">'</span><span class="string">@@maintenance_password</span><span class="punct">']</span>
 <span class="ident">irb</span><span class="punct">&gt;</span> <span class="constant">Elevator</span><span class="punct">::</span><span class="ident">constants</span>
   <span class="punct">=&gt;</span> <span class="punct">[]</span></code></pre></div>

	<p>Looks like the <code><span class="constant">Elevator</span></code> class had plenty of methods.  Most of these looked like they were the same methods every object has in Ruby.  For example, <code><span class="ident">method</span></code>, <code><span class="ident">freeze</span></code> and <code><span class="ident">allocate</span></code> come with every class in Ruby.  (<code><span class="constant">Elevator</span><span class="punct">::</span><span class="ident">freeze</span></code> would keep the <code><span class="constant">Elevator</span></code> class from being changed.  <code><span class="constant">Elevator</span><span class="punct">::</span><span class="ident">allocate</span></code> would make a new <code><span class="constant">Elevator</span></code> object without calling the <code><span class="ident">initialize</span></code> method.)</p>


	<p>The <code><span class="ident">class_variables</span></code> were interesting to Dr. Cham.  This elevator appeared genuine. But no available <code><span class="ident">constants</span></code>.  This tells us there are no classes nested inside the <code><span class="constant">Elevator</span></code> class.</p>


	<p>He tried to create an <code><span class="constant">Elevator</span></code> object.</p>


<div class='example'><pre><code> <span class="ident">irb</span><span class="punct">&gt;</span> <span class="ident">e</span> <span class="punct">=</span> <span class="constant">Elevator</span><span class="punct">::</span><span class="ident">new</span>
 <span class="constant">ArgumentError</span><span class="punct">:</span> <span class="ident">wrong</span> <span class="ident">number</span> <span class="ident">of</span> <span class="ident">arguments</span> <span class="punct">(</span><span class="number">0</span> <span class="keyword">for</span> <span class="number">1</span><span class="punct">),</span> <span class="ident">requires</span> <span class="ident">a</span> <span class="ident">password</span>
         <span class="ident">from</span> <span class="punct">(</span><span class="ident">irb</span><span class="punct">):</span><span class="number">2</span><span class="symbol">:in</span> `<span class="ident">initialize</span><span class="punct">'</span><span class="string">
         from (irb):2:in `new</span><span class="punct">'</span>
         <span class="ident">from</span> <span class="punct">(</span><span class="ident">irb</span><span class="punct">):</span><span class="number">2</span>
         <span class="ident">from</span> <span class="punct">:</span><span class="number">0</span></code></pre></div>

	<p>He tried a few passwords.</p>


<div class='example'><pre><code> <span class="ident">irb</span><span class="punct">&gt;</span> <span class="ident">e</span> <span class="punct">=</span> <span class="constant">Elevator</span><span class="punct">::</span><span class="ident">new</span><span class="punct">(</span> <span class="punct">&quot;</span><span class="string">going up</span><span class="punct">&quot;</span> <span class="punct">)</span>
 <span class="constant">AccessDeniedError</span><span class="punct">:</span> <span class="ident">bad</span> <span class="ident">password</span>
 <span class="ident">irb</span><span class="punct">&gt;</span> <span class="ident">e</span> <span class="punct">=</span> <span class="constant">Elevator</span><span class="punct">::</span><span class="ident">new</span><span class="punct">(</span> <span class="punct">&quot;</span><span class="string">going_up</span><span class="punct">&quot;</span> <span class="punct">)</span>
 <span class="constant">AccessDeniedError</span><span class="punct">:</span> <span class="ident">bad</span> <span class="ident">password</span>
 <span class="ident">irb</span><span class="punct">&gt;</span> <span class="ident">e</span> <span class="punct">=</span> <span class="constant">Elevator</span><span class="punct">::</span><span class="ident">new</span><span class="punct">(</span> <span class="punct">&quot;</span><span class="string">stairs_are_bad</span><span class="punct">&quot;</span> <span class="punct">)</span>
 <span class="constant">AccessDeniedError</span><span class="punct">:</span> <span class="ident">bad</span> <span class="ident">password</span>
 <span class="ident">irb</span><span class="punct">&gt;</span> <span class="ident">e</span> <span class="punct">=</span> <span class="constant">Elevator</span><span class="punct">::</span><span class="ident">new</span><span class="punct">(</span> <span class="punct">&quot;</span><span class="string">StairsAreBad</span><span class="punct">&quot;</span> <span class="punct">)</span>
 <span class="constant">AccessDeniedError</span><span class="punct">:</span> <span class="ident">bad</span> <span class="ident">password</span></code></pre></div>

	<p>That was useless.  <em>Oh, wait!</em>  The maintenance password.  Listed in the <code><span class="ident">class_variables</span></code>.</p>


<div class='example'><pre><code> <span class="ident">irb</span><span class="punct">&gt;</span> <span class="constant">Elevator</span><span class="punct">::</span><span class="ident">maintenance_password</span>
 <span class="constant">NoMethodError</span><span class="punct">:</span> <span class="ident">undefined</span> <span class="ident">method</span> `<span class="ident">maintenance_password</span><span class="punct">'</span><span class="string"> for Elevator:Class
         from (irb):1
         from :0</span></code></pre></div>

	<p>Hmm.  Instance variables are only available inside an object.  And class variables are only available inside a class.  How to get at that password?</p>


<div class='example'><pre><code> <span class="ident">irb</span><span class="punct">&gt;</span> <span class="keyword">class </span><span class="class">Elevator</span>
 <span class="ident">irb</span><span class="punct">&gt;</span>   <span class="keyword">def </span><span class="method">Elevator.maintenance_password</span>
 <span class="ident">irb</span><span class="punct">&gt;</span>     <span class="attribute">@@maintenance_password</span>
 <span class="ident">irb</span><span class="punct">&gt;</span>   <span class="keyword">end</span>
 <span class="ident">irb</span><span class="punct">&gt;</span> <span class="keyword">end</span>
   <span class="punct">=&gt;</span> <span class="constant">nil</span>
 <span class="ident">irb</span><span class="punct">&gt;</span> <span class="constant">Elevator</span><span class="punct">::</span><span class="ident">maintenance_password</span>
   <span class="punct">=&gt;</span> <span class="punct">&quot;</span><span class="string">stairs_are_history!</span><span class="punct">&quot;</span></code></pre></div>

	<p>Alright!  He got the password.  Did you see that?</p>


	<p>He added a class method to the <code><span class="constant">Elevator</span></code> class.  Isn&#8217;t that great how you can start a new class definition for <code><span class="constant">Elevator</span></code> and Ruby just adds your changes to the existing class definition?</p>


	<p>Class methods are usually called with the <strong>double colon</strong>.  But, a period is fine as well. Since <code><span class="constant">Elevator</span></code> is a class itself, Ruby will figure that if you call <code><span class="constant">Elevator</span><span class="punct">.</span><span class="ident">maintenance_password</span></code>, you&#8217;re calling a class method.  The double colon simply helps make class methods obvious to the reader.</p>


	<p>And justly so.  Class methods are a bit unusual.  Normally you won&#8217;t want to store information directly inside of a class.  However, if you have a bit of information that you need to share among all objects of a class, then you have a good reason to use the class for storage. It&#8217;s understandable that the <code><span class="attribute">@@maintenance_password</span></code> would be stored in the class, instead of in each separate object.  This way, the objects can simply reach up into the class and see the shared password.</p>


	<p>Here&#8217;s probably how the password protection works.</p>


<div class='example'><pre><code> <span class="keyword">class </span><span class="class">Elevator</span>
   <span class="keyword">def </span><span class="method">initialize</span><span class="punct">(</span> <span class="ident">pass</span> <span class="punct">)</span>
     <span class="keyword">raise</span> <span class="constant">AccessDeniedError</span><span class="punct">,</span> <span class="punct">&quot;</span><span class="string">bad password</span><span class="punct">&quot;</span> \
       <span class="keyword">unless</span> <span class="ident">pass</span><span class="punct">.</span><span class="ident">equals?</span> <span class="attribute">@@maintenance_password</span>
   <span class="keyword">end</span>
 <span class="keyword">end</span></code></pre></div>

	<p>Passwording a class like this is pointless, since anything in Ruby can be altered and  overwritten and remolded.  Dr. Cham had the password and ownership of the elevator is his.</p>


<div class='example'><pre><code> <span class="ident">irb</span><span class="punct">&gt;</span> <span class="ident">e</span> <span class="punct">=</span> <span class="constant">Elevator</span><span class="punct">.</span><span class="ident">new</span><span class="punct">(</span> <span class="punct">&quot;</span><span class="string">stairs_are_history!</span><span class="punct">&quot;</span> <span class="punct">)</span>
 <span class="comment">#&lt;Elevator:0x81f12f4 @level=4&gt;</span>
 <span class="ident">irb</span><span class="punct">&gt;</span> <span class="ident">e</span><span class="punct">.</span><span class="ident">level</span> <span class="punct">=</span> <span class="number">1</span></code></pre></div>

	<p>Dr. Cham was standing right there when the elevator doors, off behind the computer terminal, opened for him.  With an exasperated sense of accomplishment and a good deal of excitement surrounding all of the events that lie ahead, he stepped into the elevator and pressed 4.</p>

    
    
        
        <div class="sidebar">
        <h1>sidebar!</h1>
        
        <h2>An Evening of Unobstructed Voltage</h2>
        

        <p>I dug up this article from <em>The Consistent Reminder</em>, a Connecticut newspaper which ran the four star review of Dr. Cham.  Midgie Dare, the book reviewer who suddenly opened her critical eye to anything tangible, praised the Doctor for his manners and innovations in the very same daily edition that she defamed cantaloupe and docked Manitoba for having crackly telephone service.</p>


	<p>I got a kick out of the end of her article.  Here you go.</p>


	<blockquote>
		<p>He dismounted his horse with unquestionable care for anyone who might be in the vicinity.  Attentive of all sides, he lowered himself from the saddle gently, slowing to a pace which must be measured in micrometers per second to be appreciated.</p>
	</blockquote>


	<blockquote>
		<p>Those of us in his company found ourselves with maws agape, watching his boot touch down upon the ground.  So precise and clean a step that it seemed it would never meet the earth, only hover slight above it.  Then, before the landing had actually registered with any of us, we were off to the cuisine, whisked away in the shroud of gaiety that was always right in front of Harold Cham, always just behind him, and most especially concentrate directly in his own luminary self.</p>
	</blockquote>


	<blockquote>
		<p>He also carried loosely at his side a capitally ignorant statesman&#8217;s daughter, who spared us no leave from her constant criticisms of atheists and railway routes.</p>
	</blockquote>


	<blockquote>
		<p>&#8220;At home, my efforts to light a candle were trounced upon by further train rumblings, which thrusted the match in my hand nearer the curtains!&#8221; She derided Dr. Cham for his waning grip on her forearm and became jealous when he was able to tune into a pleasurable woman&#8217;s voice on the radio once we returned to the residence.</p>
	</blockquote>


	<blockquote>
		<p>The dusk did settle, however, and we found ourselves in a communal daze beneath the thick particles of cotton drift that wafted through the polished piano room, quite entertained by the <em>Afternoon Nap Program</em>, which played their phonograph so quietly at the station that we could only hear the scratching of dead Napoleon&#8217;s sleeves across the bedsheets.  I felt a great shriek inside me at the thought! Still, on yonder chairs, the two lovers kept an abrupt distance between themselves and  I felt encompassed by Dr. Cham&#8217;s warm gaze and his playful tip of the sherry glass.</p>
	</blockquote>
        <h1>sidebar!</h1>
        </div>

    
    
        
        <a name="section3" />
        <h2>3. The Continued Story of My Daughter's Organ Instructor</h2>

        <p>I know you may be alarmed to hear that I have a daughter.  You think my writing is indicative of a palsied or infantile mind.  Well, please rest.  I don&#8217;t have a daughter. But I can&#8217;t let that stop me from sorting out her musical training.</p>


	<p>As I was related these elaborate histories of the planet Endertromb, I found myself wandering through hallways, running my fingertips along the tightly buttoned sofas and soaking myself in the saturated bellowings of the pipes, as played by my daughter&#8217;s organ instructor.  His notes resounded so deep and hollow in the walls of his manor that I began to casually mistake them for an ominous silence, and found it even easier to retreat into deep space with my thoughts.  To think upon the ancient planet and its darker philosophies: its flesh temples, tanned from the dermal remains of its martyrs; its whale cartels, ingesting their enemies and holding them within for decades, dragging them up and down the staircases of ribs; its poison fogs and its painful doorways; and, the atrocious dynasties of The Originals, the species which claims fathership to all of the intellegent beings across the universe.</p>


	<p>But, eventually, I&#8217;d hear those pipes of a higher octave sing and I&#8217;d be back in the very same breezy afternoon where I&#8217;d left.</p>


	<p>How interesting that even the breeze of our planet is quite a strange thing to some outsiders.  For he had also told me of the travellers from Rath-d, who ventured to Earth five centuries ago, but quickly dissipated in our air currents since they and their crafts and their armor were all composed of charcoal.</p>


	<p>I had sat at the organ, listening to his faint tales of his colony, while he punctuated his symphonies to greater volumes and the story would disappear for awhile, until the coda came back around. He spoke of he and his brothers piling into the hollow of his mother&#8217;s tail and tearing the waxy crescent tissue from the inner wall.  Juicy and spongy and syrupy soap which bleached their mouths and purged their esophagus as it went down.  They chewed and chomped the stuff and it foamed.  After they ate, they blew bubbles at each other, each bubble filled with a dense foam, which they slept upon.  And early in the morning, when mother opened her tail again, she watched serenely as her babies lay cradled in the stew of dark meatballs and sweet, sticky froth.</p>


	<p>He spelled out all the tastes of Endertromb.  Of their salmon&#8217;s starchy organs, which cooked into a pasta, and its eyes which melted into rich cream.  Of their buttermelon with tentacles. And he was just beginning to appreciate the delicacies as a child, only to be lifted from a schoolyard by a pair of upright pygmy elephants who reached at him, through the heavens, and snatched upon his collar with a vast length of crane.</p>


	<p>They transplanted him on Earth, led him from their craft, trumpeting their snouts loudly for the city of Grand Rapids to hear, then left, weeping and embracing each other.</p>


	<p>&#8220;But, strangely (em-pithy-dah), I learned upon, played upon (pon-shoo) the organs on my home (oth-rea) planet,&#8221; he said.</p>


	<p>My daughter&#8217;s organ instructor speaks these extra words you see in parentheses.  Who knows if they are from his native tongue or if they are his own soundful hiccups.  He keeps another relic from Endertromb as well: he has twelve names.</p>


	<p>&#8220;No, (wen-is-wen),&#8221; he said.  &#8220;I have one name (im-apalla) which is said (iff) many-many different ways.&#8221;</p>


	<p>I call him Paij-ree in the morning and Paij-plo in the later evening. Since it is day as I write, I will call him Paij-ree here.</p>


	<h3>Mumble-Free Earplugs</h3>


	<p style="float:right"><img src="../images/my.daughters.organ-1.gif" title="Alien at the keys." alt="Alien at the keys." /></p>


	<p>So I told Paij-ree, &#8220;Paij-ree, I am writing a book.  To teach the world Ruby.&#8221;</p>


	<p>&#8220;Oh, (pill-nog-pill-yacht) nice,&#8221; he said.  He&#8217;s known Ruby longer than I have, but still: <em>I</em> will be my daughter&#8217;s Ruby instructor.</p>


	<p>And I said, &#8220;Paij-ree, you are in the book.  And the stories of your planet.&#8221;  I talk to him like he&#8217;s E.T.  I don&#8217;t know why.  Just like how I said next, &#8220;And then maybe someday you can go home to your mom and dad!&#8221;</p>


	<p>To which he said, &#8220;(pon-shoo) (pon-shoo) (em-pithy-dah).&#8221;  Which is his way of speaking out loud his silence and awe.</p>


	<p>He wanted to see what I&#8217;d written, so I showed him this short method I&#8217;ve written for you.</p>


<div class='example'><pre><code> <span class="keyword">def </span><span class="method">wipe_mutterings_from</span><span class="punct">(</span> <span class="ident">sentence</span> <span class="punct">)</span>
   <span class="keyword">while</span> <span class="ident">sentence</span><span class="punct">.</span><span class="ident">include?</span> <span class="punct">'</span><span class="string">(</span><span class="punct">'</span>
     <span class="ident">open</span> <span class="punct">=</span> <span class="ident">sentence</span><span class="punct">.</span><span class="ident">index</span><span class="punct">(</span> <span class="punct">'</span><span class="string">(</span><span class="punct">'</span> <span class="punct">)</span>
     <span class="ident">close</span> <span class="punct">=</span> <span class="ident">sentence</span><span class="punct">.</span><span class="ident">index</span><span class="punct">(</span> <span class="punct">'</span><span class="string">)</span><span class="punct">',</span> <span class="ident">open</span> <span class="punct">)</span>
     <span class="ident">sentence</span><span class="punct">[</span><span class="ident">open</span><span class="punct">..</span><span class="ident">close</span><span class="punct">]</span> <span class="punct">=</span> <span class="punct">'</span><span class="string"></span><span class="punct">'</span> <span class="keyword">if</span> <span class="ident">close</span>
   <span class="keyword">end</span>
 <span class="keyword">end</span></code></pre></div>

	<p>&#8220;Can you see what this does, Paij-ree?  Any old Smotchkkiss can use this method to take all the incoherent babblings out of your speaking,&#8221; I said.</p>


	<p>And I fed something he said earlier into the method.</p>


<div class='example'><pre><code> <span class="ident">what_he_said</span> <span class="punct">=</span> <span class="punct">&quot;</span><span class="string">But, strangely (em-pithy-dah), 
   I learned upon, played upon (pon-shoo) the 
   organs on my home (oth-rea) planet.</span><span class="punct">&quot;</span> 
 <span class="ident">wipe_mutterings_from</span><span class="punct">(</span> <span class="ident">what_he_said</span> <span class="punct">)</span>
 <span class="ident">print</span> <span class="ident">what_he_said</span></code></pre></div>

	<p>And it came out as a rather plain sentence.</p>


<div class='example'><pre><code> <span class="constant">But</span><span class="punct">,</span> <span class="ident">strangely</span> <span class="punct">,</span> 
 <span class="constant">I</span> <span class="ident">learned</span> <span class="ident">upon</span><span class="punct">,</span> <span class="ident">played</span> <span class="ident">upon</span> <span class="ident">the</span>
 <span class="ident">organs</span> <span class="ident">on</span> <span class="ident">my</span> <span class="ident">home</span> <span class="ident">planet</span><span class="punct">.</span></code></pre></div>

	<p>&#8220;You shouldn&#8217;t use that (wary-to) while loop,&#8221; he said.  &#8220;There are lovelier, (thopt-er), gentler ways.&#8221;</p>


	<p>In the <code><span class="ident">wipe_mutterings_from</span></code> method, I&#8217;m basically searching for opening parentheses.  When I find one, I scan for a closing paren which follows it.  Once I&#8217;ve found both, I replace them and their contents with an empty string.  The <code><span class="keyword">while</span></code> loop continues until all parentheses are gone. The mutterings are removed and the method ends.</p>


	<p>&#8220;Now that I look at this method,&#8221; I said.  &#8220;I see that there are some confusing aspects  and some ways I could do this better.&#8221;  Please don&#8217;t look down on me as your teacher for  writing some of this code.  I figure that it&#8217;s okay to show you some sloppy techniques  to help you work through them with me.  So let&#8217;s.</p>


	<p>Okay, <strong>Confusing Aspect No. 1</strong>: This method cleans a string.  But what if we accidentally give it a <code><span class="constant">File</span></code>?  Or a number?  What happens?  What if we run <code><span class="ident">wipe_mutterings_from</span><span class="punct">(</span> <span class="number">1</span> <span class="punct">)</span></code>?</p>


	<p>If we give <code><span class="ident">wipe_mutterings_from</span></code> the number 1, Ruby will print the following and exit.</p>


<div class='example'><pre><code> <span class="constant">NoMethodError</span><span class="punct">:</span> <span class="ident">undefined</span> <span class="ident">method</span> `<span class="ident">include?</span><span class="punct">'</span><span class="string"> for 1:Fixnum
         from (irb):2:in `wipe_mutterings_from</span><span class="punct">'</span>
         <span class="ident">from</span> <span class="punct">(</span><span class="ident">irb</span><span class="punct">):</span><span class="number">8</span></code></pre></div>

	<p>What you see here is a rather twisted and verbose (but at times very helpful) little fellow called the <strong>backtrace</strong>.  He&#8217;s a wound-up policeman who, at the slightest sign of trouble, immediately apprehends any and all suspects, pinning them against the wall and spelling out their rights so quickly that none can quite hear it all.  But it&#8217;s plain that there&#8217;s a problem.  And, of course, it&#8217;s all a big misunderstanding, right?</p>


	<p>When Ruby reads you these Miranda rights, listen hardest to the beginning.  The first line is often all you need.  In this first line is contained the essential message.  And in the above, the first line is telling us that there is no <code><span class="ident">include?</span></code> method for the number 1. Remember, when we were talking about the <code><span class="ident">reverse</span></code> method in the last chapter?  Back then, I said, &#8220;<strong>a lot of methods are only available with certain types of values</strong>.&#8221;  Both <code><span class="ident">reverse</span></code> and <code><span class="ident">include?</span></code> are methods which work with strings but are meaningless and unavailable for numbers.</p>


	<p>To be clear: the method tries to use to the number.  The method will start with <code><span class="ident">sentence</span></code> set to 1. Then, it hits the second line: <code><span class="keyword">while</span> <span class="ident">sentence</span><span class="punct">.</span><span class="ident">include?</span> <span class="punct">'</span><span class="string">(</span><span class="punct">'</span></code>.  Numbers have no <code><span class="ident">include?</span></code> method.  Great, the backtrace has shown us where the problem is.  I didn&#8217;t expect anyone to pass in a number, so I&#8217;m using methods that don&#8217;t work with numbers.</p>


	<p><strong>See, this is just it.</strong>  Our method is its own little pocket tool, right?  It acts as its own widget independent of anything else.  To anyone out there using the <code><span class="ident">wipe_mutterings_from</span></code> method, should they pass in a number, they&#8217;ll be tossed this panic message that doesn&#8217;t make sense to them.  They&#8217;ll be asked to poke around inside the method, which really isn&#8217;t their business.  They don&#8217;t know their way around in there.</p>


	<p>Fortunately, we can throw our own errors, our own <strong>exceptions</strong>, which may make more sense to someone who inadvertantly hands the wrong object in for cleaning.</p>


<div class='example'><pre><code> <span class="keyword">def </span><span class="method">wipe_mutterings_from</span><span class="punct">(</span> <span class="ident">sentence</span> <span class="punct">)</span>
   <span class="keyword">unless</span> <span class="ident">sentence</span><span class="punct">.</span><span class="ident">respond_to?</span> <span class="symbol">:include?</span>
     <span class="keyword">raise</span> <span class="constant">ArgumentError</span><span class="punct">,</span> 
       <span class="punct">&quot;</span><span class="string">cannot wipe mutterings from a <span class="expr">#{ sentence.class }</span></span><span class="punct">&quot;</span> 
   <span class="keyword">end</span>
   <span class="keyword">while</span> <span class="ident">sentence</span><span class="punct">.</span><span class="ident">include?</span> <span class="punct">'</span><span class="string">(</span><span class="punct">'</span>
     <span class="ident">open</span> <span class="punct">=</span> <span class="ident">sentence</span><span class="punct">.</span><span class="ident">index</span><span class="punct">(</span> <span class="punct">'</span><span class="string">(</span><span class="punct">'</span> <span class="punct">)</span>
     <span class="ident">close</span> <span class="punct">=</span> <span class="ident">sentence</span><span class="punct">.</span><span class="ident">index</span><span class="punct">(</span> <span class="punct">'</span><span class="string">)</span><span class="punct">',</span> <span class="ident">open</span> <span class="punct">)</span>
     <span class="ident">sentence</span><span class="punct">[</span><span class="ident">open</span><span class="punct">..</span><span class="ident">close</span><span class="punct">]</span> <span class="punct">=</span> <span class="punct">'</span><span class="string"></span><span class="punct">'</span> <span class="keyword">if</span> <span class="ident">close</span>
   <span class="keyword">end</span>
 <span class="keyword">end</span></code></pre></div>

	<p>This time, if we pass in a number (again, the number 1), we&#8217;ll get something more sensible.</p>


<div class='example'><pre><code> <span class="constant">ArgumentError</span><span class="punct">:</span> <span class="ident">cannot</span> <span class="ident">wipe</span> <span class="ident">mutterings</span> <span class="ident">from</span> <span class="ident">a</span> <span class="constant">Fixnum</span>
         <span class="ident">from</span> <span class="punct">(</span><span class="ident">irb</span><span class="punct">):</span><span class="number">3</span><span class="symbol">:in</span> `<span class="ident">wipe_mutterings_from</span><span class="punct">'</span><span class="string">
         from (irb):12</span></code></pre></div>

	<p>The <code><span class="ident">respond_to?</span></code> method is really nice and I plead that you never forget it&#8217;s there.  The <code><span class="ident">respond_to?</span></code> checks any object to be sure that it has a certain method.  It then gives back a <code><span class="constant">true</span></code> or <code><span class="constant">false</span></code>.  In the above case, the incoming <code><span class="ident">sentence</span></code> object is checked for an <code><span class="ident">include?</span></code> method.  If no <code><span class="ident">include?</span></code> method is found, then we raise the error.</p>


	<p>You might be wondering why I used a symbol with <code><span class="ident">respond_to?</span></code>.  I used a symbol <code><span class="symbol">:include?</span></code> instead of a string <code><span class="punct">'</span><span class="string">include?</span><span class="punct">'</span></code>.  Actually, either will work with <code><span class="ident">respond_to?</span></code>.</p>


	<p>Usually symbols are used when you are passing around the name of a method or any other Ruby construct. It&#8217;s more efficient, but it also catches the eye.  The <code><span class="ident">respond_to?</span></code> asks Ruby to look inside itself and see if a method is available.  We&#8217;re talking to Ruby, so the symbol helps denote that.  It&#8217;s not a big deal, Ruby just recognizes symbols quicker than strings.</p>


	<p>Now, <strong>Confusing Aspect No. 2</strong>: Have you noticed how our method changes the sentence?</p>


<div class='example'><pre><code> <span class="ident">something_said</span> <span class="punct">=</span> <span class="punct">&quot;</span><span class="string">A (gith) spaceship.</span><span class="punct">&quot;</span> 
 <span class="ident">wipe_mutterings_from</span><span class="punct">(</span> <span class="ident">something_said</span> <span class="punct">)</span>
 <span class="ident">print</span> <span class="ident">something_said</span></code></pre></div>

	<p>Did you notice this?  In the first line of the above code, the <code><span class="ident">something_said</span></code> variable contains the string <code><span class="punct">&quot;</span><span class="string">A (gith) spaceship.</span><span class="punct">&quot;</span></code>.  But, after the method invocation, on the third line, we print the <code><span class="ident">something_said</span></code> variable and by then it contains the cleaned string <code><span class="punct">&quot;</span><span class="string">A  spaceship.</span><span class="punct">&quot;</span></code>.</p>


	<p>How does this work?  How does the method change the string?  Shouldn&#8217;t it make a copy of the string before changing it?</p>


	<p>Yes, absolutely, it should!  <strong>It&#8217;s bad manners to change strings like that.</strong>  We&#8217;ve used <code><span class="ident">gsub</span></code> and <code><span class="ident">gsub!</span></code> in the last chapter.  Do you remember which of those two methods is a <strong>destructive method</strong>, which changes strings directly?</p>


	<p>Either we need to call this method <code><span class="ident">wipe_mutterings_from!</span></code> (as a courtesy to all the other good folks out there that might use this method) or change the method to work on a copy of the string rather than the real thing.  Which is an easy change!  We just need to <code><span class="ident">dup</span></code> the string.</p>


<div class='example'><pre><code> <span class="keyword">def </span><span class="method">wipe_mutterings_from</span><span class="punct">(</span> <span class="ident">sentence</span> <span class="punct">)</span>
   <span class="keyword">unless</span> <span class="ident">sentence</span><span class="punct">.</span><span class="ident">respond_to?</span> <span class="symbol">:include?</span>
     <span class="keyword">raise</span> <span class="constant">ArgumentError</span><span class="punct">,</span> 
       <span class="punct">&quot;</span><span class="string">cannot wipe mutterings from a <span class="expr">#{ sentence.class }</span></span><span class="punct">&quot;</span> 
   <span class="keyword">end</span>
   <span class="ident">sentence</span> <span class="punct">=</span> <span class="ident">sentence</span><span class="punct">.</span><span class="ident">dup</span>
   <span class="keyword">while</span> <span class="ident">sentence</span><span class="punct">.</span><span class="ident">include?</span> <span class="punct">'</span><span class="string">(</span><span class="punct">'</span>
     <span class="ident">open</span> <span class="punct">=</span> <span class="ident">sentence</span><span class="punct">.</span><span class="ident">index</span><span class="punct">(</span> <span class="punct">'</span><span class="string">(</span><span class="punct">'</span> <span class="punct">)</span>
     <span class="ident">close</span> <span class="punct">=</span> <span class="ident">sentence</span><span class="punct">.</span><span class="ident">index</span><span class="punct">(</span> <span class="punct">'</span><span class="string">)</span><span class="punct">',</span> <span class="ident">open</span> <span class="punct">)</span>
     <span class="ident">sentence</span><span class="punct">[</span><span class="ident">open</span><span class="punct">..</span><span class="ident">close</span><span class="punct">]</span> <span class="punct">=</span> <span class="punct">'</span><span class="string"></span><span class="punct">'</span> <span class="keyword">if</span> <span class="ident">close</span>
   <span class="keyword">end</span>
   <span class="ident">sentence</span>
 <span class="keyword">end</span></code></pre></div>

	<p>The <code><span class="ident">dup</span></code> method makes a copy of any object.  Look at that line we added again on its own:</p>


<div class='example'><pre><code> <span class="ident">sentence</span> <span class="punct">=</span> <span class="ident">sentence</span><span class="punct">.</span><span class="ident">dup</span></code></pre></div>

	<p>What a peculiar line of code.  How does <code><span class="ident">sentence</span></code> become a copy of <code><span class="ident">sentence</span></code>? Does it erase itself?  What happens to the original <code><span class="ident">sentence</span></code>?  Does it disappear?</p>


	<p>Remember that variables are just nicknames.  When you see <code><span class="ident">sentence</span> <span class="punct">=</span> <span class="punct">&quot;</span><span class="string">A (gith) spaceship.</span><span class="punct">&quot;</span></code>, you see Ruby creating a string and then giving that string a nickname.</p>


	<p>Likewise, when you see <code><span class="ident">sentence</span> <span class="punct">=</span> <span class="ident">sentence</span><span class="punct">.</span><span class="ident">dup</span></code>, you see Ruby creating a new string and then giving that string a nickname.  This is handy inside your method because now <code><span class="ident">sentence</span></code> is a nickname for a new copy of the string that you can safely use <strong>without changing the string that was passed into the method</strong>.</p>


	<p>You&#8217;ll see plenty of examples of variable names being reused.</p>


<div class='example'><pre><code> <span class="ident">x</span> <span class="punct">=</span> <span class="number">5</span>
 <span class="ident">x</span> <span class="punct">=</span> <span class="ident">x</span> <span class="punct">+</span> <span class="number">1</span>
 <span class="comment"># x now equals 6</span>

 <span class="ident">y</span> <span class="punct">=</span> <span class="punct">&quot;</span><span class="string">Endertromb</span><span class="punct">&quot;</span> 
 <span class="ident">y</span> <span class="punct">=</span> <span class="ident">y</span><span class="punct">.</span><span class="ident">length</span>
 <span class="comment"># y now equals 10</span>

 <span class="ident">z</span> <span class="punct">=</span> <span class="symbol">:include?</span>
 <span class="ident">z</span> <span class="punct">=</span> <span class="punct">&quot;</span><span class="string">a string</span><span class="punct">&quot;.</span><span class="ident">respond_to?</span> <span class="ident">z</span>
 <span class="comment"># z now equals true</span></code></pre></div>

	<p>And, yes, sometimes objects disappear.  <strong>If you can&#8217;t get to an object through a variable, then Ruby will figure you are done with it and will get rid of it.</strong>  Periodically, Ruby sends out its <strong>garbage collector</strong> to set these objects free.  Every object is kept in your computer&#8217;s memory until the garbage collector gets rid of it.</p>

    
    
        
        <div class="sidebar">
        <h1>sidebar!</h1>
        
        <h2>An Excerpt from The Scarf Eaters</h2>
        

        <p>(<em>from Chapter <span class="caps">VII</span>: When Push Comes to Shove&#8212;or Love</em>.)</p>


	<p>&#8220;Never say my name again!&#8221; screamed Chester, and with the same gusto, he turned back to the <strong>File &gt; Publish Settings&#8230;</strong> dialog to further optimize his movie down to a  measley 15k.</p>
        <h1>sidebar!</h1>
        </div>

    
    

        <p>Oh, and one more thing about <code><span class="ident">dup</span></code>.  Some things can&#8217;t be dup&#8217;d.  Numbers, for instance.   Symbols (which look like <code><span class="symbol">:death</span></code>) are identical when spelled the same.  Like numbers.</p>


	<p>Also, some of the special variables: <code><span class="constant">nil</span></code>, <code><span class="constant">true</span></code>, <code><span class="constant">false</span></code>.  These are things that Ruby won&#8217;t let you alter, so there&#8217;s so point making a copy anyway.  I mean, imagine if you could change <code><span class="constant">false</span></code> to be <code><span class="constant">true</span></code>.  The whole thing becomes a lie.</p>


	<p>Perhaps <strong>Confusing Aspect No. 3</strong> is a simple one.  I&#8217;m using those square brackets on the  string.  I&#8217;m treating the string like it&#8217;s an Array or Hash.  I can do that.  Because strings have a <code><span class="punct">[]</span></code> method.</p>


	<p>When used on a string, the square brackets will extract part of the string.  Again, slots for a forklift&#8217;s prongs.  The string is a long shelf and the forklift is pulling out a slab of the string.</p>


	<p>Inside the brackets, we pass the <em>index</em>.  It&#8217;s the label we&#8217;ve placed right between the prongs where the worker can see it.  When it comes to strings, we can use a variety of objects as our  index.</p>


<div class='example'><pre><code> <span class="ident">str</span> <span class="punct">=</span> <span class="punct">&quot;</span><span class="string">A string is a long shelf of letters and spaces.</span><span class="punct">&quot;</span> 
 <span class="ident">puts</span> <span class="ident">str</span><span class="punct">[</span><span class="number">0</span><span class="punct">]</span>       <span class="comment"># prints 65 (the character code for an 'A')</span>
 <span class="ident">puts</span> <span class="ident">str</span><span class="punct">[</span><span class="number">0</span><span class="punct">..-</span><span class="number">1</span><span class="punct">]</span>   <span class="comment"># prints 'A string is a long shelf of letters and spaces.'</span>
 <span class="ident">puts</span> <span class="ident">str</span><span class="punct">[</span><span class="number">1</span><span class="punct">..-</span><span class="number">2</span><span class="punct">]</span>   <span class="comment"># prints ' string is a long shelf of letters and spaces'</span>
 <span class="ident">puts</span> <span class="ident">str</span><span class="punct">[</span><span class="number">1</span><span class="punct">,</span> <span class="number">3</span><span class="punct">]</span>    <span class="comment"># prints 'A s'</span>
 <span class="ident">puts</span> <span class="ident">str</span><span class="punct">['</span><span class="string">shelf</span><span class="punct">']</span> <span class="comment"># prints 'shelf'</span></code></pre></div>

	<p>Alright, the last <strong>Confusing Aspect No. 4</strong>: this method can be sent into an endless loop. You can give this method a string which will cause the method to hang and never come back. Take a look at the method.  Can you throw in a muddy stick to clog the loop?</p>


<div class='example'><pre><code> <span class="keyword">def </span><span class="method">wipe_mutterings_from</span><span class="punct">(</span> <span class="ident">sentence</span> <span class="punct">)</span>
   <span class="keyword">unless</span> <span class="ident">sentence</span><span class="punct">.</span><span class="ident">respond_to?</span> <span class="symbol">:include?</span>
     <span class="keyword">raise</span> <span class="constant">ArgumentError</span><span class="punct">,</span> 
       <span class="punct">&quot;</span><span class="string">cannot wipe mutterings from a <span class="expr">#{ sentence.class }</span></span><span class="punct">&quot;</span> 
   <span class="keyword">end</span>
   <span class="ident">sentence</span> <span class="punct">=</span> <span class="ident">sentence</span><span class="punct">.</span><span class="ident">dup</span>
   <span class="keyword">while</span> <span class="ident">sentence</span><span class="punct">.</span><span class="ident">include?</span> <span class="punct">'</span><span class="string">(</span><span class="punct">'</span>
     <span class="ident">open</span> <span class="punct">=</span> <span class="ident">sentence</span><span class="punct">.</span><span class="ident">index</span><span class="punct">(</span> <span class="punct">'</span><span class="string">(</span><span class="punct">'</span> <span class="punct">)</span>
     <span class="ident">close</span> <span class="punct">=</span> <span class="ident">sentence</span><span class="punct">.</span><span class="ident">index</span><span class="punct">(</span> <span class="punct">'</span><span class="string">)</span><span class="punct">',</span> <span class="ident">open</span> <span class="punct">)</span>
     <span class="ident">sentence</span><span class="punct">[</span><span class="ident">open</span><span class="punct">..</span><span class="ident">close</span><span class="punct">]</span> <span class="punct">=</span> <span class="punct">'</span><span class="string"></span><span class="punct">'</span> <span class="keyword">if</span> <span class="ident">close</span>
   <span class="keyword">end</span>
   <span class="ident">sentence</span>
 <span class="keyword">end</span></code></pre></div>

	<p>Here, give the muddy stick a curve before you jam it.</p>


<div class='example'><pre><code> <span class="ident">muddy_stick</span> <span class="punct">=</span> <span class="punct">&quot;</span><span class="string">Here's a ( curve.</span><span class="punct">&quot;</span> 
 <span class="ident">wipe_mutterings_from</span><span class="punct">(</span> <span class="ident">muddy_stick</span> <span class="punct">)</span></code></pre></div>

	<p>Why does the method hang?  Well, the <code><span class="keyword">while</span></code> loop waits until all the open parentheses are gone before it stops looping.  And it only replaces open parentheses that have a matching closing parentheses.  So, if no closing paren is found, the open paren won&#8217;t be replaced and the <code><span class="keyword">while</span></code> will never be satisfied.</p>


	<p>How would you rewrite this method?  Me, I know my way around Ruby, so I&#8217;d use a regular expression.</p>


<div class='example'><pre><code> <span class="keyword">def </span><span class="method">wipe_mutterings_from</span><span class="punct">(</span> <span class="ident">sentence</span> <span class="punct">)</span>
   <span class="keyword">unless</span> <span class="ident">sentence</span><span class="punct">.</span><span class="ident">respond_to?</span> <span class="symbol">:gsub</span>
     <span class="keyword">raise</span> <span class="constant">ArgumentError</span><span class="punct">,</span> 
       <span class="punct">&quot;</span><span class="string">cannot wipe mutterings from a <span class="expr">#{ sentence.class }</span></span><span class="punct">&quot;</span> 
   <span class="keyword">end</span>
   <span class="ident">sentence</span><span class="punct">.</span><span class="ident">gsub</span><span class="punct">(</span> <span class="punct">/</span><span class="regex"><span class="escape">\(</span>[-<span class="escape">\w</span>]+<span class="escape">\)</span></span><span class="punct">/,</span> <span class="punct">'</span><span class="string"></span><span class="punct">'</span> <span class="punct">)</span>
 <span class="keyword">end</span></code></pre></div>

	<p>Do your best to think through your loops.  It&#8217;s especially easy for <code><span class="keyword">while</span></code> and <code><span class="keyword">until</span></code> loops to get out of hand.  Best to use an iterator.  And we&#8217;ll get to regular expressions in time.</p>


	<p>In summary, here&#8217;s what we&#8217;ve learned about writing methods:</p>


	<ol>
	<li>Don&#8217;t be surprised if people pass unexpected objects into your methods. If you absolutely can&#8217;t use what they give you, <code><span class="keyword">raise</span></code> an error.</li>
		<li>It&#8217;s poor etiquette to change objects your method is given.  Use <code><span class="ident">dup</span></code> to make a copy.  Or find a method like <code><span class="ident">gsub</span></code> that automatically makes a copy as it does its job.</li>
		<li>The square brackets can be used to lookup parts inside any <code><span class="constant">Array</span></code>, <code><span class="constant">Hash</span></code> or <code><span class="constant">String</span></code> objects, as these objects provide a <code><span class="punct">[]</span></code> method.  Also, since these objects provide a <code><span class="punct">[]=</span></code> method, the square brackets can be used in assignment (on the left-hand side of the equals sign) to change the parts of those objects.</li>
		<li>Watch for runaway loops.  Avoid <code><span class="keyword">while</span></code> and <code><span class="keyword">until</span></code> if you can.</li>
	</ol>


	<h3>The Mechanisms of Name-Calling</h3>


	<p style="float:right"><img src="../images/my.daughters.organ-2.gif" title="Cat salesmen from the sky." alt="Cat salesmen from the sky." /></p>


	<p>Forthwith there is a rustling in the trees behind Paij-ree&#8217;s house and it turns out to be a man falling from the sky.  His name is Doug and he sells cats.</p>


	<p>So, just as he comes into to view, when his shadow (and the shadows of the cats tied to his foot) obscures the bird on the lawn that we&#8217;re trying to hit with a racquetball,  as he&#8217;s squeezing a wisp of helium from his big balloon, we shout, &#8220;Hello, Doug!&#8221;</p>


	<p>And he says, &#8220;Hello, Gonk-ree!  Hello, Why!&#8221;</p>


	<p>Paij-ree checks his pockets to be sure he has the dollar-twenty-seven he&#8217;ll need in order to buy the three cats he&#8217;ll need to keep the furnace stoked and the satellite dish turning.  These cats generate gobs of static once Paij-ree tosses them in the generator, where they&#8217;ll be outnumbered by the giant glass rods, which caress the cats continually&#8212;But, wait!  Did you see how the cat broker called him Gonk-ree?</p>


	<p>And he calls him Gonk-ree in the morning and Gonk-plo at night.</p>


	<p>So the suffix is definitely subject to the sunlight.  As far as I can tell, the prefix indicates the namecaller&#8217;s relationship to Paij-ree.</p>


<div class='example'><pre><code> <span class="keyword">class </span><span class="class">String</span>

   <span class="comment"># The parts of my daughter's organ</span>
   <span class="comment"># instructor's name.</span>
   <span class="attribute">@@syllables</span> <span class="punct">=</span> <span class="punct">[</span>
     <span class="punct">{</span> <span class="punct">'</span><span class="string">Paij</span><span class="punct">'</span> <span class="punct">=&gt;</span> <span class="punct">'</span><span class="string">Personal</span><span class="punct">',</span>
       <span class="punct">'</span><span class="string">Gonk</span><span class="punct">'</span> <span class="punct">=&gt;</span> <span class="punct">'</span><span class="string">Business</span><span class="punct">',</span>
       <span class="punct">'</span><span class="string">Blon</span><span class="punct">'</span> <span class="punct">=&gt;</span> <span class="punct">'</span><span class="string">Slave</span><span class="punct">',</span>
       <span class="punct">'</span><span class="string">Stro</span><span class="punct">'</span> <span class="punct">=&gt;</span> <span class="punct">'</span><span class="string">Master</span><span class="punct">',</span>
       <span class="punct">'</span><span class="string">Wert</span><span class="punct">'</span> <span class="punct">=&gt;</span> <span class="punct">'</span><span class="string">Father</span><span class="punct">',</span>
       <span class="punct">'</span><span class="string">Onnn</span><span class="punct">'</span> <span class="punct">=&gt;</span> <span class="punct">'</span><span class="string">Mother</span><span class="punct">'</span> <span class="punct">},</span>
     <span class="punct">{</span> <span class="punct">'</span><span class="string">ree</span><span class="punct">'</span>  <span class="punct">=&gt;</span> <span class="punct">'</span><span class="string">AM</span><span class="punct">',</span>
       <span class="punct">'</span><span class="string">plo</span><span class="punct">'</span>  <span class="punct">=&gt;</span> <span class="punct">'</span><span class="string">PM</span><span class="punct">'</span> <span class="punct">}</span>
   <span class="punct">]</span>

   <span class="comment"># A method to determine what a</span>
   <span class="comment"># certain name of his means.</span>
   <span class="keyword">def </span><span class="method">name_significance</span>
     <span class="ident">parts</span> <span class="punct">=</span> <span class="constant">self</span><span class="punct">.</span><span class="ident">split</span><span class="punct">(</span> <span class="punct">'</span><span class="string">-</span><span class="punct">'</span> <span class="punct">)</span>
     <span class="ident">syllables</span> <span class="punct">=</span> <span class="attribute">@@syllables</span><span class="punct">.</span><span class="ident">dup</span>
     <span class="ident">signif</span> <span class="punct">=</span> <span class="ident">parts</span><span class="punct">.</span><span class="ident">collect</span> <span class="keyword">do</span> <span class="punct">|</span><span class="ident">p</span><span class="punct">|</span>
       <span class="ident">syllables</span><span class="punct">.</span><span class="ident">shift</span><span class="punct">[</span><span class="ident">p</span><span class="punct">]</span>
     <span class="keyword">end</span>
     <span class="ident">signif</span><span class="punct">.</span><span class="ident">join</span><span class="punct">(</span> <span class="punct">'</span><span class="string"> </span><span class="punct">'</span> <span class="punct">)</span>
   <span class="keyword">end</span>

 <span class="keyword">end</span></code></pre></div>

	<p>Now I&#8217;ve gone beyond just showing you sloppy code.  Here be a grave debauchery and a crime against nature.  A crime most languages won&#8217;t allow you to commit.  We&#8217;re changing the <code><span class="constant">String</span></code>, <strong>one of the core classes of Ruby</strong>!</p>


	<p>&#8220;I know this is a bit dangerous,&#8221; I said, when I passed this one under Paij-ree&#8217;s nose. &#8220;I hope nobody gets hurt.&#8221;</p>


	<p>&#8220;Every Smotchkkiss must taste what this (kep-yo-iko) danger does,&#8221; he said.  &#8220;Dogs and logs and swampy bogs (kul-ip), all must be tasted.&#8221;  And he took a swig of his Beagle Berry marsh drink.</p>


	<p>So what is it that I&#8217;m adding to the <code><span class="constant">String</span></code> class?  Two things: a class variable and a method.  A normal <strong>instance method</strong>.</p>


	<p>I like to look at the <strong>at</strong> symbol as a character meaning <strong>attribute</strong>.  The <strong>double at</strong> stands for <strong>attribute all</strong>.  A class variable.  All instances of a class can look at this variable and it is the same for all of them.  The <code><span class="attribute">@@syllables</span></code> variable is an Array that can now be used inside the String class.</p>


	<p>The new method is <code><span class="ident">name_significance</span></code> and this new method can be used with any string.</p>


	<blockquote>
		<p><code><span class="ident">print</span> <span class="punct">&quot;</span><span class="string">Paij-ree</span><span class="punct">&quot;.</span><span class="ident">name_significance</span></code> prints out <code><span class="constant">Personal</span> <span class="constant">AM</span></code>.</p>
	</blockquote>


	<p>As you can see, Paij-ree is a personal name.  A name friends use in the early hours.</p>


	<p>Make sure you see the line of code which uses <code><span class="constant">self</span></code>.  This is a special variable, a variable which represents the object whose method you are calling.  To simplify things a bit, let&#8217;s try making a method which breaks up a string on its dashes.</p>


<div class='example'><pre><code> <span class="keyword">class </span><span class="class">String</span>
   <span class="keyword">def </span><span class="method">dash_split</span>
     <span class="constant">self</span><span class="punct">.</span><span class="ident">split</span><span class="punct">(</span> <span class="punct">'</span><span class="string">-</span><span class="punct">'</span> <span class="punct">)</span>
   <span class="keyword">end</span>
 <span class="keyword">end</span></code></pre></div>

	<p>Again, here&#8217;s a method which can be used with any string.</p>


	<blockquote>
		<p><code><span class="punct">&quot;</span><span class="string">Gonk-plo</span><span class="punct">&quot;.</span><span class="ident">dash_split</span></code> return the Array <code><span class="punct">['</span><span class="string">Gonk</span><span class="punct">',</span> <span class="punct">'</span><span class="string">plo</span><span class="punct">']</span></code>.</p>
	</blockquote>


	<p>Using <code><span class="constant">self</span></code> marks the beginning of crossing over into many of the more advanced ideas in Ruby. This is definition language.  You&#8217;re defining a method, designing it before it gets used.  You&#8217;re preparing for the existence of an object which uses that method.  You&#8217;re saying, &#8220;When <code><span class="ident">dash_split</span></code>  gets used, there will be a string at that time which is the one we&#8217;re dash-splitting.  And <code><span class="constant">self</span></code> is a  special variable which refers to that string.&#8221;</p>


	<p>Ruby is a knockout definition language.  A succulent and brain-splitting discussion is coming your way deeper in this book.</p>


	<p>Most often you won&#8217;t need to use <code><span class="constant">self</span></code> explicitly, since you can call methods directly from inside other method definitions.</p>


<div class='example'><pre><code> <span class="keyword">class </span><span class="class">String</span>
   <span class="keyword">def </span><span class="method">dash_split</span><span class="punct">;</span> <span class="ident">split</span><span class="punct">(</span> <span class="punct">'</span><span class="string">-</span><span class="punct">'</span> <span class="punct">);</span> <span class="keyword">end</span>
 <span class="keyword">end</span></code></pre></div>

	<p>In the <code><span class="ident">name_significance</span></code> method, find the loop.  Learning about <code><span class="constant">Array</span><span class="comment">#collect</span></code> is essential. Let&#8217;s look close.</p>


<div class='example'><pre><code> <span class="ident">signif</span> <span class="punct">=</span> <span class="ident">parts</span><span class="punct">.</span><span class="ident">collect</span> <span class="keyword">do</span> <span class="punct">|</span><span class="ident">p</span><span class="punct">|</span>
   <span class="ident">syllables</span><span class="punct">.</span><span class="ident">shift</span><span class="punct">[</span><span class="ident">p</span><span class="punct">]</span>
 <span class="keyword">end</span></code></pre></div>

	<p>The <code><span class="ident">parts</span></code> Array contains the separated name.  <code><span class="punct">['</span><span class="string">Paij</span><span class="punct">',</span> <span class="punct">'</span><span class="string">plo</span><span class="punct">']</span></code>, for instance.  We&#8217;re iterating through each item in that Array with <code><span class="ident">collect</span></code>.  But <code><span class="ident">collect</span></code> steps beyond what <code><span class="ident">each</span></code> does.  Like <code><span class="ident">each</span></code>, collect slides each item down the chute as a block variable.  And then, at the end of the block, <code><span class="ident">collect</span></code> <strong>keeps the answer the block gives back and adds it to a new Array</strong>.  The <code><span class="ident">collect</span></code> method is the perfect way of building a new Array which is based on the items in an existing Array.</p>


	<p>Doug has three cats for sale.  One is twelve cents, one is sixty-three cents, one is nine cents. Let&#8217;s see how much each cat would cost if we added a 20% tip.</p>


<div class='example'><pre><code> <span class="ident">catsandtips</span> <span class="punct">=</span> <span class="punct">[</span><span class="number">0.12</span><span class="punct">,</span> <span class="number">0.63</span><span class="punct">,</span> <span class="number">0.09</span><span class="punct">].</span><span class="ident">collect</span> <span class="punct">{</span> <span class="punct">|</span><span class="ident">catcost</span><span class="punct">|</span> <span class="ident">catcost</span> <span class="punct">+</span> <span class="punct">(</span> <span class="ident">catcost</span> <span class="punct">*</span> <span class="number">0.20</span> <span class="punct">)</span> <span class="punct">}</span></code></pre></div>

	<p>I say Paij-ree&#8217;s property is a very charming section of woods when it&#8217;s not raining cats and Doug. For many days, Paij-ree and I camped in tents by the river behind his house, subsisting on smoked blackbird and whittling little sleeping indians by the dusklight.  On occassion he would lose a game of spades and I knew his mind was distracted, thinking of Endertromb.  All of this must have been stirring inside of him for sometime.  I was the first ear he&#8217;d ever had.</p>


	<p>&#8220;I just came from Ambrose,&#8221; I said.  &#8220;Sort of my own underground home, a place where elves strive to perfect animals.&#8221;</p>


	<p>He mumbled and nodded.  &#8220;You can&#8217;t be (poth-in-oin) part of (in) such things.&#8221;</p>


	<p>&#8220;You think we will fail?&#8221;</p>


	<p>&#8220;I (preep) have been there before,&#8221; he said.  And then, he spoke of the Lotteries.</p>

    
    
        
        <a name="section4" />
        <h2>4. The Goat Wants to Watch a Whole Film</h2>

        <p><img src="../images/the.goat-1.gif" title="Blinky, winky, a goat... awakes..." alt="Blinky, winky, a goat... awakes..." /></p>


	<p>The elevator had opened into a green room full of shelves and file cabinets.  Reels of tape and film canisters and video tape everywhere.  Dr. Cham hadn&#8217;t a clue what most of it was.  All he saw was a big, futuristic mess.</p>


	<p>He called out again, stumbling through alleys of narrow shelves,  &#8220;Hello-o-o??  I&#8217;m looking for intellegent life!  I&#8217;m a space traveller!&#8221;  He tripped when his foot slid right into a <span class="caps">VCR</span> slot. &#8220;Any other beings I can communicate with?&#8221;</p>


	<p>Hand cupped around mouth, he yelled, &#8220;Hello-o-o?&#8221;</p>


	<p>&#8220;Crying out loud.&#8221;  The sleepy goat came tromping down the aisle.</p>


	<p><img src="../images/dr.cham-5.gif" title="The goat already knows Dr. Cham." alt="The goat already knows Dr. Cham." /></p>


	<p>&#8220;I hate that book,&#8221; said the goat.  &#8220;I believe the author is disingenuous.&#8221;</p>


	<p>&#8220;Really?&#8221; asked Dr. Cham.</p>


	<p>&#8220;I&#8217;m sure it&#8217;s all true.  It&#8217;s just so heavily embellished.  I&#8217;m like:  Enough already.   I get it.  Cut it out.&#8221;</p>


	<p>&#8220;I&#8217;m not quite sure what to make of it,&#8221; said the Doctor.  &#8220;It seems like an honest effort. I actually wrote something in Ruby back there.&#8221;</p>


	<p>&#8220;It doesn&#8217;t give goats a very good name,&#8221; said the goat.</p>


	<p>&#8220;But you are the only goat in the book,&#8221; said the Doctor.</p>


	<p>&#8220;And I&#8217;m totally misquoted.&#8221;</p>


	<p><img src="../images/dr.cham-6.gif" title="The mechanics behind devouring Dr. Cham." alt="The mechanics behind devouring Dr. Cham." /></p>


	<p>The goat closed his mouth and Dr. Cham held his heart.</p>


	<p>&#8220;I&#8217;m actually very literate,&#8221; said the goat.  &#8220;Albeit, more recently, I&#8217;ve switched to movies.  I love foreign films.  One of my relatives just brough back <em>Ishtar</em> from your planet.  Wow, that was excellent.&#8221;</p>

    
    
        
        <div class="sidebar">
        <h1>sidebar!</h1>
        

        <div class='example'><pre><code> <span class="ident">we</span> <span class="ident">want</span> <span class="ident">a</span> <span class="ident">tambourine!</span>
            <span class="punct">/</span><span class="regex">
           |  we want all a tambourine!
           |      </span><span class="punct">/</span>
           \<span class="ident">__</span>  <span class="punct">|</span>
         <span class="punct">/</span><span class="regex">  o o <span class="escape">\_</span>_</span><span class="punct">/\</span><span class="ident">__</span><span class="punct">/\</span><span class="ident">_</span>
       <span class="punct">/</span><span class="regex">.           <span class="escape">\ </span>o o <span class="escape">\_</span>___
        </span><span class="punct">/'</span><span class="string">      ----/          \
 _____ /  </span><span class="punct">'</span>    <span class="punct">/</span> <span class="punct">/</span><span class="regex">.<span class="escape">\\</span>   #------</span><span class="punct">/</span>
        <span class="punct">/</span><span class="regex">     </span><span class="punct">/</span>        <span class="punct">/</span>     \\
              <span class="punct">/</span><span class="regex">       </span><span class="punct">///</span><span class="regex">
       </span><span class="punct">/</span><span class="ident">so</span>               \
            <span class="punct">/</span><span class="regex"><span class="escape">\ </span>  <span class="escape">\m</span>e time<span class="escape">\\</span>..
        </span><span class="punct">/</span><span class="ident">pp</span><span class="punct">/</span>  \<span class="ident">s</span> <span class="ident">these</span> <span class="ident">pictur\\</span>
       <span class="punct">/</span><span class="regex">es</span><span class="punct">/</span>   \<span class="ident">don</span><span class="punct">'</span><span class="string">t w\ \ork out\
      ***      *** right but i
        think this time
           they did
             ooo o
              oo
             o
          o
       {o}
    ^</span></code></pre></div>
        <h1>sidebar!</h1>
        </div>

    
    

        <p>&#8220;I haven&#8217;t been to my planet in a long time.  It would be difficult to consider it my home at this stage.&#8221;</p>


	<p>&#8220;Well, Warren Beatty is delightful.  His character is basically socially crippled.  He actually tries to kill himself, but Dustin Hoffman sits in the window sill and starts crying and singing this totally hilarious heartbreak song.  I&#8217;ve got it here, you should see it.&#8221;</p>


	<p>&#8220;Can I get something to eat?&#8221; asked the Doctor.  And he still felt filthy.</p>


	<p>&#8220;How about we watch a film and you can have a buttermelon with tentacles?&#8221; said the goat.</p>


	<p>So, they worked their way back toward the goat&#8217;s projector.  Back by the freezer locker, they sat on a giant rug and broke off the appendages of frozen buttermelons.  The shell was solid, but once it cracked, rich fruit cream was in abundance.  Sweet to taste and a very pleasant scent.</p>


	<p>&#8220;First film, you&#8217;ve got to see,&#8221; said the goat.  &#8220;Locally filmed and produced.  I&#8217;m good friends with the lady who did casting.  Dated her for awhile.  Knew everyone who was going to play the different roles long before it was announced.&#8221;</p>


	<p>The goat set the projector by Dr. Cham.  &#8220;I&#8217;ve got the music on the surround sound. You can man the knob.&#8221;</p>


	<p><img src="../images/filmstrip-1.gif" title="The Originals and their lonesome planet." alt="The Originals and their lonesome planet." /></p>


	<p>Dr. Cham&#8217;s mind wandered at this point in the presentation, just as the land war mounted between the two throngs of animal settlers.  The details of their wars and campaigns continued to consume the spool of transparent film that Dr. Cham was feeding through the projector.</p>


	<p>War after war after war.  The Sieging of Elmer Lake.  The Last Stand of Newton P. Giraffe and Sons.  Dog Invasion of Little Abandoned Cloud.  No animals died in  these wars.  Most often an attack consisted of bopping another animal on the head.  And they philipped each other&#8217;s noses.  But, believe me, it was humiliating.</p>


	<p>Blasted crying shame.  Things could have worked out.</p>


	<h3>The Birth of an Object</h3>


	<p>&#8220;Don&#8217;t worry,&#8221; said the goat, anxious to sway Dr. Cham&#8217;s attention back to the film.  &#8220;Things <em>do</em> work out.&#8221;</p>


	<p>In Ruby, the Object is the very center of all things.  It is The Original.</p>


<div class='example'><pre><code> <span class="keyword">class </span><span class="class">ToastyBear</span> <span class="punct">&lt;</span> <span class="constant">Object</span><span class="punct">;</span> <span class="keyword">end</span></code></pre></div>

	<p>The angle bracket indicates <strong>inheritance</strong>.  This means that the new <code><span class="constant">ToastyBear</span></code> class is a new class based on the <code><span class="constant">Object</span></code> class.  Every method that <code><span class="constant">Object</span></code> has will be available in <code><span class="constant">ToastyBear</span></code>.  Constants available in <code><span class="constant">Object</span></code> will be available in <code><span class="constant">ToastyBear</span></code>.</p>


	<p>But every object inherits from <code><span class="constant">Object</span></code>.  The code&#8230;</p>


<div class='example'><pre><code> <span class="keyword">class </span><span class="class">ToastyBear</span><span class="punct">;</span> <span class="keyword">end</span></code></pre></div>

	<p>Is identical to&#8230;</p>


<div class='example'><pre><code> <span class="keyword">class </span><span class="class">ToastyBear</span> <span class="punct">&lt;</span> <span class="constant">Object</span><span class="punct">;</span> <span class="keyword">end</span></code></pre></div>

	<p>Inheritance is handy.  You can create species of objects which relate to each other. Often, when you&#8217;re dissecting a problem, you&#8217;ll come across various objects which share attributes.  You can save yourself work by inheriting from classes which already solve part of that problem.</p>


	<p>You may have a <code><span class="constant">UnitedStatesAddress</span></code> class which stores the address, city, state, and zip code for someone living in the United States.  When you start storing addresses from England, you could add a <code><span class="constant">UnitedKingdomAddress</span></code> class.  If you then ensure that both addresses inherit from a parent <code><span class="constant">Address</span></code> class, you can design your mailing software to accept any kind of address.</p>


<div class='example'><pre><code> <span class="keyword">def </span><span class="method">mail_them_a_kit</span><span class="punct">(</span> <span class="ident">address</span> <span class="punct">)</span>
   <span class="keyword">unless</span> <span class="ident">address</span><span class="punct">.</span><span class="ident">is_a?</span> <span class="constant">Address</span>
     <span class="keyword">raise</span> <span class="constant">ArgumentError</span><span class="punct">,</span> <span class="punct">&quot;</span><span class="string">No Address object found.</span><span class="punct">&quot;</span> 
   <span class="keyword">end</span>
   <span class="ident">print</span> <span class="ident">address</span><span class="punct">.</span><span class="ident">formatted</span>
 <span class="keyword">end</span></code></pre></div>

	<p>Also, inheritance is great if you want to override certain behaviours in a class. For example, perhaps you want to make your own slight variation to the <code><span class="constant">Array</span></code> class. You want to enhance the <code><span class="ident">join</span></code> method.  But if you change <code><span class="constant">Array</span><span class="comment">#join</span></code> directly, you will affect other classes in Ruby that use Arrays.</p>


	<p>So you start your own class called <code><span class="constant">ArrayMine</span></code>, which is based on The Original <code><span class="constant">Array</span></code>.</p>


<div class='example'><pre><code> <span class="keyword">class </span><span class="class">ArrayMine</span> <span class="punct">&lt;</span> <span class="constant">Array</span>
   <span class="comment"># Build a string from this array, formatting each entry</span>
   <span class="comment"># then joining them together.</span>
   <span class="keyword">def </span><span class="method">join</span><span class="punct">(</span> <span class="ident">sep</span> <span class="punct">=</span> <span class="global">$,</span><span class="punct">,</span> <span class="ident">format</span> <span class="punct">=</span> <span class="punct">&quot;</span><span class="string">%s</span><span class="punct">&quot;</span> <span class="punct">)</span>
     <span class="ident">collect</span> <span class="keyword">do</span> <span class="punct">|</span><span class="ident">item</span><span class="punct">|</span>
       <span class="ident">sprintf</span><span class="punct">(</span> <span class="ident">format</span><span class="punct">,</span> <span class="ident">item</span> <span class="punct">)</span>
     <span class="keyword">end</span><span class="punct">.</span><span class="ident">join</span><span class="punct">(</span> <span class="ident">sep</span> <span class="punct">)</span>
   <span class="keyword">end</span>
 <span class="keyword">end</span></code></pre></div>

	<p><code><span class="constant">ArrayMine</span></code> is now a custom <code><span class="constant">Array</span></code> class with its own <code><span class="ident">join</span></code> method.  <code><span class="constant">Array</span></code> is the <strong>superclass</strong> of <code><span class="constant">ArrayMine</span></code>.  Every object has a <code><span class="ident">superclass</span></code> method where you can verify this relationship.</p>


<div class='example'><pre><code> <span class="ident">irb</span><span class="punct">&gt;</span> <span class="constant">ArrayMine</span><span class="punct">.</span><span class="ident">superclass</span>
   <span class="punct">=&gt;</span> <span class="constant">Array</span></code></pre></div>

	<p>Perfect.  We manage a hotel and we have an <code><span class="constant">Array</span></code> of our room sizes: <code><span class="punct">[</span><span class="number">3</span><span class="punct">,</span> <span class="number">4</span><span class="punct">,</span> <span class="number">6</span><span class="punct">]</span></code>. Let&#8217;s get it nicely printed for a brochure.</p>


<div class='example'><pre><code> <span class="ident">rooms</span> <span class="punct">=</span> <span class="constant">ArrayMine</span><span class="punct">[</span><span class="number">3</span><span class="punct">,</span> <span class="number">4</span><span class="punct">,</span> <span class="number">6</span><span class="punct">]</span>
 <span class="ident">print</span> <span class="punct">&quot;</span><span class="string">We have </span><span class="punct">&quot;</span> <span class="punct">+</span> <span class="ident">rooms</span><span class="punct">.</span><span class="ident">join</span><span class="punct">(</span> <span class="punct">&quot;</span><span class="string">, </span><span class="punct">&quot;,</span> <span class="punct">&quot;</span><span class="string">%d bed</span><span class="punct">&quot;</span> <span class="punct">)</span> <span class="punct">+</span> <span class="punct">&quot;</span><span class="string"> rooms available.</span><span class="punct">&quot;</span></code></pre></div>

	<p>Which prints, &#8220;We have 3 bed, 4 bed, 6 bed rooms available.&#8221;</p>


	<p>Dr. Cham was looking around for a bathroom, but archival video tape was everywhere. He eventually found a place, it may have been a bathroom.  It had a metal bin. More importantly, it was dark and out of eyesight.</p>


	<p>While he&#8217;s in there, let me add that while The Originals slaughtered The Invaders to prove their rights as First Creatures, the Ruby Object doesn&#8217;t have any such dispute.  It is the absolute king Object the First.</p>


	<p>Watch.</p>


<div class='example'><pre><code> <span class="ident">irb</span><span class="punct">&gt;</span> <span class="constant">Class</span><span class="punct">.</span><span class="ident">superclass</span>
   <span class="punct">=&gt;</span> <span class="constant">Module</span>
 <span class="ident">irb</span><span class="punct">&gt;</span> <span class="constant">Kernel</span><span class="punct">.</span><span class="keyword">class
   </span><span class="class">=&gt;</span> <span class="ident">Module</span>
 <span class="ident">irb</span><span class="punct">&gt;</span> <span class="constant">Module</span><span class="punct">.</span><span class="ident">superclass</span>
   <span class="punct">=&gt;</span> <span class="constant">Object</span>
 <span class="ident">irb</span><span class="punct">&gt;</span> <span class="constant">Object</span><span class="punct">.</span><span class="ident">superclass</span>
   <span class="punct">=&gt;</span> <span class="constant">nil</span></code></pre></div>

	<p>Even <code><span class="constant">Class</span></code> is an <code><span class="constant">Object</span></code>!  See, although classes are the definition language for objects, we still call class methods on them and treat them like objects occassionally.  It may seem like a dizzying circle, but it&#8217;s truly a very strict parentage.  And it ensures that when you alter the <code><span class="constant">Object</span></code>, you alter <strong>everything in Ruby</strong>.  Which is impossibly scary and all-powerful and cataclysmic and awesome!  <strong>Ruby does not restrict you, my sister, my brother!</strong></p>


	<p>Between <code><span class="constant">Class</span></code> and <code><span class="constant">Object</span></code>, do you see <code><span class="constant">Module</span></code>?  If <code><span class="constant">Object</span></code> is the king, the one who has sired every other part of Ruby, then <code><span class="constant">Module</span></code> is the poor waifish nun, shielding and protecting all her little Ruby townspeople children.  (To complete the analogy: <code><span class="constant">Class</span></code> is the village school teacher and <code><span class="constant">Kernel</span></code> is the self-important colonel.)</p>


	<p>The whole point of <code><span class="constant">Module</span></code>&#8217;s existence is to give food and shelter to code.  Methods can stay dry under <code><span class="constant">Module</span></code>&#8217;s shawl.  <code><span class="constant">Module</span></code> can hold classes and constants and  variables of any kind.</p>


	<p>&#8220;But what does a Module <em>do</em>?&#8221; you ask.  &#8220;How is it gainfully employed??&#8221;</p>


	<p>&#8220;That&#8217;s all it does!!&#8221; I retort, stretching out my open palms in the greatest expression of futility known to man.  &#8220;Now hear me <del>- for I will never speak it again -</del> that Module Mother Superior has given these wretched objects a place to stay!!&#8221;</p>


<div class='example'><pre><code> <span class="comment"># See, here is the module -- where else could our code possibly stay?</span>
 <span class="keyword">module </span><span class="module">WatchfulSaintAgnes</span>

   <span class="comment"># A CONSTANT is laying here by the doorway.  Fine.</span>
   <span class="constant">TOOTHLESS_MAN_WITH_FORK</span> <span class="punct">=</span> <span class="punct">['</span><span class="string">man</span><span class="punct">',</span> <span class="punct">'</span><span class="string">fork</span><span class="punct">',</span> <span class="punct">'</span><span class="string">exposed gums</span><span class="punct">']</span>

   <span class="comment"># A Class is eating, living well in the kitchen.</span>
   <span class="keyword">class </span><span class="class">FatWaxyChild</span><span class="punct">;</span> <span class="keyword">end</span>

   <span class="comment"># A Method is hiding back in the banana closet, God knows why.</span>
   <span class="keyword">def </span><span class="method">timid_foxfaced_girl</span><span class="punct">;</span> <span class="punct">{'</span><span class="string">please</span><span class="punct">'</span> <span class="punct">=&gt;</span> <span class="punct">'</span><span class="string">i want an acorn please</span><span class="punct">'};</span> <span class="keyword">end</span>

 <span class="keyword">end</span></code></pre></div>

	<p>Now you have to go through Saint Agnes to find them.</p>


<div class='example'><pre><code> <span class="punct">&gt;&gt;</span> <span class="constant">WatchfulSaintAgnes</span><span class="punct">::</span><span class="constant">TOOTHLESS_MAN_WITH_FORK</span>
 <span class="punct">=&gt;</span> <span class="punct">[&quot;</span><span class="string">man</span><span class="punct">&quot;,</span> <span class="punct">&quot;</span><span class="string">fork</span><span class="punct">&quot;,</span> <span class="punct">&quot;</span><span class="string">exposed gums</span><span class="punct">&quot;]</span>
 <span class="punct">&gt;&gt;</span> <span class="constant">WatchfulSaintAgnes</span><span class="punct">::</span><span class="constant">FatWaxyChild</span><span class="punct">.</span><span class="ident">new</span>
 <span class="punct">=&gt;</span> <span class="comment">#&lt;WatchfulSaintAgnes::FatWaxyChild:0xb7d2ad78&gt;</span>
 <span class="punct">&gt;&gt;</span> <span class="constant">WatchfulSaintAgnes</span><span class="punct">::</span><span class="ident">instance_methods</span>
 <span class="punct">=&gt;</span> <span class="punct">[&quot;</span><span class="string">timid_foxfaced_girl</span><span class="punct">&quot;]</span></code></pre></div>

	<p>Always remember that a <code><span class="constant">Module</span></code> is only an inn.  A roof over their heads.  It is not a self-aware <code><span class="constant">Class</span></code> and, therefore, cannot be brought to life with <code><span class="ident">new</span></code>.</p>


<div class='example'><pre><code> <span class="punct">&gt;&gt;</span> <span class="constant">WatchfulSaintAgnes</span><span class="punct">.</span><span class="ident">new</span>
 <span class="constant">NoMethodError</span><span class="punct">:</span> <span class="ident">undefined</span> <span class="ident">method</span> `<span class="ident">new</span><span class="punct">'</span><span class="string"> for WatchfulSaintAgnes:Module
         from (irb):2</span></code></pre></div>

	<p>St. Agnes has given up her whole life in order that she may care for these desperate bits of code. Please.  Don&#8217;t take that away from her.</p>


	<p>If you wanted to steal from St. Agnes, though, I can help you. You can bring in a larger abbey to swallow up the ministry of <code><span class="constant">WatchfulSaintAgnes</span></code> and then what is she left with?</p>


	<p>For this you can use <code><span class="ident">extend</span></code>, which will pull all the methods from a module into a class or an object.</p>


<div class='example'><pre><code> <span class="punct">&gt;&gt;</span> <span class="keyword">class </span><span class="class">TheTimeWarnerAolCitibankCaringAndLovingFacility</span><span class="punct">;</span> <span class="keyword">end</span>
 <span class="punct">&gt;&gt;</span> <span class="constant">TheTimeWarnerAolCitibankCaringAndLovingFacility</span><span class="punct">.</span><span class="ident">extend</span> <span class="constant">WatchfulSaintAgnes</span>
 <span class="punct">&gt;&gt;</span> <span class="constant">TheTimeWarnerAolCitibankCaringAndLovingFacility</span><span class="punct">::</span><span class="ident">instance_methods</span>
 <span class="punct">=&gt;</span> <span class="punct">[&quot;</span><span class="string">timid_foxfaced_girl</span><span class="punct">&quot;]</span></code></pre></div>

	<p>In truth, no one&#8217;s <em>stolen</em> from <code><span class="constant">WatchfulSaintAgnes</span></code>, only borrowed.  The <code><span class="ident">timid_foxfaced_girl</span></code> now has two addresses.</p>


	<p>You gotta admit.  The old abbey can get bought out a zillion times and that little fox-faced girl will <em>still</em> be back in the banana closet wanting an acorn!  Too bad we can&#8217;t feed her. She&#8217;s a method with no arguments.</p>


	<p>When Dr. Cham came out refreshed, the filmstrip was a bit behind.  But the goat hadn&#8217;t noticed, so the Doctor advanced frames until it made some sense.</p>


	<p><img src="../images/filmstrip-2.gif" title="The goats that told a planet it was ugly." alt="The goats that told a planet it was ugly." /></p>


	<p>So the invaders left the planet.</p>


	<p>&#8220;This planet <em>is</em> decrepit,&#8221; said Dr. Cham.  &#8220;The castle is nice.  But inside it&#8217;s a disaster.&#8221;</p>


	<p>&#8220;The whole castle look is a projection,&#8221; said the goat.  &#8220;All the flowers and apple blossoms and the sky even.  It&#8217;s a low-resolution projection.&#8221;</p>


	<p>&#8220;Yes?  It is enchanting.&#8221;</p>


	<p>&#8220;I guess.&#8221;</p>


	<p><img src="../images/filmstrip-3.gif" title="The spool ends." alt="The spool ends." /></p>


	<p>&#8220;That&#8217;s messed up!&#8221; said the goat.  &#8220;That&#8217;s not the way the film ends! There&#8217;s no blood!  What happened?  What happened?  Did you screw up the knob, idiot?&#8221;</p>


	<p>&#8220;Well, I don&#8217;t know,&#8221; said Dr. Cham.  He turned the knob reverse and forward. Tapped the lens.</p>


	<p>&#8220;Check the film!  Check the film!&#8221;</p>


	<p>Dr. Cham pulled out a length of film from the projection feed, melted and dripping from its end.</p>


	<p>&#8220;Curse that!  These projectors are quality!  I&#8217;ve never had this happen.  There&#8217;s no way.&#8221;</p>


	<h3>Hunting For a Voice</h3>


	<p>&#8220;I don&#8217;t think it was the projector,&#8221; said Dr. Cham.  &#8220;Something flew across that screen and uttered a blistering moan.&#8221;</p>


	<p>&#8220;I don&#8217;t have any dupes of that movie,&#8221; said the goat somberly.  &#8220;And that girl.  That casting director.  I never see her anymore.&#8221;</p>


	<p>Dr. Cham stood up and looked over the dumpy aisles of magnetic carnage, searching.</p>


	<p>&#8220;Oh, hey, you should call that girl,&#8221; the goat went on. &#8220;You could talk to her, get an understanding. Tell her about me.  Don&#8217;t act like your my friend, just, you know, &#8216;Oh, that guy? Yeah, whatta maroon.&#8217;&#8221;</p>


	<p>Dr. Cham spotted the doorway and exited.</p>


	<p>The hallways were an entirely new world of mess.  In the goat&#8217;s archives, the shelves had been messy. In the hallway, shelves were completely tipped.  Sinks were falling through the ceiling.   The Doctor ventured under the debris, kicking through plywood when necessary.</p>


	<p>&#8220;You shouldn&#8217;t be out here,&#8221; said the goat.  &#8220;You&#8217;re on someone else&#8217;s property at this point. A couple of pygmy elephants own all this.  They&#8217;re nasty guys.  They&#8217;ll beat the crap outta you with their trunks.  They ball it up and just whack ya.&#8221;</p>


	<p>Dr. Cham pushed a file cabinet out of his way, which fell through a flimsy wall, then through the floor of the next room over.  And they heard it fall through several floors after that.</p>


	<p>&#8220;I&#8217;m trying to remember how it goes in the book,&#8221; said Dr. Cham, as he walked swiftly through the hall.  &#8220;That milky fog that swept across the projection.  We find that thing.&#8221;  He jiggled a door handle, broke it off.  Forged through the doorway and disappeared inside.</p>


	<p>&#8220;You really get a kick out of beating stuff up, don&#8217;t you?&#8221; said the goat.  &#8220;Walls, doors.&#8221; The goat headbutted a wall.  The wall shuddered and then laid still.</p>


	<p>Then, it was quiet.  And black.</p>


	<p>The goat stayed put in the bleak hallway, expecting Dr. Cham to flip over a few desks and emerge, ready to move on from the room he&#8217;d busted into.  But Dr. Cham didn&#8217;t return, and the goat opted to share a moment with the neglected wreckage left by his neighbors.  Not that he could see at all. He could only hear the occassional rustling of the piles of invoices and carbon copy masters and manila envelopes when he shifted his legs.</p>


	<p>The ground seemed to buckling right under the goat, as if the heaps of kipple around him were beginning to slide toward his weight.  He would be at the center of this whirlpool of elephant documentation.  Would he die of papercuts first?  Or would he suffocate under the solid burial by office supplies?</p>


	<p>A soft light, however, crept up to him.  A floating, silver fish.  No, it was a&#8212;was it scissors? The scissors grew into a shimmering cluster of intellegent bread, each slice choking on glitter. But, no, it was hands.  And an Easter hat.</p>


	<p><img src="../images/hannah-1.gif" title="The goat alone in the hallway, meets an apparition." alt="The goat alone in the hallway, meets an apparition." /></p>


	<p>In another room, Dr. Cham stood under the clear glass silently.  The ceiling had abruptly gone transparent, then starlight washed over his pants and jacket.  He walked further to the room&#8217;s center in muted colors, lit as softly as an ancient manuscript in its own box at the museum.  More stars, more cotton clusters of fire, unveiled as he came across the floor. And it peeked into view soon enough, he expected it to be larger, but it wasn&#8217;t.</p>


	<p>Earth.  Like a painted egg, still fresh.  He felt long cello strings sing right up against his spine.  How could that be called Peoplemud?  Here was a vibrant and grassy lightbulb.  The one big ball that had something going for it.</p>


	<p>He thought of The Rockettes.  Actually, he missed The Rockettes.  What a bunch of great dancers.  He had yelled something to The Rockettes when he saw them.  Something very observant and flattering.</p>


	<p>Oh, yes, while The Rockettes were spinning, arm in arm, he had yelled, &#8220;Concentric circles!&#8221; Which no one else cared to observe.</p>


	<p>And this thought was enough to feed Dr. Cham&#8217;s superiority complex.  He wore a goofy smile as he retraced his footsteps.  He truthfully felt his genius coming through in such a statement.  To realize the simplicity of a circle was his.  He reflected on it all the way back to the hallway.</p>


	<p>Which I think is great.  Adore yourself when you have a second.</p>


	<p><img src="../images/hannah-2.gif" title="The Doctor knows this ghost." alt="The Doctor knows this ghost." /></p>


	<p>&#8220;Oh, right,&#8221; said the goat.  &#8220;Your niece.  The niece you killed.  I&#8217;m with ya now.&#8221;</p>


	<p>For just a few moments, they all looked at each other.  Just enough time for both Dr. Cham and the goat to think: <em>Oh, yeah.  Hannah causes us a lot of trouble.  She&#8217;s already talking about maple donuts.</em></p>


	<p>&#8220;Does she start talking about maple donuts right away like that?&#8221; asked the goat.</p>


	<p>&#8220;Yes, she does,&#8221; said the Doctor.  &#8220;She brings it up to you, then she brings it up to me.  She sees a maple donut somewhere&#8212;I don&#8217;t quite remember where.&#8221;</p>


	<p>&#8220;Do I see a real maple donut?&#8221; Hannah said.  &#8220;I need a real one.&#8221;</p>


	<p>&#8220;Okay, okay,&#8221; said the goat.  &#8220;Yeah, I remember: here&#8217;s where she says that if she gets a real maple donut, she&#8217;ll become a real person again. Because her real destiny was to own a bakery and you ruined that destiny and now she&#8217;s trapped as a ghost.&#8221;</p>


	<p>&#8220;Hey, that&#8217;s the truth!&#8221; Hannah yelped.</p>


	<p>&#8220;It&#8217;s terrible that we must bear through this whole scene again,&#8221; said the Doctor.  &#8220;The donuts are immaterial.  They should be left out altogether.&#8221;</p>


	<p>&#8220;Man, I am having a <em>hard</em> time remembering all of this chapter,&#8221; said the goat.  &#8220;I don&#8217;t even remember how to get out of this hallway.  I must have read that book like thirty times.  Do we blast through a wall?   Do we scream until someone finds us?&#8221;</p>


	<p>&#8220;We get Hannah to float through walls and she finds some kind of machine,&#8221; says Dr. Cham.  &#8220;I have to write a program&#8212;it all works out somehow.&#8221;</p>


	<p>&#8220;But, you know what I&#8217;m saying?&#8221; said the goat.  &#8220;I forget all the details. Especially the earlier chapters.  I mean I can remember the ending perfectly. It&#8217;s hard to sit through all this.  The end is so much better.&#8221;</p>


	<p>Dr. Cham folded his arms and teetered on a heel.  &#8220;The porcupine.&#8221;  He smiled greedily at the goat.</p>


	<p>&#8220;Oh, totally.  The porcupine is definitely who I want to meet,&#8221; said the goat.  &#8220;I wonder what he does with all that money when the book is over.&#8221;</p>


	<p>Dr. Cham nodded respectfully.  &#8220;I&#8217;m very excited to see him wearing slippers.&#8221;</p>


	<p>&#8220;Those infernal slippers!&#8221; said the goat and he haw-hawed coarsely, a shower of saliva cascading from his jaws.</p>


	<p>Hannah&#8217;s mind rattled, waiting for this nonsense to break for a moment. She tipped her head on its side and the rattle slid along the curve of her cranium.  The little noise died away, though, as the back of her head vanished (<em>fluxed out</em> is what she called it) and then her head was   back again with its little rattle and she caught herself doing that careless moaning again.  <strong><span class="caps">HRRRRRR</span>-RRR-OH-RRRR-RRRR.</strong></p>


	<p>&#8220;I&#8217;m not as into the chunky bacon stuff,&#8221; said the goat.  &#8220;I don&#8217;t see what&#8217;s so great about it.&#8221;</p>


	<p>Could she speak while moaning? <strong><span class="caps">BON</span>-BON.</strong>  With a French moan.  <strong><span class="caps">BOHN</span>-BOHN. <span class="caps">BOHN</span>-APPE-TEET-OHHHH-RRRR.</strong></p>


	<p>&#8220;I know she&#8217;s harmless, but that sound freaks me out.  My hair is <strong>completely</strong> on end.&#8221;</p>


	<p>&#8220;Hannah?&#8221; said Dr. Cham.  &#8220;Where are you, child?  Come do a good turn for us, my niece.&#8221;</p>


	<p>She was right near them, in and out.  And they could hear her cleaning up her voice, bright, speaking like a angel scattering stardust. Yes, the whole maple donut story came out again, and more about the bakery she would own, the muffins and rolls and baguettes.</p>

    
    
        
        <a name="section5" />
        <h2>5. The Theft of the Lottery Captain</h2>

        <p style="float:right"><img src="../images/my.daughters.organ-3.gif" title="The piping and mixtures of the lotteries." alt="The piping and mixtures of the lotteries." /></p>


	<p>And now, Paij-ree&#8217;s stories of the Lotteries.</p>


	<p>On Endertromb, the organist&#8217;s father invented the lottery.  The idea came while he was praying to Digger Dosh.</p>


	<p>Digger Dosh is sort of like their God.  But ten times scarier.  This guy dug an infinitely deep tunnel straight through the planet and came out dead. But he&#8217;s really not dead.  He&#8217;s really just <em>one second</em> behind them.  And he eats time.</p>


	<p>It&#8217;s kind of complicated because Digger Dosh totally kills people.  But I guess if  you do what he says, it&#8217;s not so bad.  Maybe I&#8217;ll talk about it later.  It&#8217;s such a pain to talk about because it&#8217;s so scary and yet one of my friends actually believes the whole thing.  I get kind of choked up&#8212;not like I&#8217;m crying, more like I&#8217;m choking.</p>


	<p>Anyway, once while praying, three numbers came to Paij-ree&#8217;s father.</p>


	<p>He then asked his mind, &#8220;What are these numbers?&#8221;</p>


	<p>And his mind played a short video clip of him selling all kinds of numbers.  And, for years and years, travelling and selling numbers.</p>


	<p>And he asked his brain, &#8220;People will buy numbers?&#8221;</p>


	<p>And his brain said, &#8220;If they buy the right three numbers, give them a prize.&#8221;</p>


	<p>At which he imagined himself launching off a ski jump and showering people with presents.  No question: he would be an icon.</p>


	<p>So he went and did as his brain said and sold numbers.  The father&#8217;s simple lottery consisted of three unique numbers, drawn from a set of 25 numbers.</p>


<div class='example'><pre><code> <span class="keyword">class </span><span class="class">LotteryTicket</span>

   <span class="constant">NUMERIC_RANGE</span> <span class="punct">=</span> <span class="number">1</span><span class="punct">..</span><span class="number">25</span>

   <span class="ident">attr_reader</span> <span class="symbol">:picks</span><span class="punct">,</span> <span class="symbol">:purchased</span>

   <span class="keyword">def </span><span class="method">initialize</span><span class="punct">(</span> <span class="punct">*</span><span class="ident">picks</span> <span class="punct">)</span>
     <span class="keyword">if</span> <span class="ident">picks</span><span class="punct">.</span><span class="ident">length</span> <span class="punct">!=</span> <span class="number">3</span>
       <span class="keyword">raise</span> <span class="constant">ArgumentError</span><span class="punct">,</span> <span class="punct">&quot;</span><span class="string">three numbers must be picked</span><span class="punct">&quot;</span> 
     <span class="keyword">elsif</span> <span class="ident">picks</span><span class="punct">.</span><span class="ident">uniq</span><span class="punct">.</span><span class="ident">length</span> <span class="punct">!=</span> <span class="number">3</span>
       <span class="keyword">raise</span> <span class="constant">ArgumentError</span><span class="punct">,</span> <span class="punct">&quot;</span><span class="string">the three picks must be different numbers</span><span class="punct">&quot;</span> 
     <span class="keyword">elsif</span> <span class="ident">picks</span><span class="punct">.</span><span class="ident">detect</span> <span class="punct">{</span> <span class="punct">|</span><span class="ident">p</span><span class="punct">|</span> <span class="keyword">not</span> <span class="constant">NUMERIC_RANGE</span> <span class="punct">===</span> <span class="ident">p</span> <span class="punct">}</span>
       <span class="keyword">raise</span> <span class="constant">ArgumentError</span><span class="punct">,</span> <span class="punct">&quot;</span><span class="string">the three picks must be numbers between 1 and 25.</span><span class="punct">&quot;</span> 
     <span class="keyword">end</span>
     <span class="attribute">@picks</span> <span class="punct">=</span> <span class="ident">picks</span>
     <span class="attribute">@purchased</span> <span class="punct">=</span> <span class="constant">Time</span><span class="punct">.</span><span class="ident">now</span>
   <span class="keyword">end</span>

 <span class="keyword">end</span></code></pre></div>

	<p>Yes, the <code><span class="constant">LotteryTicket</span></code> class contained the three numbers (<code><span class="attribute">@picks</span></code>) and the time when the ticket was bought (<code><span class="attribute">@purchased</span></code>).  The allowed range of numbers (from <strong>one</strong> to <strong>twenty-five</strong>) is kept in the constant <code><span class="constant">NUMERIC_RANGE</span></code>.</p>


	<p>The <code><span class="ident">initialize</span></code> method here can have any number of arguments passed in.  The <strong>asterisk</strong> in the <code><span class="ident">picks</span></code> argument means that <strong>any arguments will be passed in as an Array</strong>.  Having the arguments in an Array means that methods like <code><span class="ident">uniq</span></code> and <code><span class="ident">detect</span></code> can be used on the arguments together.</p>


	<p>This class contains two definitions: the method definition (<code><span class="keyword">def</span></code>) and an attributes definition (<code><span class="ident">attr_reader</span></code>).  Both are <strong>really just method definitions</strong> though.</p>


	<p>The <code><span class="ident">attr_reader</span></code> shortcut is identical to writing this Ruby code:</p>


<div class='example'><pre><code> <span class="keyword">class </span><span class="class">LotteryTicket</span>
   <span class="keyword">def </span><span class="method">picks</span><span class="punct">;</span> <span class="attribute">@picks</span><span class="punct">;</span> <span class="keyword">end</span>
   <span class="keyword">def </span><span class="method">purchased</span><span class="punct">;</span> <span class="attribute">@purchased</span><span class="punct">;</span> <span class="keyword">end</span>
 <span class="keyword">end</span></code></pre></div>

	<p>Attributes are wrapper methods for instance variables (such as <code><span class="attribute">@picks</span></code>) which can be used <strong>outside of the class itself</strong>.  Paij-ree&#8217;s father wanted to code a machine which could read the numbers and the date of purchase from the ticket.  In order to do that, those instance variables must be exposed.</p>


	<p>Let&#8217;s create a random ticket and read back the numbers:</p>


<div class='example'><pre><code> <span class="ident">ticket</span> <span class="punct">=</span> <span class="constant">LotteryTicket</span><span class="punct">.</span><span class="ident">new</span><span class="punct">(</span> <span class="ident">rand</span><span class="punct">(</span> <span class="number">25</span> <span class="punct">)</span> <span class="punct">+</span> <span class="number">1</span><span class="punct">,</span>
             <span class="ident">rand</span><span class="punct">(</span> <span class="number">25</span> <span class="punct">)</span> <span class="punct">+</span> <span class="number">1</span><span class="punct">,</span> <span class="ident">rand</span><span class="punct">(</span> <span class="number">25</span> <span class="punct">)</span> <span class="punct">+</span> <span class="number">1</span> <span class="punct">)</span>
 <span class="ident">p</span> <span class="ident">ticket</span><span class="punct">.</span><span class="ident">picks</span></code></pre></div>

	<p>Running the above, I just got: <code><span class="punct">[</span><span class="number">23</span><span class="punct">,</span> <span class="number">14</span><span class="punct">,</span> <span class="number">20</span><span class="punct">]</span></code>.  You will get an error if two of the random numbers happen to be identical.</p>


	<p>However, I can&#8217;t change the lottery ticket&#8217;s picks from outside of the class.</p>


<div class='example'><pre><code> <span class="ident">ticket</span><span class="punct">.</span><span class="ident">picks</span> <span class="punct">=</span> <span class="punct">[</span><span class="number">2</span><span class="punct">,</span> <span class="number">6</span><span class="punct">,</span> <span class="number">19</span><span class="punct">]</span></code></pre></div>

	<p>I get an error: <code><span class="ident">undefined</span> <span class="ident">method</span> `<span class="ident">picks</span><span class="punct">='</span><span class="string"></span></code>. This is because <code><span class="ident">attr_reader</span></code> only adds a <strong>reader</strong> method, not a writer method. That&#8217;s fine, though.  We don&#8217;t want the numbers or the date to change.</p>


	<p>So, the tickets are <em>objects</em>.  Instances of the <code><span class="constant">LotteryTicket</span></code> class.  Make a ticket with <code><span class="constant">LotteryTicket</span><span class="punct">.</span><span class="ident">new</span></code>.  Each ticket has it&#8217;s own <code><span class="attribute">@picks</span></code> and it&#8217;s own <code><span class="attribute">@purchased</span></code> instance variables.</p>


	<p>The lottery captain would need to draw three random numbers at the close of the lottery, so we&#8217;ll add a convenient class method for generating random tickets.</p>


<div class='example'><pre><code> <span class="keyword">class </span><span class="class">LotteryTicket</span>
   <span class="keyword">def </span><span class="method">self.new_random</span>
     <span class="ident">new</span><span class="punct">(</span> <span class="ident">rand</span><span class="punct">(</span> <span class="number">25</span> <span class="punct">)</span> <span class="punct">+</span> <span class="number">1</span><span class="punct">,</span> <span class="ident">rand</span><span class="punct">(</span> <span class="number">25</span> <span class="punct">)</span> <span class="punct">+</span> <span class="number">1</span><span class="punct">,</span> <span class="ident">rand</span><span class="punct">(</span> <span class="number">25</span> <span class="punct">)</span> <span class="punct">+</span> <span class="number">1</span> <span class="punct">)</span>
   <span class="keyword">end</span>
 <span class="keyword">end</span></code></pre></div>

	<p>Oh, no.  But we have that stupid error that pops up if two of the random numbers happen to be identical.  If two numbers are the same, the <code><span class="ident">initialize</span></code> throws an <code><span class="constant">ArgumentError</span></code>.</p>


	<p>The trick is going to be restarting the method if an error happens. We can use Ruby&#8217;s <code><span class="keyword">rescue</span></code> to handle the error and <code><span class="keyword">redo</span></code> to start the method over.</p>


<div class='example'><pre><code> <span class="keyword">class </span><span class="class">LotteryTicket</span>
   <span class="keyword">def </span><span class="method">self.new_random</span>
     <span class="ident">new</span><span class="punct">(</span> <span class="ident">rand</span><span class="punct">(</span> <span class="number">25</span> <span class="punct">)</span> <span class="punct">+</span> <span class="number">1</span><span class="punct">,</span> <span class="ident">rand</span><span class="punct">(</span> <span class="number">25</span> <span class="punct">)</span> <span class="punct">+</span> <span class="number">1</span><span class="punct">,</span> <span class="ident">rand</span><span class="punct">(</span> <span class="number">25</span> <span class="punct">)</span> <span class="punct">+</span> <span class="number">1</span> <span class="punct">)</span>
   <span class="keyword">rescue</span> <span class="constant">ArgumentError</span>
     <span class="keyword">redo</span>
   <span class="keyword">end</span>
 <span class="keyword">end</span></code></pre></div>

	<p>Better.  It may take a couple times for the numbers to fall together right, but it&#8217;ll happen.  The wait will build suspense, huh?</p>


	<p>The lottery captain kept a roster of everyone who bought tickets, along with the numbers they drew.</p>


<div class='example'><pre><code> <span class="keyword">class </span><span class="class">LotteryDraw</span>
   <span class="attribute">@@tickets</span> <span class="punct">=</span> <span class="punct">{}</span>
   <span class="keyword">def </span><span class="method">LotteryDraw.buy</span><span class="punct">(</span> <span class="ident">customer</span><span class="punct">,</span> <span class="punct">*</span><span class="ident">tickets</span> <span class="punct">)</span>
     <span class="keyword">unless</span> <span class="attribute">@@tickets</span><span class="punct">.</span><span class="ident">has_key?</span><span class="punct">(</span> <span class="ident">customer</span> <span class="punct">)</span>
       <span class="attribute">@@tickets</span><span class="punct">[</span><span class="ident">customer</span><span class="punct">]</span> <span class="punct">=</span> <span class="punct">[]</span>
     <span class="keyword">end</span>
     <span class="attribute">@@tickets</span><span class="punct">[</span><span class="ident">customer</span><span class="punct">]</span> <span class="punct">+=</span> <span class="ident">tickets</span>
   <span class="keyword">end</span>
 <span class="keyword">end</span></code></pre></div>

	<p>Yal-dal-rip-sip was the first customer.</p>


<div class='example'><pre><code> <span class="constant">LotteryDraw</span><span class="punct">.</span><span class="ident">buy</span> <span class="punct">'</span><span class="string">Yal-dal-rip-sip</span><span class="punct">',</span>
     <span class="constant">LotteryTicket</span><span class="punct">.</span><span class="ident">new</span><span class="punct">(</span> <span class="number">12</span><span class="punct">,</span> <span class="number">6</span><span class="punct">,</span> <span class="number">19</span> <span class="punct">),</span>
     <span class="constant">LotteryTicket</span><span class="punct">.</span><span class="ident">new</span><span class="punct">(</span> <span class="number">5</span><span class="punct">,</span> <span class="number">1</span><span class="punct">,</span> <span class="number">3</span> <span class="punct">),</span>
     <span class="constant">LotteryTicket</span><span class="punct">.</span><span class="ident">new</span><span class="punct">(</span> <span class="number">24</span><span class="punct">,</span> <span class="number">6</span><span class="punct">,</span> <span class="number">8</span> <span class="punct">)</span></code></pre></div>

	<p>When it came time for the lottery draw, Paij-ree&#8217;s father (the lottery captain) added a bit of code to randomly select the numbers.</p>


<div class='example'><pre><code> <span class="keyword">class </span><span class="class">LotteryTicket</span>
   <span class="keyword">def </span><span class="method">score</span><span class="punct">(</span> <span class="ident">final</span> <span class="punct">)</span>
     <span class="ident">count</span> <span class="punct">=</span> <span class="number">0</span>
     <span class="ident">final</span><span class="punct">.</span><span class="ident">picks</span><span class="punct">.</span><span class="ident">each</span> <span class="keyword">do</span> <span class="punct">|</span><span class="ident">note</span><span class="punct">|</span>
       <span class="ident">count</span> <span class="punct">+=</span><span class="number">1</span> <span class="keyword">if</span> <span class="ident">picks</span><span class="punct">.</span><span class="ident">include?</span> <span class="ident">note</span>
     <span class="keyword">end</span>
     <span class="ident">count</span>
   <span class="keyword">end</span>
 <span class="keyword">end</span></code></pre></div>

	<p>The <code><span class="ident">score</span></code> method compares a <code><span class="constant">LotteryTicket</span></code> against a random ticket, which represents the winning combination.  The random ticket is passed in through the <code><span class="ident">final</span></code> variable.  The ticket gets one point for every winning number.  The point total is returned from the <code><span class="ident">score</span></code> method.</p>


<div class='example'><pre><code> <span class="ident">irb</span><span class="punct">&gt;</span> <span class="ident">ticket</span> <span class="punct">=</span> <span class="constant">LotteryTicket</span><span class="punct">.</span><span class="ident">new</span><span class="punct">(</span> <span class="number">2</span><span class="punct">,</span> <span class="number">5</span><span class="punct">,</span> <span class="number">19</span> <span class="punct">)</span>
 <span class="ident">irb</span><span class="punct">&gt;</span> <span class="ident">winner</span> <span class="punct">=</span> <span class="constant">LotteryTicket</span><span class="punct">.</span><span class="ident">new</span><span class="punct">(</span> <span class="number">4</span><span class="punct">,</span> <span class="number">5</span><span class="punct">,</span> <span class="number">19</span> <span class="punct">)</span>
 <span class="ident">irb</span><span class="punct">&gt;</span> <span class="ident">ticket</span><span class="punct">.</span><span class="ident">score</span><span class="punct">(</span> <span class="ident">winner</span> <span class="punct">)</span>
   <span class="punct">=&gt;</span> <span class="number">2</span></code></pre></div>

	<p>You will see how brilliant Paij-ree is, in time.  His father commissioned him to finish the lottery for him, while the demand for tickets consumed the lottery captain&#8217;s daylight hours.  Can&#8217;t you just imagine young Paij-ree in his stuffy suit, snapping a rubber band in his young thumbs at the company meetings where he proposed the final piece of the system?  Sure, when he stood up, his dad did all the talking for him, but he flipped on the projector and performed all the hand motions.</p>


<div class='example'><pre><code> <span class="keyword">class </span><span class="punct">&lt;&lt;</span> <span class="constant">LotteryDraw</span>
   <span class="keyword">def </span><span class="method">play</span>
     <span class="ident">final</span> <span class="punct">=</span> <span class="constant">LotteryTicket</span><span class="punct">.</span><span class="ident">new_random</span>
     <span class="ident">winners</span> <span class="punct">=</span> <span class="punct">{}</span>
     <span class="attribute">@@tickets</span><span class="punct">.</span><span class="ident">each</span> <span class="keyword">do</span> <span class="punct">|</span><span class="ident">buyer</span><span class="punct">,</span> <span class="ident">ticket_list</span><span class="punct">|</span>
       <span class="ident">ticket_list</span><span class="punct">.</span><span class="ident">each</span> <span class="keyword">do</span> <span class="punct">|</span><span class="ident">ticket</span><span class="punct">|</span>
         <span class="ident">score</span> <span class="punct">=</span> <span class="ident">ticket</span><span class="punct">.</span><span class="ident">score</span><span class="punct">(</span> <span class="ident">final</span> <span class="punct">)</span>
         <span class="keyword">next</span> <span class="keyword">if</span> <span class="ident">score</span><span class="punct">.</span><span class="ident">zero?</span>
         <span class="ident">winners</span><span class="punct">[</span><span class="ident">buyer</span><span class="punct">]</span> <span class="punct">||=</span> <span class="punct">[]</span>
         <span class="ident">winners</span><span class="punct">[</span><span class="ident">buyer</span><span class="punct">]</span> <span class="punct">&lt;&lt;</span> <span class="punct">[</span> <span class="ident">ticket</span><span class="punct">,</span> <span class="ident">score</span> <span class="punct">]</span>
       <span class="keyword">end</span>
     <span class="keyword">end</span>
     <span class="attribute">@@tickets</span><span class="punct">.</span><span class="ident">clear</span>
     <span class="ident">winners</span>
   <span class="keyword">end</span>
 <span class="keyword">end</span></code></pre></div>

	<p>His father&#8217;s associates were stunned.  What was this?  (Paij-ree knew this was just another class method definition&#8212;they would all feel completely demoralized when he told them so.)  They couldn&#8217;t understand the <strong>double angle bracket</strong> up there!  Yes, it was a concatenator, but how is it in the class title?</p>


	<p><em>Infants</em>, thought Paij-ree, although he held everyone of those men in very high esteem.  He was just a kid and kids are tough as a brick&#8217;s teeth.</p>


	<p>The <code><span class="punct">&lt;&lt;</span></code> operator allows you to alter the definition of an object. Had Paij-ree simply used <code><span class="keyword">class </span><span class="class">LotteryDraw</span></code>, his <code><span class="ident">play</span></code> method would be a normal instance method.  But since he used the <code><span class="punct">&lt;&lt;</span></code> operator, the <code><span class="ident">play</span></code> method will be added directly to the class, as a class method.</p>


	<p>When you see <code><span class="keyword">class </span><span class="punct">&lt;&lt;</span> <span class="ident">obj</span></code>, believe in your heart, <em>I&#8217;m adding directly to the definition of <code><span class="ident">obj</span></code>.</em></p>


	<p>The budding organ instructor also threw in a tricky syntax worth examining. In the ninth line, a winner has been found.</p>


<div class='example'><pre><code> <span class="ident">winners</span><span class="punct">[</span><span class="ident">buyer</span><span class="punct">]</span> <span class="punct">||=</span> <span class="punct">[]</span>
 <span class="ident">winners</span><span class="punct">[</span><span class="ident">buyer</span><span class="punct">]</span> <span class="punct">&lt;&lt;</span> <span class="punct">[</span> <span class="ident">ticket</span><span class="punct">,</span> <span class="ident">score</span> <span class="punct">]</span></code></pre></div>

	<p>The <code><span class="punct">||=</span></code> syntax is a shortcut.</p>


<div class='example'><pre><code> <span class="ident">winners</span><span class="punct">[</span><span class="ident">buyer</span><span class="punct">]</span> <span class="punct">=</span> <span class="ident">winners</span><span class="punct">[</span><span class="ident">buyer</span><span class="punct">]</span> <span class="punct">||</span> <span class="punct">[]</span></code></pre></div>

	<p>The <strong>double pipe</strong> is an <strong>or</strong> logic.  Set <code><span class="ident">winners</span><span class="punct">[</span><span class="ident">buyer</span><span class="punct">]</span></code> equal to <code><span class="ident">winners</span><span class="punct">[</span><span class="ident">buyer</span><span class="punct">]</span></code> or, if <code><span class="ident">winners</span><span class="punct">[</span><span class="ident">buyer</span><span class="punct">]</span></code> is nil, set it to <code><span class="punct">[]</span></code>.  This shortcut is a little strange, but if you can really plant it in your head, it&#8217;s a nice timesaver.  You&#8217;re just making sure a variable is set before using it.</p>


<div class='example'><pre><code> <span class="ident">irb</span><span class="punct">&gt;</span> <span class="constant">LotteryDraw</span><span class="punct">.</span><span class="ident">play</span><span class="punct">.</span><span class="ident">each</span> <span class="keyword">do</span> <span class="punct">|</span><span class="ident">winner</span><span class="punct">,</span> <span class="ident">tickets</span><span class="punct">|</span>
 <span class="ident">irb</span><span class="punct">&gt;</span>   <span class="ident">puts</span> <span class="ident">winner</span> <span class="punct">+</span> <span class="punct">&quot;</span><span class="string">won on </span><span class="punct">&quot;</span> <span class="punct">+</span> <span class="ident">tickets</span><span class="punct">.</span><span class="ident">length</span> <span class="punct">+</span> <span class="punct">&quot;</span><span class="string"> ticket(s)!</span><span class="punct">&quot;</span> 
 <span class="ident">irb</span><span class="punct">&gt;</span>   <span class="ident">tickets</span><span class="punct">.</span><span class="ident">each</span> <span class="keyword">do</span> <span class="punct">|</span><span class="ident">ticket</span><span class="punct">,</span> <span class="ident">score</span><span class="punct">|</span>
 <span class="ident">irb</span><span class="punct">&gt;</span>     <span class="ident">puts</span> <span class="punct">&quot;</span><span class="string"><span class="escape">\t</span></span><span class="punct">&quot;</span> <span class="punct">+</span> <span class="ident">ticket</span><span class="punct">.</span><span class="ident">picks</span><span class="punct">.</span><span class="ident">join</span><span class="punct">(</span> <span class="punct">'</span><span class="string">, </span><span class="punct">'</span> <span class="punct">)</span> <span class="punct">+</span> <span class="punct">&quot;</span><span class="string">: </span><span class="punct">&quot;</span> <span class="punct">+</span> <span class="ident">score</span>
 <span class="ident">irb</span><span class="punct">&gt;</span>   <span class="keyword">end</span>
 <span class="ident">irb</span><span class="punct">&gt;</span> <span class="keyword">end</span>

 <span class="constant">Gram</span><span class="punct">-</span><span class="ident">yol</span> <span class="ident">won</span> <span class="ident">on</span> <span class="number">2</span> <span class="ident">ticket</span><span class="punct">(</span><span class="ident">s</span><span class="punct">)!</span>
     <span class="number">25</span><span class="punct">,</span> <span class="number">14</span><span class="punct">,</span> <span class="number">33</span><span class="punct">:</span> <span class="number">1</span>
     <span class="number">12</span><span class="punct">,</span> <span class="number">11</span><span class="punct">,</span> <span class="number">29</span><span class="punct">:</span> <span class="number">1</span>
 <span class="constant">Tarker</span><span class="punct">-</span><span class="ident">azain</span> <span class="ident">won</span> <span class="ident">on</span> <span class="number">1</span> <span class="ident">ticket</span><span class="punct">(</span><span class="ident">s</span><span class="punct">)!</span>
     <span class="number">13</span><span class="punct">,</span> <span class="number">15</span><span class="punct">,</span> <span class="number">29</span><span class="punct">:</span> <span class="number">2</span>
 <span class="constant">Bramlor</span><span class="punct">-</span><span class="ident">exxon</span> <span class="ident">won</span> <span class="ident">on</span> <span class="number">1</span> <span class="ident">ticket</span><span class="punct">(</span><span class="ident">s</span><span class="punct">)!</span>
     <span class="number">2</span><span class="punct">,</span> <span class="number">6</span><span class="punct">,</span> <span class="number">14</span><span class="punct">:</span> <span class="number">1</span></code></pre></div>

	<p>But these salad days were not to continue for Paij-ree and his father.  His father often neglected to launder his uniform and contracted a moss disease on his shoulders.  The disease gradually stole his equilibrium and his sense of direction.</p>


	<p>His father still futilely attempted to keep the business running.  He spiraled through the city, sometimes tumbling leg-over-leg down the cobbled stone, most often slowly feeling the walls, counting bricks to the math parlours and coachmen stations, where he would thrust tickets at the bystanders, who hounded him and slapped him away with long, wet beets.  Later, Paij-ree would find him in a corner, his blood running into the city drains alongside the juices of the dark, splattered beets, which juice weaseled its way up into his veins and stung and clotted and glowed fiercely like a congested army of brake lights fighting their way through toll bridges.</p>


	<h3>A Word About Accessors (Because I Love You and I Hope For Your Success and My Hair is On End About This and Dreams Really Do Come True)</h3>


	<p>Earlier, I mentioned that <code><span class="ident">attr_reader</span></code> adds <strong>reader</strong> methods, but not <strong>writer</strong> methods.</p>


<div class='example'><pre><code> <span class="ident">irb</span><span class="punct">&gt;</span> <span class="ident">ticket</span> <span class="punct">=</span> <span class="constant">LotteryTicket</span><span class="punct">.</span><span class="ident">new</span>
 <span class="ident">irb</span><span class="punct">&gt;</span> <span class="ident">ticket</span><span class="punct">.</span><span class="ident">picks</span> <span class="punct">=</span> <span class="number">3</span>
 <span class="constant">NoMethodError</span><span class="punct">:</span> <span class="ident">undefined</span> <span class="ident">method</span> `<span class="ident">picks</span><span class="punct">='</span><span class="string"> for #&lt;LotteryTicket:0xb7d49110&gt;</span></code></pre></div>

	<p>Which is okay in this case, since Paij-ree&#8217;s father didn&#8217;t want the numbers to be changed after the ticket was bought.  If we were interested in having instance variables which had <strong>both readers and writers</strong>, we would use <code><span class="ident">attr_accessor</span></code>.</p>


<div class='example'><pre><code> <span class="keyword">class </span><span class="class">LotteryTicket</span>
   <span class="ident">attr_accessor</span> <span class="symbol">:picks</span><span class="punct">,</span> <span class="symbol">:purchased</span>
 <span class="keyword">end</span></code></pre></div>

	<p>Which is exactly the same as this lengthier code:</p>


<div class='example'><pre><code> <span class="keyword">class </span><span class="class">LotteryTicket</span>
   <span class="keyword">def </span><span class="method">picks</span><span class="punct">;</span>           <span class="attribute">@picks</span><span class="punct">;</span>            <span class="keyword">end</span>
   <span class="keyword">def </span><span class="method">picks=</span><span class="punct">(</span><span class="ident">var</span><span class="punct">);</span>     <span class="attribute">@picks</span> <span class="punct">=</span> <span class="ident">var</span><span class="punct">;</span>      <span class="keyword">end</span>
   <span class="keyword">def </span><span class="method">purchased</span><span class="punct">;</span>       <span class="attribute">@purchased</span><span class="punct">;</span>        <span class="keyword">end</span>
   <span class="keyword">def </span><span class="method">purchased=</span><span class="punct">(</span><span class="ident">var</span><span class="punct">);</span> <span class="attribute">@purchased</span> <span class="punct">=</span> <span class="ident">var</span><span class="punct">;</span>  <span class="keyword">end</span>
 <span class="keyword">end</span></code></pre></div>

	<p>Holy cats!  Look at those writer methods for a moment.  They are the methods named <code><span class="ident">picks</span><span class="punct">=</span></code> and <code><span class="ident">purchased</span><span class="punct">=</span></code>.  These methods <strong>intercept outside assignment</strong> to instance variables. Usually you will just let <code><span class="ident">attr_reader</span></code> or <code><span class="ident">attr_accessor</span></code> (or even perhaps <code><span class="ident">attr_writer</span></code>) do the work for you. Other times you may want to put a guard at the door yourself, checking variables in closer detail.</p>


<div class='example'><pre><code> <span class="keyword">class </span><span class="class">SkatingContest</span>
   <span class="keyword">def </span><span class="method">the_winner</span><span class="punct">;</span> <span class="attribute">@the_winner</span><span class="punct">;</span> <span class="keyword">end</span>
   <span class="keyword">def </span><span class="method">the_winner=</span><span class="punct">(</span> <span class="ident">name</span> <span class="punct">)</span>
     <span class="keyword">unless</span> <span class="ident">name</span><span class="punct">.</span><span class="ident">respond_to?</span> <span class="symbol">:to_str</span>
       <span class="keyword">raise</span> <span class="constant">ArgumentError</span><span class="punct">,</span> <span class="punct">&quot;</span><span class="string">The winner's name must be a String,
         not a math problem or a list of names or any of that business.</span><span class="punct">&quot;</span> 
     <span class="keyword">end</span>
     <span class="attribute">@the_winner</span> <span class="punct">=</span> <span class="ident">name</span>
   <span class="keyword">end</span>
 <span class="keyword">end</span></code></pre></div>

	<p>Most of the time you won&#8217;t use this.  But, as we move along through your lessons, you&#8217;ll find that Ruby has lots of escape hatches and alley ways you can sneak into and hack code into.  I&#8217;m also preparing you for metaprogramming, which, if you can smell that dragon, is ominously near.</p>

    
    
        
        <div class="sidebar">
        <h1>sidebar!</h1>
        
        <h2>Another Excerpt from The Scarf Eaters</h2>
        

        <p>(<em>from Chapter <span class="caps">VIII</span>: Sky High</em>.)</p>


	<p>&#8220;I know you,&#8221; said Brent.  &#8220;And I know your timelines. You couldn&#8217;t have done this Flash piece.&#8221;</p>


	<p>&#8220;So, you&#8217;re saying I&#8217;m predictable?&#8221; said Deborah.  She opened her hands and the diced potatoes stumbled like little, drunk sea otters happily into the open crockpot.</p>


	<p>&#8220;You&#8217;re very linear,&#8221; said Brent.  He took up a mechanical pencil, held it straight before his eyes, gazing tightly at it before replacing it in the pencil holder on the counter.  &#8220;Do you even know how to load a scene?  How to jump frames?  This movie I saw was all over the place, Deb.&#8221;</p>


	<p>She heaped five knit scarves and a single bandana into the slow cooker and set it on high.  She closed the lid, leaving her hand resting upon it.</p>


	<p>&#8220;What is it about this movie?&#8221;  Deborah asked.  &#8220;You go to Flash sites all the time.  You played the Elf Snowball game for two seconds, it didn&#8217;t interest you.  You didn&#8217;t care for Elf Bowling games even.  And you weren&#8217;t even phased by that Hit The Penguin flash game.  Elf versus Penguin?  Don&#8217;t even ask!</p>


	<p>&#8220;Now this movie comes along and you can&#8217;t get a grip.&#8221; She walked over and siddled up next to him.  &#8220;Yo, bro, it&#8217;s me. Deborah.  What happened when you saw that movie?&#8221;</p>


	<p>&#8220;Everything,&#8221; said Brent, his eyes reflecting a million worlds. &#8220;And: nothing.  It opened with a young girl riding upon a wild boar.  She was playing harmonica.  The harmonica music washed in and out, uneasy, unsure.  But she rode naturally, as if it wasn&#8217;t anything of a big deal to ride a wild boar.  And with Flash, riding a wild boar really isn&#8217;t a big deal.&#8221;</p>


	<p>Deborah unclasped her bracelet and set it on the counter by the crockpot.</p>


	<p>&#8220;The bottom of the movie started to break up, an ink puddle formed. The boar reared up, but his legs gave way to the all the dark, sputtering ink.&#8221;</p>


	<p>&#8220;Dark clouds converged.  Hardcore music started to play.  Secret agents came out of the clouds.  <span class="caps">CIA</span> guys and stuff.  The animation simply rocked.</p>


	<p>&#8220;And then, at the very end of the movie, these words fade upon the screen.  In white, bold letters.&#8221;</p>


	<p>&#8220;Sky high,&#8221; said Deborah.</p>


	<p>&#8220;How did you know?&#8221; Brent&#8217;s lip quivered.  Could she be trusted?</p>


	<p>&#8220;There is no room left in the world,&#8221; she said.  &#8220;No room for Scarf Eaters, no room for you and I.  Here, take my hand.&#8221;</p>
        <h1>sidebar!</h1>
        </div>

    
    

        <p>Paij-ree was an enterprising young Endertromaltoek.  He hammered animal bones into long, glistening trumpets with deep holes that were plugged by corks the musicians banded to their fingers.  Sure, he only sold three of those units, but he was widely reviled as a freelance scholar, a demonic one, for he was of a poorer class and the poor only ever acquired their brilliance through satanic practice.  Of course, they were right, indeed, he did have a bargain with the dark mages, whom he kept appointments with annually, enduring torturous hot springs, bathing as they chanted spells.</p>


	<p>He adored his father, even as his father deteriorated into but a gyroscope.  He idolized the man&#8217;s work and spent his own small earnings playing the lottery.  He loved to watch the numerals, each painted upon hollow clay balls, rise in the <em>robloch</em> (which is any fluid, pond or spill that has happened to withstand the presence of ghosts), the great bankers tying them together on a silver string, reading them in order.</p>


	<p>Even today, Paij-ree paints the scenes with crude strokes of black ink on sheets of aluminum  foil.  It is very touching to see him caught up in the preciousness of his memory, but I don&#8217;t  know exactly why he does it on aluminum foil.  His drawings rip too easily.  Paij-ree himself gets mixed up and will serve you crumbcake right off of some of this art, even after it has been properly framed.  So many things about him are troubling and absurd and downright wretched.</p>


	<p>The disease spread over his father&#8217;s form and marshy weeds covered his father&#8217;s hands and face.  The moss pulled his spine up into a rigid uprightness.  So thick was the growth over his head that he appeared to wear a shrub molded into a bowler&#8217;s hat.  He also called himself by a new name <del>- <strong>Quos</strong> -</del> and he healed the people he touched, leaving a pile of full-blooded, greenly-cheeked villages in his wake as he travelled the townships.  Many called him The Mossiah and wept on his feet, which wet the buds and caused him to weed into the ground.  This made him momentarily angry, he harshly jogged his legs to break free and thrashed his fists wildly in the sky, bringing down a storm of lightning shards upon these pitiful.</p>


	<p>Paij-ree was apart from the spiritual odysseys of his father (in fact, thought the man dead), so he only saw the decay of the lottery without its captain present.  Here is where Paij-ree went to work, reviving the dead lottery of his family.</p>


	<h3>Gambling with Fewer Fingers</h3>


	<p>The city was crowded with people who had lost interest in the lottery.  The weather had really worn everyone down as well.  Such terrible rain flooding their cellars. The entire city was forced to move up one story.  You&#8217;d go to put the cap back on your pen and you&#8217;d ruin the pen, since the cap was already full of slosh.  Everyone was depleted, many people drowned.</p>


	<p>Paij-ree found himself wasting his days in a quadruple bunkbed, the only furniture that managed to stay above sea level.  He slept on the top bed.  The third bed up was dry as well, so he let a homeless crater gull nest upon it.  The gull didn&#8217;t need the whole bed, so Paij-ree also kept his calculators and pencils down there.</p>


	<p>At first, these were very dark times for both of them, and they insisted on remaining haggard at all times.  Paij-ree became obsessed with his fingernails, kept them long and pristine, while the rest of him deteriorated under a suit of hair.  In the company of Paij-ree, the crater gull learned his own eccentrity and plucked all the feathers on the right side of his body.  He looked like a cutaway diagram.</p>


	<p>They learned to have happier times.  Paij-ree carved a flute from the wall with his nails and played it often.  Mostly he played his relaxed ballads during the daytime.  In the evening, they pounded the wall and shook the bed frame in time to his songs.  The gull went nuts when he played a certain four notes and he looped this section repeatedly, watching the gull swoop and circle in ectasy.  Paij-ree could hardly keep his composure over the effect the little tune had and he couldn&#8217;t keep it together, fell all apart, slobbering and horse-giggling.</p>


	<p>Paij-ree called the gull <em>Eb-F-F-A</em>, after that favorite song.</p>


	<p>Friendship can be a very good catalyst for progress.  A friend can find traits in you that no one else can.  It&#8217;s like they searched your person and somehow came up with five full sets of silverware you never knew were there.  And even though that friend may not understand why you had these utensils concealed, it&#8217;s still a great feat, worth honoring.</p>


	<p>While <em>Eb-F-F-A</em> didn&#8217;t find silverware, he did find something else.  A pile of something else.  Since Paij-ree was stranded on the quadruple bed, the gull would scout around for food.  One day, he flew down upon a barrel, floating over where the toolshed had been.  <em>Eb-F-F-A</em> walked on top of the barrel, spinning it back to Paij-ree&#8217;s house and they cracked it open, revealing Paij-ree&#8217;s lost collection of duck bills.</p>


	<p>Yes, real duck bills. (<em>Eb-F-F-A</em> was esophagizing his squawks, remaining calm, sucking beads of sweat back into his forehead&#8212;ducks were not <em>of his chosen feather</em>, but still in the species.)  Paij-ree clapped gleefully, absolutely, he had intended to shingle his house with these, they could have deflected a bit of the torrent. Probably not much, nothing to cry about.</p>


	<p>And the roof glue was at the barrel&#8217;s bottom and they were two enterprising bunkmates with time to kill, so they made a raft from the previously-quacked lip shades.  And off they were to the country!  Stirring through a real mess of city and soup.  How strange it was to hit a beach and find out it was just the old dirt road passed Toffletown Junction.</p>


	<p>In the country, they sold.  It was always a long walk to the next plantation, but there would be a few buyers up in the mansion (&#8220;Welcome to The Mansion Built on Beets&#8221;, they&#8217;d say or, &#8220;The Mansion Built on Cellophane Substitutes&#8212;don&#8217;t you know how harmful real cellophane can be?&#8221;)  And one of the families wrapped up some excess jelly and ham in some cellophane for the two travellers.  And they almost died one day later because of it.</p>


	<p>Then, when the heat came and, as the first countryside lottery was at nigh, a farmer called to them from his field, as he stood by his grazing cow. Paij-ree and <em>Eb-F-F-A</em> wandered out to him, murmuring to each other as to whether they should offer him the Wind-Beaten Ticket Special or whether he might want to opt in to winning Risky Rosco&#8217;s Original Homestyle Country  Medallion.</p>


	<p>But the farmer waved them down as he approached, &#8220;No, put your calculators and probability wheels away.  It&#8217;s for my grazledon.&#8221;  He meant his cow.  The Endertromb version: twice as much flesh, twice as meaty, doesn&#8217;t produce milk, produces paper plates.  Still, it grazes.</p>


	<p>&#8220;Your grazledon (poh-kon-ic) wants a lucky ticket?&#8221; asked Paij-ree.</p>


	<p>&#8220;He saw you two and got real excited,&#8221; said the farmer.  &#8220;He doesn&#8217;t know numbers, but he understands luck a bit.  He almost got hit by a doter plane one day and, when I found him, he just gave shrug.  It was like he said, &#8216;Well, I guess that worked out okay.&#8217;&#8221;</p>


	<p>&#8220;The whole (shas-op) lottery is numer-(ig-ig)-ic,&#8221; said Paij-ree.  &#8220;Does he know (elsh) notes?  My eagle knows (losh) notes.&#8221;  Paij-ree whistled at the crater gull, who cooed back a sustained <em>D</em>.</p>


	<p>The farmer couldn&#8217;t speak to his grazledon&#8217;s tonal awareness, so Paij-ree sent the gull to find out (<em>D-D-D-A-D</em>, <em>go-teach-the-gra-zle</em>) while he hacked some notes into his calculator.</p>


<div class='example'><pre><code> <span class="keyword">class </span><span class="class">AnimalLottoTicket</span>

   <span class="comment"># A list of valid notes.</span>
   <span class="constant">NOTES</span> <span class="punct">=</span> <span class="punct">[</span><span class="symbol">:Ab</span><span class="punct">,</span> <span class="symbol">:A</span><span class="punct">,</span> <span class="symbol">:Bb</span><span class="punct">,</span> <span class="symbol">:B</span><span class="punct">,</span> <span class="symbol">:C</span><span class="punct">,</span> <span class="symbol">:Db</span><span class="punct">,</span> <span class="symbol">:D</span><span class="punct">,</span> <span class="symbol">:Eb</span><span class="punct">,</span> <span class="symbol">:E</span><span class="punct">,</span> <span class="symbol">:F</span><span class="punct">,</span> <span class="symbol">:Gb</span><span class="punct">,</span> <span class="symbol">:G</span><span class="punct">]</span>

   <span class="comment"># Stores the three picked notes and a purchase date.</span>
   <span class="ident">attr_reader</span> <span class="symbol">:picks</span><span class="punct">,</span> <span class="symbol">:purchased</span>

   <span class="comment"># Creates a new ticket from three chosen notes.  The three notes</span>
   <span class="comment"># must be unique notes.</span>
   <span class="keyword">def </span><span class="method">initialize</span><span class="punct">(</span> <span class="ident">note1</span><span class="punct">,</span> <span class="ident">note2</span><span class="punct">,</span> <span class="ident">note3</span> <span class="punct">)</span>
     <span class="keyword">if</span> <span class="punct">[</span><span class="ident">note1</span><span class="punct">,</span> <span class="ident">note2</span><span class="punct">,</span> <span class="ident">note3</span><span class="punct">].</span><span class="ident">uniq!</span>
       <span class="keyword">raise</span> <span class="constant">ArgumentError</span><span class="punct">,</span> <span class="punct">&quot;</span><span class="string">the three picks must be different notes</span><span class="punct">&quot;</span> 
     <span class="keyword">elsif</span> <span class="ident">picks</span><span class="punct">.</span><span class="ident">detect</span> <span class="punct">{</span> <span class="punct">|</span><span class="ident">p</span><span class="punct">|</span> <span class="keyword">not</span> <span class="constant">NOTES</span><span class="punct">.</span><span class="ident">include?</span> <span class="ident">p</span> <span class="punct">}</span>
       <span class="keyword">raise</span> <span class="constant">ArgumentError</span><span class="punct">,</span> <span class="punct">&quot;</span><span class="string">the three picks must be notes in the chromatic scale.</span><span class="punct">&quot;</span> 
     <span class="keyword">end</span>
     <span class="attribute">@picks</span> <span class="punct">=</span> <span class="ident">picks</span>
     <span class="attribute">@purchased</span> <span class="punct">=</span> <span class="constant">Time</span><span class="punct">.</span><span class="ident">now</span>
   <span class="keyword">end</span>

   <span class="comment"># Score this ticket against the final draw.</span>
   <span class="keyword">def </span><span class="method">score</span><span class="punct">(</span> <span class="ident">final</span> <span class="punct">)</span>
     <span class="ident">count</span> <span class="punct">=</span> <span class="number">0</span>
     <span class="ident">final</span><span class="punct">.</span><span class="ident">picks</span><span class="punct">.</span><span class="ident">each</span> <span class="keyword">do</span> <span class="punct">|</span><span class="ident">note</span><span class="punct">|</span>
       <span class="ident">count</span> <span class="punct">+=</span><span class="number">1</span> <span class="keyword">if</span> <span class="ident">picks</span><span class="punct">.</span><span class="ident">include?</span> <span class="ident">note</span>
     <span class="keyword">end</span>
     <span class="ident">count</span>
   <span class="keyword">end</span>

   <span class="comment"># Constructor to create a random AnimalLottoTicket</span>
   <span class="keyword">def </span><span class="method">self.new_random</span>
     <span class="ident">new</span><span class="punct">(</span> <span class="constant">NOTES</span><span class="punct">[</span> <span class="ident">rand</span><span class="punct">(</span> <span class="constant">NOTES</span><span class="punct">.</span><span class="ident">length</span> <span class="punct">)</span> <span class="punct">],</span> <span class="constant">NOTES</span><span class="punct">[</span> <span class="ident">rand</span><span class="punct">(</span> <span class="constant">NOTES</span><span class="punct">.</span><span class="ident">length</span> <span class="punct">)</span> <span class="punct">],</span>
          <span class="constant">NOTES</span><span class="punct">[</span> <span class="ident">rand</span><span class="punct">(</span> <span class="constant">NOTES</span><span class="punct">.</span><span class="ident">length</span> <span class="punct">)</span> <span class="punct">]</span> <span class="punct">)</span>
   <span class="keyword">rescue</span> <span class="constant">ArgumentError</span>
     <span class="keyword">redo</span>
   <span class="keyword">end</span>

 <span class="keyword">end</span></code></pre></div>

	<p>No need for the animal&#8217;s tickets to behave drastically different from the traditional tickets.  The <code><span class="constant">AnimalLottoTicket</span></code> class is internally different, but exposes the same methods seen in the original <code><span class="constant">LotteryTicket</span></code> class. The <code><span class="ident">score</span></code> method is even identical to the <code><span class="ident">score</span></code> method from the old <code><span class="constant">LotteryTicket</span></code> class.</p>


	<p>Instead of using a class variable to store the musical note list, they&#8217;re stored in a constant called <code><span class="constant">AnimalLottoTicket</span><span class="punct">::</span><span class="constant">NOTES</span></code>.  Variables change and the note list shouldn&#8217;t change.  Constants are designed to stay the same.  You can still change the constant, but you&#8217;ll have to be tricky or Ruby will speak up.</p>


<div class='example'><pre><code> <span class="ident">irb</span><span class="punct">&gt;</span> <span class="constant">AnimalLottoTicket</span><span class="punct">::</span><span class="constant">NOTES</span> <span class="punct">=</span> <span class="punct">[</span><span class="symbol">:TOOT</span><span class="punct">,</span> <span class="symbol">:TWEET</span><span class="punct">,</span> <span class="symbol">:BLAT</span><span class="punct">]</span>
 <span class="punct">(</span><span class="ident">irb</span><span class="punct">):</span><span class="number">3</span><span class="punct">:</span> <span class="ident">warning</span><span class="punct">:</span> <span class="ident">already</span> <span class="ident">initialized</span> <span class="ident">constant</span> <span class="constant">NOTES</span>
   <span class="punct">=&gt;</span> <span class="punct">[</span><span class="symbol">:TOOT</span><span class="punct">,</span> <span class="symbol">:TWEET</span><span class="punct">,</span> <span class="symbol">:BLAT</span><span class="punct">]</span></code></pre></div>

	<p>The gull came back with the grazledon, his name was Merphy, he was thrilled to play chance, he puffed his face dreamily, whistled five and six notes in series, they all held his collar, pulled him close to the calculator and let him breathe three notes, then they choked the bedosh outta him until his ticket was printed and  everything was nicely catalogued inside <code><span class="attribute">@@tickets</span><span class="punct">['</span><span class="string">merphy</span><span class="punct">']</span></code>.  Thankyou, see ya at the draw!</p>


	<p>So, the fever of the lottery became an epidemic among the simple minds of the animals.   Paij-ree saved his costs, used the same <code><span class="constant">LotteryDraw</span></code> class he&#8217;d used in the corporate environment of the lottery from his childhood.  And soon enough, the animals were making their own music and their own maps and films.</p>


	<p>&#8220;What about The Originals?&#8221; I asked Paij-ree.  &#8220;They must have hated your animals!&#8221;</p>


	<p>But he winced sourly and pinched his forehead.  &#8220;I am an Original.  You as well. Do we (ae-o) hate any of them?&#8221;</p>


	<p>Not too long after the lottery ended, Paij-ree felt the crater gull <em>Eb-F-F-A</em> lighting upon his shoulder, which whistled an urgent and sad <em>C-Eb-D C-A-Eb</em>. These desparate notes sent an organ roll of chills straight through Paij-ree.  Had the King God of Potted Soil, Our Beloved Topiary, <strong>the Mossiah Quos</strong>, Literal Father of That Man Who Would Be My Daughter&#8217;s Organ Instructor&#8212;had he truly come to his end? How could this be?  Could the great arbors no longer nourish him and guide the moist crosswinds to him?  Or did his own spindly lichen hedge up his way and grow against his breathing?</p>


	<p><em>You never mind</em>, went the tune of the gull.  <em>He has detoriated and weakened and fallen in the lit door of your home cottage.  His tendrils needing and crying for the day to not end. For the sun to stay fixed and wide and attentive.</em></p>


	<p>Plor-ian, the house attendant, kept the pitchers coming and Quos stayed well watered until Paij-ree arrived to survey the decaying buds of soft plant and the emerging face of his father, the lottery captain.  His skin deeply pocked like an overly embroidered pillow. Great shoots springing from his sleeves now curled back with lurching thirst.</p>


	<p>Paij-ree combed back the longer stems around his father&#8217;s eyes and those coming from the corners of his mouth.  While I&#8217;d like to tell you that Paij-ree&#8217;s tears rolled down his sleeves and into the pours of his father, rejuvenating and restoring the grassy gentleman: I cannot say this.</p>


	<p>Rather, Paij-ree&#8217;s tears rolled down his sleeves and into the creaking clapboard floor, nourishing the vile weeds, energizing the dark plant matter, which literally lept through the floor at night and strangled Our Quos.  Yank, pull, crack.  And that was his skull.</p>


	<p>So Paij-ree could never be called Wert-ree or Wert-plo after that.</p>

    
    
        
        <a name="section6" />
        <h2>6. Them What Make the Rules</h2>

        <p>Hannah lept back from the wall and clenched down on her fingers.</p>


	<p>&#8220;This is the wall,&#8221; said Dr. Cham.  &#8220;The Originals are in there.  My child, can you lead us to the observation deck?&#8221;</p>


	<p>&#8220;You expect us to go up against those guys?&#8221; asked the goat.  &#8220;They&#8217;re mad as koalas.  But these koalas have lasers!&#8221;</p>


	<p>&#8220;We prevail, though,&#8221; said Dr. Cham.  &#8220;You and I know this.&#8221;</p>


	<p>&#8220;Okay, well I&#8217;m muddled on that point,&#8221; said the goat.  &#8220;Do we really win? Or could we be thinking about <em>Kramer vs. Kramer</em>?  Does Dustin Hoffman win or do we win?&#8221;</p>


	<p>&#8220;No.  No.  No.  No.&#8221;  Hannah hovered and dragged her legs along the wall nervously. &#8220;There is a man with a huge face in there!&#8221;</p>


	<p>&#8220;Mr. Face,&#8221; said the Doctor.  &#8220;He is the original face.&#8221;</p>


	<p>&#8220;He didn&#8217;t see me,&#8221; said Hannah and moaned.  <strong><span class="caps">HOMA</span>-HOMA-ALLO-ALLO.</strong></p>


	<p>She made that hollow weeping through the crumbling mouseholes and the freezer gateways, fluxing in and out, causing the video checkpoints to hiss and the wall panels to brace themselves and fall silent.  The three passed through two levels of frayed security and emerged in the observation deck overlooking the cargo bay.</p>


	<p><img src="../images/the.originals-1.jpg" title="Klon Ooper. Corwood. Mr. Face. Vonblisser.  The Originals." alt="Klon Ooper. Corwood. Mr. Face. Vonblisser.  The Originals." /></p>


	<p>&#8220;The last living among The Originals,&#8221; said Dr. Cham.  &#8220;Are you alright with this, Hannah?&#8221;  Which she didn&#8217;t hear in any way, as her eyes laid fixed on the legendary creatures.</p>


	<p>&#8220;Look at them,&#8221; said the goat.  &#8220;These guys wrote the rule books, Doctor.  We owe everything to these guys.&#8221;</p>


	<p>&#8220;What about God?&#8221; said Dr. Cham.</p>


	<p>&#8220;I don&#8217;t really know,&#8221; said the goat.  &#8220;Hannah probably knows better than any of us about that.&#8221;</p>


	<p>Hannah said nothing.  She only really knew one other ghost and that was her Post-Decease Mediator, Jamie Huft.  Who didn&#8217;t seem to have any answers for her and required questions to be submitted in writing with a self-addressed stamped envelope included.  Hannah hadn&#8217;t gotten the ball rolling on that P.O. Box yet.</p>


	<p>&#8220;We must be up in the mountains,&#8221; said the goat.  &#8220;Look out at that blackness.&#8221;</p>


	<p>&#8220;I saw another deck like this down by where we found Hannah,&#8221; said Dr. Cham.  &#8220;Down closer to your living area.  You should take time to search for it.  It&#8217;s very peaceful there. You can see Earth and the seven seas.&#8221;</p>


	<p>&#8220;The seven seas?&#8221;  The goat wondered if that was near The Rockettes.  He&#8217;d read his share of material on precision dancing and he&#8217;d seen that line of legs, mincing across the stage like a big, glitsy rototiller.</p>


	<p>Hannah stirred to life.</p>


	<p><img src="../images/the.originals-2.jpg" title="Hannah panicks. Maple donuts are within reach." alt="Hannah panicks. Maple donuts are within reach." /></p>


	<p><img src="../images/the.originals-3.jpg" title="They couldn't hear them, but they saw their slides." alt="They couldn't hear them, but they saw their slides." /></p>


	<p>And none of the three spoke when The Originals flicked off the slide projector and boarded a very slender rocketship and cleanly exploded through a crevice in the cargo bay roof.</p>


	<p>&#8220;Oh, boy,&#8221; said the goat.</p>


	<p>&#8220;What?&#8221; said Hannah.</p>


	<p>&#8220;You&#8217;re going to die,&#8221; said the goat.</p>


	<p>Dr. Cham looked over the controls in front of them, a long panel of padded handles and green screens.</p>


	<p>&#8220;I&#8217;m already dead.  I&#8217;m a ghost.&#8221;</p>


	<p>The goat looked down at the Doctor, who was rummaging under the control panel.  &#8220;Okay, well if your uncle isn&#8217;t going to have a talk with you, I&#8217;m going to make things very clear.  There&#8217;s a good chance these guys are going to build a bomb.  And you see how I&#8217;m fidgeting?  You see how my knees are wobbling?&#8221;</p>


	<p>&#8220;Yeah.&#8221;</p>


	<p>&#8220;Yeah, that&#8217;s how real this is, kid.  I don&#8217;t remember anything from that <em>confounded book</em> except that these guys are building a bomb that can blow up the ghost world.   Because once the ghost world&#8217;s gone, then Digger Dosh gets his one second back.   It&#8217;s a trade they&#8217;ve worked out.  Hell, it&#8217;s sick stuff, that&#8217;s all you need to know.&#8221;</p>


	<p>&#8220;But I&#8217;m dead.&#8221;</p>


	<p>&#8220;Okay, well, we&#8217;re talking, aren&#8217;t we?  You can talk, so are you dead?&#8221;  The goat shook his head. &#8220;I wish I could remember if we win or if it was Dustin Hoffman.&#8221;</p>


	<p>Hannah cried.  &#8220;Why do I have to die again?&#8221;  She wailed and her legs fell into flux and she sunk into the floor.  <strong><span class="caps">MOH</span>-MOHHH-MAO-MAOOO.</strong></p>


	<p>Dr. Cham had forceably yanked on a plush handle, which unlocked and slid open like a breadbox. He reached his hands inside and found a keyboard firmly bolted deep inside.</p>


	<p>&#8220;That&#8217;s it,&#8221; he said and pulled up <code><span class="ident">irb</span></code>, which appeared on a display to the left of his concealed typing.  He checked the Ruby version.</p>


<div class='example'><pre><code> <span class="ident">irb</span><span class="punct">&gt;</span> <span class="constant">RUBY_VERSION</span>
   <span class="punct">=&gt;</span> <span class="punct">&quot;</span><span class="string">1.8.3</span><span class="punct">&quot;</span></code></pre></div>

	<p>Ruby was up-to-date.  What else could he do?  Scanning <code><span class="ident">constants</span></code> and <code><span class="ident">class_variables</span></code> was pointless. The only reason that had worked with the <code><span class="constant">Elevator</span></code> class was because someone had left <code><span class="ident">irb</span></code> running with their classes still loaded.</p>


	<p>He had just loaded this <code><span class="ident">irb</span></code>, so no special classes were available yet.  He had to find some classes. He started by loading the <code>`<span class="ident">rbconfig`</span></code> file to get an idea of what Ruby&#8217;s settings were.</p>


<div class='example'><pre><code> <span class="ident">irb</span><span class="punct">&gt;</span> <span class="ident">require</span> <span class="punct">'</span><span class="string">rbconfig</span><span class="punct">'</span>
   <span class="punct">=&gt;</span> <span class="constant">true</span>
 <span class="ident">irb</span><span class="punct">&gt;</span> <span class="constant">Config</span><span class="punct">::</span><span class="constant">CONFIG</span>
   <span class="punct">=&gt;</span> <span class="punct">{&quot;</span><span class="string">abs_srcdir</span><span class="punct">&quot;=&gt;&quot;</span><span class="string">$(ac_abs_srcdir)</span><span class="punct">&quot;,</span> <span class="punct">&quot;</span><span class="string">sitedir</span><span class="punct">&quot;=&gt;&quot;</span><span class="string">bay://Ruby/lib/site_ruby</span><span class="punct">&quot;,</span> <span class="punct">...</span> <span class="punct">}</span></code></pre></div>

	<p>Too much information to sort through there.  The <code><span class="constant">Config</span><span class="punct">::</span><span class="constant">CONFIG</span></code> constant is a Hash that contains every environment setting used to setup Ruby.  You can find the operating system name at <code><span class="constant">Config</span><span class="punct">::</span><span class="constant">CONFIG</span><span class="punct">['</span><span class="string">host_os</span><span class="punct">']</span></code>.  The directory where core Ruby libraries are stored can be found at <code><span class="constant">Config</span><span class="punct">::</span><span class="constant">CONFIG</span><span class="punct">['</span><span class="string">rubylibdir</span><span class="punct">']</span></code>.  Ruby programs can store helper files at <code><span class="constant">Config</span><span class="punct">::</span><span class="constant">CONFIG</span><span class="punct">['</span><span class="string">datadir</span><span class="punct">']</span></code>.</p>


	<p>What Dr. Cham really needed, though, was a list of all the libraries that aren&#8217;t core Ruby libraries.  Libraries which were installed by The Originals or whoever manned this console. He checked a few global variables for this information.</p>


<div class='example'><pre><code> <span class="ident">irb</span><span class="punct">&gt;</span> <span class="global">$&quot;</span> 
   <span class="punct">=&gt;</span> <span class="punct">[&quot;</span><span class="string">irb.rb</span><span class="punct">&quot;,</span> <span class="punct">&quot;</span><span class="string">e2mmap.rb</span><span class="punct">&quot;,</span> <span class="punct">&quot;</span><span class="string">irb/init.rb</span><span class="punct">&quot;,</span> <span class="punct">...</span> <span class="punct">&quot;</span><span class="string">rbconfig.rb</span><span class="punct">&quot;]</span>
 <span class="ident">irb</span><span class="punct">&gt;</span> <span class="global">$:</span>
   <span class="punct">=&gt;</span> <span class="punct">[&quot;</span><span class="string">bay://Ruby/lib/site_ruby/1.9</span><span class="punct">&quot;,</span> <span class="punct">&quot;</span><span class="string">bay://Ruby/lib/site_ruby/1.9/i686-unknown</span><span class="punct">&quot;,</span>
       <span class="punct">&quot;</span><span class="string">bay://Ruby/lib/site_ruby</span><span class="punct">&quot;,</span> <span class="punct">&quot;</span><span class="string">bay://Ruby/lib/1.9</span><span class="punct">&quot;,</span> 
       <span class="punct">&quot;</span><span class="string">bay://Ruby/lib/1.9/i686-unknown</span><span class="punct">&quot;,</span> <span class="punct">&quot;</span><span class="string">.</span><span class="punct">&quot;]</span></code></pre></div>

	<p>Aha, good.  Dr. Cham stroked his beard and looked over his <code><span class="ident">irb</span></code> session.  The <code><span class="global">$&quot;</span></code> global variable contains an Array of every library which has been loaded with <code><span class="ident">require</span></code>.  Most of these libraries had been loaded by <code><span class="ident">irb</span></code>.  He had loaded <code><span class="punct">'</span><span class="string">rbconfig.rb</span><span class="punct">'</span></code> earlier, though.</p>


	<p>The <code><span class="global">$:</span></code> global variable, which can also be accessed as <code><span class="global">$LOAD_PATH</span></code>, contains a list of all the directories which Ruby will check when you try to load a file with <code><span class="ident">require</span></code>.  When Dr. Cham ran <code><span class="ident">require</span> <span class="punct">'</span><span class="string">rbconfig</span><span class="punct">'</span></code>, Ruby checked each directory in order.</p>


<div class='example'><pre><code> <span class="ident">bay</span><span class="punct">:/</span><span class="regex"></span><span class="punct">/</span><span class="constant">Ruby</span><span class="punct">/</span><span class="ident">lib</span><span class="punct">/</span><span class="ident">site_ruby</span><span class="punct">/</span><span class="number">1.9</span><span class="punct">/</span><span class="ident">rbconfig</span><span class="punct">.</span><span class="ident">rb</span>
 <span class="ident">bay</span><span class="punct">:/</span><span class="regex"></span><span class="punct">/</span><span class="constant">Ruby</span><span class="punct">/</span><span class="ident">lib</span><span class="punct">/</span><span class="ident">site_ruby</span><span class="punct">/</span><span class="number">1.9</span><span class="punct">/</span><span class="ident">i686</span><span class="punct">-</span><span class="ident">unknown</span><span class="punct">/</span><span class="ident">rbconfig</span><span class="punct">.</span><span class="ident">rb</span> <span class="punct">(*)</span>
 <span class="ident">bay</span><span class="punct">:/</span><span class="regex"></span><span class="punct">/</span><span class="constant">Ruby</span><span class="punct">/</span><span class="ident">lib</span><span class="punct">/</span><span class="ident">site_ruby</span><span class="punct">/</span><span class="ident">rbconfig</span><span class="punct">.</span><span class="ident">rb</span>
 <span class="ident">bay</span><span class="punct">:/</span><span class="regex"></span><span class="punct">/</span><span class="constant">Ruby</span><span class="punct">/</span><span class="ident">lib</span><span class="punct">/</span><span class="number">1.9</span><span class="punct">/</span><span class="ident">rbconfig</span><span class="punct">.</span><span class="ident">rb</span>
 <span class="ident">bay</span><span class="punct">:/</span><span class="regex"></span><span class="punct">/</span><span class="constant">Ruby</span><span class="punct">/</span><span class="ident">lib</span><span class="punct">/</span><span class="number">1.9</span><span class="punct">/</span><span class="ident">i686</span><span class="punct">-</span><span class="ident">unknown</span><span class="punct">/</span><span class="ident">rbconfig</span><span class="punct">.</span><span class="ident">rb</span>
 <span class="punct">./</span><span class="regex">rbconfig.rb</span></code></pre></div>

	<p>The second path was where Ruby ended up finding the rbconfig.rb file.  Dr. Cham guessed that the first five paths were <strong>absolute paths</strong>.  These were paths to directories on a drive called <code><span class="ident">bay</span></code>.  Absolute paths may vary on your system.  On Windows, absolute paths will start with a drive letter.  On Linux, absolute paths start with a slash.</p>


	<p>The directory <code><span class="punct">&quot;</span><span class="string">.</span><span class="punct">&quot;</span></code> indicates a <strong>relative path</strong>.  The lone period represents the current work directory.  The directory where Dr. Cham started up <code><span class="ident">irb</span></code>.  So, after Ruby has searched all the standard places, it checks the current directory.</p>


	<p>The goat had peeked his head around Dr. Cham and was watching all these instructions transpire, as he licked his lips to keep his salivations from running all over the monitors and glossy buttons.  He had been interjecting a few short cheers (along the lines of: <em>No, not that</em> or <em>Yes, yes, right</em> or <em>Okay, well, your choice</em>), but now he was fully involved, recommending code, &#8220;Try <code><span class="ident">require</span> <span class="punct">'</span><span class="string">setup</span><span class="punct">'</span></code> or, no, try <code><span class="number">3</span> <span class="punct">*</span> <span class="number">5</span></code>.  Make sure that basic math works.&#8221;</p>


	<p>&#8220;Of course the math works,&#8221; said Dr. Cham.  &#8220;Let me be, I need to find some useful classes.&#8221;</p>


	<p>&#8220;It&#8217;s a basic sanity test,&#8221; said the goat.  &#8220;Just try it.  Do <code><span class="number">3</span> <span class="punct">*</span> <span class="number">5</span></code> and see what comes up.&#8221;</p>


	<p>Dr. Cham caved.</p>


<div class='example'><pre><code> <span class="ident">irb</span><span class="punct">&gt;</span> <span class="number">3</span> <span class="punct">*</span> <span class="number">5</span>
   <span class="punct">=&gt;</span> <span class="number">15</span></code></pre></div>

	<p>&#8220;Okay, great!  We&#8217;re in business!&#8221; the goat tossed his furry face about in glee.</p>


	<p>Dr. Cham patted the goat&#8217;s head, &#8220;Well done.  We can continue.&#8221;</p>


<div class='example'><pre><code> <span class="ident">irb</span><span class="punct">&gt;</span> <span class="constant">Dir</span><span class="punct">.</span><span class="ident">chdir</span><span class="punct">(</span> <span class="punct">&quot;</span><span class="string">bay://Ruby/lib/site_ruby/1.9/</span><span class="punct">&quot;</span> <span class="punct">)</span>
   <span class="punct">=&gt;</span> <span class="number">0</span>
 <span class="ident">irb</span><span class="punct">&gt;</span> <span class="constant">Dir</span><span class="punct">[&quot;</span><span class="string">./*.{rb}</span><span class="punct">&quot;]</span>
   <span class="punct">=&gt;</span> <span class="punct">['</span><span class="string">endertromb.rb</span><span class="punct">',</span> <span class="punct">'</span><span class="string">mindreader.rb</span><span class="punct">',</span> <span class="punct">'</span><span class="string">wishmaker.rb</span><span class="punct">']</span></code></pre></div>

	<p>Dr. Cham had use <code><span class="ident">chdir</span></code> to change the current working directory over the the first path listed in <code><span class="global">$LOAD_PATH</span></code>.  This first path in <code><span class="ident">site_ruby</span></code> is a common place to store custom classes.</p>


	<p>Here were the three legendary classes that my daughter&#8217;s organ instructor had inscribed for me earlier in this chapter.  And, Dr. Cham, having read this selfsame chapter, recognized these three pieces of the system immediately.</p>


	<p>The <code><span class="constant">Endertromb</span></code> class which contained the mysteries of this planet&#8217;s powers.  The <code><span class="constant">MindReader</span></code> class which, upon scanning the minds of its inhabitants, read each mind&#8217;s contents.  And, finally, the crucial <code><span class="constant">WishMaker</span></code> class which powered the granting of ten-letter wishes, should the wish ever find its way to the core of Endertromb.</p>


	<p>&#8220;How about <code><span class="number">4</span> <span class="punct">*</span> <span class="number">56</span> <span class="punct">+</span> <span class="number">9</span></code>?&#8221; asked the goat.  &#8220;We don&#8217;t know if it can do compound expressions.&#8221;</p>


	<p>&#8220;I&#8217;ve got the <code><span class="constant">MindReader</span></code> right here,&#8221; said Dr. Cham.  &#8220;And I have the <code><span class="constant">WishMaker</span></code> here next to it. This planet can read minds.  And this planet can make wishes.  Now, let&#8217;s see if it can do both at the same time.&#8221;</p>

    
    
        
        <a name="section7" />
        <h2>7. Them What Live the Dream</h2>

        <p>While The Originals&#8217; craft had long disappeared, Dr. Cham frantically worked away at the computer built into the control panel up in the observation deck.  Hannah had disappeared into the floor (or perhaps those little sparks along the ground were still wisps of her paranormal presence!) and the goat amicably watched Dr. Cham hack out a Ruby module.</p>


<div class='example'><pre><code> <span class="ident">require</span> <span class="punct">'</span><span class="string">endertromb</span><span class="punct">'</span>
 <span class="keyword">module </span><span class="module">WishScanner</span>
   <span class="keyword">def </span><span class="method">scan_for_a_wish</span>
     <span class="ident">wish</span> <span class="punct">=</span> <span class="constant">self</span><span class="punct">.</span><span class="ident">read</span><span class="punct">.</span><span class="ident">detect</span> <span class="keyword">do</span> <span class="punct">|</span><span class="ident">thought</span><span class="punct">|</span>
       <span class="ident">thought</span><span class="punct">.</span><span class="ident">index</span><span class="punct">(</span> <span class="punct">'</span><span class="string">wish: </span><span class="punct">'</span> <span class="punct">)</span> <span class="punct">==</span> <span class="number">0</span>
     <span class="keyword">end</span>
     <span class="ident">wish</span><span class="punct">.</span><span class="ident">gsub</span><span class="punct">(</span> <span class="punct">'</span><span class="string">wish: </span><span class="punct">',</span> <span class="punct">'</span><span class="string"></span><span class="punct">'</span> <span class="punct">)</span>
   <span class="keyword">end</span>
 <span class="keyword">end</span></code></pre></div>

	<p>&#8220;What&#8217;s your plan?&#8221; asked the goat.  &#8220;It seems like I could have solved this problem in like three lines.&#8221;</p>


	<p>&#8220;This <code><span class="constant">Module</span></code> is the new <code><span class="constant">WishScanner</span></code> technology,&#8221; he said.  &#8220;The scanner only picks up a wish if it starts with the word <code><span class="ident">wish</span></code> and a colon and a space.  That way the planet doesn&#8217;t fill up with every less-than-ten-letter word that appears in people&#8217;s heads.&#8221;</p>


	<p>&#8220;Why don&#8217;t you just use a class?&#8221; asked the goat.</p>


	<p>&#8220;Because a <code><span class="constant">Module</span></code> is simpler than a class.  It&#8217;s basically just a storage facility for methods.  It keeps a group of methods together.  You can&#8217;t create new objects from a method.&#8221;</p>


	<p>&#8220;But aren&#8217;t you going to want a <code><span class="constant">WishScanner</span></code> object, so you can actually use it?&#8221; said the goat, appalled.</p>


	<p>&#8220;I&#8217;m going to mix it into the <code><span class="constant">MindReader</span></code>,&#8221; said Dr. Cham.  And he did.</p>


<div class='example'><pre><code> <span class="ident">require</span> <span class="punct">'</span><span class="string">mindreader</span><span class="punct">'</span>
 <span class="keyword">class </span><span class="class">MindReader</span>
   <span class="ident">include</span> <span class="constant">WishScanner</span>
 <span class="keyword">end</span></code></pre></div>

	<p>&#8220;Now, the <code><span class="constant">WishScanner</span></code> module is mixed in to the <code><span class="constant">MindReader</span></code>,&#8221; said Dr. Cham. &#8220;I can call the <code><span class="ident">scan_for_a_wish</span></code> method on any <code><span class="constant">MindReader</span></code> object.&#8221;</p>


	<p>&#8220;So, it&#8217;s a mixin,&#8221; said the goat.  &#8220;The <code><span class="constant">WishScanner</span></code> mixin.&#8221;</p>


	<p>&#8220;Yes, any module which is introduced into a class with <code><span class="ident">include</span></code> is a mixin to that class.  If you go back and look at the <code><span class="ident">scan_for_a_wish</span></code> method, you&#8217;ll see that it calls a <code><span class="constant">self</span><span class="punct">.</span><span class="ident">read</span></code> method.  I just have to make sure that whatever class I&#8217;m mixing <code><span class="constant">WishScanner</span></code> into has a <code><span class="ident">read</span></code> method.  Otherwise, an error will be thrown.&#8221;</p>


	<p>&#8220;That seems really weird that the mixin requires certain methods that it doesn&#8217;t already have. It seems like it should work by itself.&#8221;</p>


	<p>Dr. Cham looked up from the keyboard at the goat.  &#8220;Well, it&#8217;s sort of like your video collection. None of your video cassettes work unless they are put in a machine that uses video cassettes. The depend on each other.  A mixin has some basic requirements, but once a class meets those requirements, you can add all this extra functionality in.&#8221;</p>


	<p>&#8220;Hey, that&#8217;s cool,&#8221; said the goat.</p>


	<p>&#8220;You read the book thirty times and you didn&#8217;t pick that up?&#8221; asked Dr. Cham.</p>


	<p>&#8220;You&#8217;re a much better teacher in person,&#8221; said the goat.  &#8220;I really didn&#8217;t think I was going to like you very much.&#8221;</p>


	<p>&#8220;I completely understand,&#8221; said the Doctor.  &#8220;This is much more real than the cartoons make it seem.&#8221;</p>


<div class='example'><pre><code> <span class="ident">require</span> <span class="punct">'</span><span class="string">wishmaker</span><span class="punct">'</span>
 <span class="ident">reader</span> <span class="punct">=</span> <span class="constant">MindReader</span><span class="punct">.</span><span class="ident">new</span>
 <span class="ident">wisher</span> <span class="punct">=</span> <span class="constant">WishMaker</span><span class="punct">.</span><span class="ident">new</span>
 <span class="ident">loop</span> <span class="keyword">do</span>
   <span class="ident">wish</span> <span class="punct">=</span> <span class="ident">reader</span><span class="punct">.</span><span class="ident">scan_for_a_wish</span>
   <span class="keyword">if</span> <span class="ident">wish</span>
     <span class="ident">wisher</span><span class="punct">.</span><span class="ident">grant</span><span class="punct">(</span> <span class="ident">wish</span> <span class="punct">)</span>
   <span class="keyword">end</span>
 <span class="keyword">end</span></code></pre></div>

	<p>Irb sat and looped on the screen.  It&#8217;ll do that until you hit Control-C.  But Dr. Cham let it churn away.  Looping endlessly, scanning the mind waves for a proper wish.</p>


	<p>And Dr. Cham readied his wish.  At first, he thought immediately of a <code><span class="ident">stallion</span></code>.  To ride bareback over the vales of Sedna.  But he pulled the thought back, his wish hadn&#8217;t been formed properly. A stallion was useless in pursuing The Originals, so he closed his eyes again, bit his lip and he thought to himself: <code><span class="ident">wish</span><span class="punct">:</span> <span class="ident">whale</span></code>.</p>


	<h3>Last Whale to Peoplemud</h3>


	<p>The blocky, sullen whale appeared down at the castle entrance, where Hannah was bashing on a rosebud with her hand.  She whacked at it with a fist, but it only stayed perfect and pleasant and crisp against the solid blue sky of Endertromb.</p>


	<p>&#8220;I&#8217;m bored,&#8221; she said to the whale.  <strong><span class="caps">BOHR</span>-BOHR-OHRRRRRR.</strong></p>


	<p>&#8220;Ok,&#8221; said the whale, deep and soft.  As the word slid along his massive tongue, its edges chipped off and the word slid out polished and worn in a bubble by his mouth&#8217;s corner.</p>


	<p>&#8220;I always have to die,&#8221; said the young ghost.  &#8220;People always kill me.&#8221;</p>


	<p>The whale fluttered his short fins, which hung at useless distance from the ground. So, he pushed himself toward her with his tail.  Scooting over patches of grass.</p>


	<p>&#8220;People kill, so who do they kill?&#8221; said the girl.  &#8220;Me.  They kill me every time.&#8221;</p>


	<p>The whale made it to within three meters of the girl, where he towered like a great war monument that represents enough dead soldiers to actually steal a lumbering step towards you.  And now, the whale rested his tail and, exhausted by the climb thus far, let his eyelids fall shut and became a gently puffing clay mountain, his shadow rich and doubled-up all around the hardly visible Hannah.</p>


	<p>But another shadow combined, narrow and determined.  Right behind her, the hand came on to her shoulder, and the warm ghost inside the hand touched her sleeve.</p>


	<p>&#8220;How did you get down here?&#8221; said the girl.</p>


	<p>Dr. Cham sat right alongside her and the goat walked around and stood in front.</p>


	<p>&#8220;Listen to us,&#8221; said Dr. Cham.  &#8220;We&#8217;ve got to follow this mangy pack of ne&#8217;er-do-wells to the very end, Hannah.  And to nab them, we need your faithful assistance!&#8221;</p>


	<p>&#8220;I&#8217;m scared,&#8221; cried Hannah.</p>


	<p>&#8220;You&#8217;re not scared,&#8221; said the goat.  &#8220;Come on.  You&#8217;re a terrifying little phantom child.&#8221;</p>


	<p>&#8220;Well,&#8221; she said.  &#8220;I&#8217;m a little bored.&#8221;</p>


	<p>Dr. Cham bent down on a knee, bringing his shaggy presence toward the ground, his face just inches from hers.  &#8220;If you come with us, if you can trust what we know, then we can bag this foul troupe.  Now, you say your destiny is to be a baker.  I won&#8217;t dispute that. You have every right on Earth <del>- and Endertromb, for that matter -</del> to become a baker. Say, if you didn&#8217;t become a baker, that would be a great tragedy.  Who&#8217;s going to take care of all those donuts if you don&#8217;t?&#8221;</p>


	<p>She shrugged.  &#8220;That&#8217;s what I&#8217;ve been saying.&#8221;</p>


	<p>&#8220;You&#8217;re right,&#8221; said the Doctor.  &#8220;You&#8217;ve been saying it from the start.&#8221;  He looked up to the sky, where the wind whistled peacefully despite its forceful piercing by The Originals&#8217; rocketship.  &#8220;If your destiny is to be a baker, then mine is to stop all this, to end the mayhem that is just beginning to boil.  And hear me, child <del>- hear how sure and solid my voice becomes when I say this -</del> I ended your life, I bear sole responsibility for your life as an apparition, but I will get it back.  It&#8217;s going to take more than a donut, but you will have a real childhood.  I promise you.&#8221;</p>


	<p><img src="../images/whale.escape-1.jpg" title="On the wished whale... away..." alt="On the wished whale... away..." /></p>


	<p>Sure, it took a minute for the goat to cut his wish down to ten letters, but he was shortly on his way, following the same jetstreams up into the sky, up toward Dr. Cham and his ghost niece Hannah.  Up toward the villanous animal combo pak called The Originals.  Up toward The Rockettes.</p>


	<p>And Digger Dosh bludgeoned and feasted on each second they left behind them.</p>

    
    

        <p style="text-align:right;">
        <a href="chapter-6.html">Turn page.</a>
        </p>

    </div>
</div>
</div>
</body>
</html>
